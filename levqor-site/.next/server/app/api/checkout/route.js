"use strict";(()=>{var e={};e.id=1607,e.ids=[1607],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},21764:e=>{e.exports=require("util")},23248:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>P,patchFetch:()=>d,requestAsyncStorage:()=>l,routeModule:()=>S,serverHooks:()=>I,staticGenerationAsyncStorage:()=>T});var s={};t.r(s),t.d(s,{GET:()=>R,POST:()=>E,dynamic:()=>u});var n=t(49303),o=t(88716),i=t(60670),a=t(87070),c=t(91988);let u="force-dynamic";function _(){return{SECRET:process.env.STRIPE_SECRET_KEY,SITE_URL:process.env.SITE_URL||"",STARTER_M:process.env.STRIPE_PRICE_STARTER,STARTER_Y:process.env.STRIPE_PRICE_STARTER_YEAR,LAUNCH_M:process.env.STRIPE_PRICE_LAUNCH,LAUNCH_Y:process.env.STRIPE_PRICE_LAUNCH_YEAR,BIZ_M:process.env.STRIPE_PRICE_BUSINESS,BIZ_Y:process.env.STRIPE_PRICE_BUSINESS_YEAR,ADDON_SUPPORT:process.env.STRIPE_PRICE_ADDON_PRIORITY_SUPPORT,ADDON_SLA:process.env.STRIPE_PRICE_ADDON_SLA_99_9,ADDON_WL:process.env.STRIPE_PRICE_ADDON_WHITE_LABEL}}function p(e){return Object.entries(e).filter(([e,r])=>!r||""===String(r).trim()).map(([e])=>e)}async function R(){let e=p(_());return a.NextResponse.json({ok:0===e.length,missing:e})}async function E(e){try{let r=_(),t=p(r);if(t.length)return a.NextResponse.json({ok:!1,error:`missing_env:${t.join(",")}`},{status:500});let{plan:s,term:n,addons:o=[]}=await e.json(),i={"starter:monthly":String(r.STARTER_M),"starter:yearly":String(r.STARTER_Y),"launch:monthly":String(r.LAUNCH_M),"launch:yearly":String(r.LAUNCH_Y),"business:monthly":String(r.BIZ_M),"business:yearly":String(r.BIZ_Y)}[`${s}:${n}`];if(!i)return a.NextResponse.json({ok:!1,error:"invalid_plan_term"},{status:400});let u={PRIORITY_SUPPORT:String(r.ADDON_SUPPORT||""),SLA_99_9:String(r.ADDON_SLA||""),WHITE_LABEL:String(r.ADDON_WL||"")},R=[{price:i,quantity:1}].concat(o.map(e=>{let r=u[e];if(!r)throw Error(`missing_addon_price:${e}`);return{price:r,quantity:1}})),E=function(e){if(!e)throw Error("missing STRIPE_SECRET_KEY");return new c.Z(e,{apiVersion:"2024-06-20"})}(r.SECRET),S=await E.checkout.sessions.create({mode:"subscription",line_items:R,allow_promotion_codes:!0,success_url:`${r.SITE_URL}/welcome?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${r.SITE_URL}/pricing?canceled=1`});if(!S.url)return a.NextResponse.json({ok:!1,error:"no_session_url"},{status:500});return a.NextResponse.json({ok:!0,url:S.url})}catch(r){console.error("checkout_error",{message:r?.message,type:r?.type,code:r?.code,param:r?.param,statusCode:r?.statusCode,raw:r?.raw,stack:r?.stack?.substring(0,500)});let e=`${r?.type||"unknown"}: ${r?.message||r}`;return a.NextResponse.json({ok:!1,error:e,debug:{code:r?.code,param:r?.param}},{status:500})}}let S=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/home/runner/workspace/levqor-site/src/app/api/checkout/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:T,serverHooks:I}=S,P="/api/checkout/route";function d(){return(0,i.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:T})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[8948,7070,3059],()=>t(23248));module.exports=s})();