"use strict";exports.id=2114,exports.ids=[2114],exports.modules={83640:(e,t,i)=>{i.d(t,{J:()=>i0});var r=i(19326),n=i(3003),s=i(62315),a=i(78586);class o extends s.$s{constructor(e){super(o.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=o.buildCount(e.source,e.filters)}sql;static [r.Q]="MySqlCountBuilder";[Symbol.toStringTag]="MySqlCountBuilder";session;static buildEmbeddedCount(e,t){return(0,s.i6)`(select count(*) from ${e}${s.i6.raw(" where ").if(t)}${t})`}static buildCount(e,t){return(0,s.i6)`select count(*) as count from ${e}${s.i6.raw(" where ").if(t)}${t}`}then(e,t){return Promise.resolve(this.session.count(this.sql)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}var l=i(2285),c=i(85675),u=i(83596),d=i(7313),h=i(1608),f=i(57745),p=i(80298),m=i(49237),g=i(62413),y=i(35418),b=i(18933);class w{static [r.Q]="MySqlForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,t){this.reference=()=>{let{name:t,columns:i,foreignColumns:r}=e();return{name:t,columns:i,foreignTable:r[0].table,foreignColumns:r}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new v(e,this)}}class v{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static [r.Q]="MySqlForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),r=t.map(e=>e.name),n=i.map(e=>e.name),s=[this.table[b.m],...r,i[0].table[b.m],...n];return e??`${s.join("_")}_fk`}}function S(e,t){return`${e[b.m]}_${t.join("_")}_unique`}class _{constructor(e,t){this.name=t,this.columns=e}static [r.Q]=null;columns;build(e){return new x(e,this.columns,this.name)}}class A{static [r.Q]=null;name;constructor(e){this.name=e}on(...e){return new _(e,this.name)}}class x{constructor(e,t,i){this.table=e,this.columns=t,this.name=i??S(this.table,this.columns.map(e=>e.name))}static [r.Q]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}class T extends y.L{static [r.Q]="MySqlColumnBuilder";foreignKeyConfigs=[];references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,t){return this.config.generated={as:e,type:"always",mode:t?.mode??"virtual"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:r})=>((i,r)=>{let n=new w(()=>({columns:[e],foreignColumns:[i()]}));return r.onUpdate&&n.onUpdate(r.onUpdate),r.onDelete&&n.onDelete(r.onDelete),n.build(t)})(i,r))}}class k extends u.s{constructor(e,t){t.uniqueName||(t.uniqueName=S(e,[t.name])),super(e,t),this.table=e}static [r.Q]="MySqlColumn"}class $ extends T{static [r.Q]="MySqlColumnBuilderWithAutoIncrement";constructor(e,t,i){super(e,t,i),this.config.autoIncrement=!1}autoincrement(){return this.config.autoIncrement=!0,this.config.hasDefault=!0,this}}class E extends k{static [r.Q]="MySqlColumnWithAutoIncrement";autoIncrement=this.config.autoIncrement}class C extends ${static [r.Q]="MySqlBigInt53Builder";constructor(e,t=!1){super(e,"number","MySqlBigInt53"),this.config.unsigned=t}build(e){return new P(e,this.config)}}class P extends E{static [r.Q]="MySqlBigInt53";getSQLType(){return`bigint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class Q extends ${static [r.Q]="MySqlBigInt64Builder";constructor(e,t=!1){super(e,"bigint","MySqlBigInt64"),this.config.unsigned=t}build(e){return new N(e,this.config)}}class N extends E{static [r.Q]="MySqlBigInt64";getSQLType(){return`bigint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return BigInt(e)}}function O(e,t){let{name:i,config:r}=(0,m.An)(e,t);return"number"===r.mode?new C(i,r.unsigned):new Q(i,r.unsigned)}class q extends T{static [r.Q]="MySqlBinaryBuilder";constructor(e,t){super(e,"string","MySqlBinary"),this.config.length=t}build(e){return new I(e,this.config)}}class I extends k{static [r.Q]="MySqlBinary";length=this.config.length;mapFromDriverValue(e){if("string"==typeof e)return e;if(Buffer.isBuffer(e))return e.toString();let t=[];for(let i of e)t.push(49===i?"1":"0");return t.join("")}getSQLType(){return void 0===this.length?"binary":`binary(${this.length})`}}function j(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new q(i,r.length)}class L extends T{static [r.Q]="MySqlBooleanBuilder";constructor(e){super(e,"boolean","MySqlBoolean")}build(e){return new U(e,this.config)}}class U extends k{static [r.Q]="MySqlBoolean";getSQLType(){return"boolean"}mapFromDriverValue(e){return"boolean"==typeof e?e:1===e}}function D(e){return new L(e??"")}class B extends T{static [r.Q]="MySqlCharBuilder";constructor(e,t){super(e,"string","MySqlChar"),this.config.length=t.length,this.config.enum=t.enum}build(e){return new R(e,this.config)}}class R extends k{static [r.Q]="MySqlChar";length=this.config.length;enumValues=this.config.enum;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function M(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new B(i,r)}class K extends T{static [r.Q]="MySqlCustomColumnBuilder";constructor(e,t,i){super(e,"custom","MySqlCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=i}build(e){return new F(e,this.config)}}class F extends k{static [r.Q]="MySqlCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function J(e){return(t,i)=>{let{name:r,config:n}=(0,m.An)(t,i);return new K(r,n,e)}}class H extends T{static [r.Q]="MySqlDateBuilder";constructor(e){super(e,"date","MySqlDate")}build(e){return new z(e,this.config)}}class z extends k{static [r.Q]="MySqlDate";constructor(e,t){super(e,t)}getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}}class W extends T{static [r.Q]="MySqlDateStringBuilder";constructor(e){super(e,"string","MySqlDateString")}build(e){return new V(e,this.config)}}class V extends k{static [r.Q]="MySqlDateString";constructor(e,t){super(e,t)}getSQLType(){return"date"}}function Z(e,t){let{name:i,config:r}=(0,m.An)(e,t);return r?.mode==="string"?new W(i):new H(i)}class G extends T{static [r.Q]="MySqlDateTimeBuilder";constructor(e,t){super(e,"date","MySqlDateTime"),this.config.fsp=t?.fsp}build(e){return new Y(e,this.config)}}class Y extends k{static [r.Q]="MySqlDateTime";fsp;constructor(e,t){super(e,t),this.fsp=t.fsp}getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`datetime${e}`}mapToDriverValue(e){return e.toISOString().replace("T"," ").replace("Z","")}mapFromDriverValue(e){return new Date(e.replace(" ","T")+"Z")}}class X extends T{static [r.Q]="MySqlDateTimeStringBuilder";constructor(e,t){super(e,"string","MySqlDateTimeString"),this.config.fsp=t?.fsp}build(e){return new ee(e,this.config)}}class ee extends k{static [r.Q]="MySqlDateTimeString";fsp;constructor(e,t){super(e,t),this.fsp=t.fsp}getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`datetime${e}`}}function et(e,t){let{name:i,config:r}=(0,m.An)(e,t);return r?.mode==="string"?new X(i,r):new G(i,r)}class ei extends ${static [r.Q]="MySqlDecimalBuilder";constructor(e,t){super(e,"string","MySqlDecimal"),this.config.precision=t?.precision,this.config.scale=t?.scale,this.config.unsigned=t?.unsigned}build(e){return new er(e,this.config)}}class er extends E{static [r.Q]="MySqlDecimal";precision=this.config.precision;scale=this.config.scale;unsigned=this.config.unsigned;mapFromDriverValue(e){return"string"==typeof e?e:String(e)}getSQLType(){let e="";return void 0!==this.precision&&void 0!==this.scale?e+=`decimal(${this.precision},${this.scale})`:void 0===this.precision?e+="decimal":e+=`decimal(${this.precision})`,e="decimal(10,0)"===e||"decimal(10)"===e?"decimal":e,this.unsigned?`${e} unsigned`:e}}class en extends ${static [r.Q]="MySqlDecimalNumberBuilder";constructor(e,t){super(e,"number","MySqlDecimalNumber"),this.config.precision=t?.precision,this.config.scale=t?.scale,this.config.unsigned=t?.unsigned}build(e){return new es(e,this.config)}}class es extends E{static [r.Q]="MySqlDecimalNumber";precision=this.config.precision;scale=this.config.scale;unsigned=this.config.unsigned;mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}mapToDriverValue=String;getSQLType(){let e="";return void 0!==this.precision&&void 0!==this.scale?e+=`decimal(${this.precision},${this.scale})`:void 0===this.precision?e+="decimal":e+=`decimal(${this.precision})`,e="decimal(10,0)"===e||"decimal(10)"===e?"decimal":e,this.unsigned?`${e} unsigned`:e}}class ea extends ${static [r.Q]="MySqlDecimalBigIntBuilder";constructor(e,t){super(e,"bigint","MySqlDecimalBigInt"),this.config.precision=t?.precision,this.config.scale=t?.scale,this.config.unsigned=t?.unsigned}build(e){return new eo(e,this.config)}}class eo extends E{static [r.Q]="MySqlDecimalBigInt";precision=this.config.precision;scale=this.config.scale;unsigned=this.config.unsigned;mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){let e="";return void 0!==this.precision&&void 0!==this.scale?e+=`decimal(${this.precision},${this.scale})`:void 0===this.precision?e+="decimal":e+=`decimal(${this.precision})`,e="decimal(10,0)"===e||"decimal(10)"===e?"decimal":e,this.unsigned?`${e} unsigned`:e}}function el(e,t={}){let{name:i,config:r}=(0,m.An)(e,t),n=r?.mode;return"number"===n?new en(i,r):"bigint"===n?new ea(i,r):new ei(i,r)}class ec extends ${static [r.Q]="MySqlDoubleBuilder";constructor(e,t){super(e,"number","MySqlDouble"),this.config.precision=t?.precision,this.config.scale=t?.scale,this.config.unsigned=t?.unsigned}build(e){return new eu(e,this.config)}}class eu extends E{static [r.Q]="MySqlDouble";precision=this.config.precision;scale=this.config.scale;unsigned=this.config.unsigned;getSQLType(){let e="";return void 0!==this.precision&&void 0!==this.scale?e+=`double(${this.precision},${this.scale})`:void 0===this.precision?e+="double":e+=`double(${this.precision})`,this.unsigned?`${e} unsigned`:e}}function ed(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new ec(i,r)}class eh extends T{static [r.Q]="MySqlEnumColumnBuilder";constructor(e,t){super(e,"string","MySqlEnumColumn"),this.config.enumValues=t}build(e){return new ef(e,this.config)}}class ef extends k{static [r.Q]="MySqlEnumColumn";enumValues=this.config.enumValues;getSQLType(){return`enum(${this.enumValues.map(e=>`'${e}'`).join(",")})`}}class ep extends T{static [r.Q]="MySqlEnumObjectColumnBuilder";constructor(e,t){super(e,"string","MySqlEnumObjectColumn"),this.config.enumValues=t}build(e){return new em(e,this.config)}}class em extends k{static [r.Q]="MySqlEnumObjectColumn";enumValues=this.config.enumValues;getSQLType(){return`enum(${this.enumValues.map(e=>`'${e}'`).join(",")})`}}function eg(e,t){if("string"==typeof e&&Array.isArray(t)||Array.isArray(e)){let i="string"==typeof e&&e.length>0?e:"",r=("string"==typeof e?t:e)??[];if(0===r.length)throw Error(`You have an empty array for "${i}" enum values`);return new eh(i,r)}if("string"==typeof e&&"object"==typeof t||"object"==typeof e){let i="object"==typeof e?"":e,r="object"==typeof e?Object.values(e):"object"==typeof t?Object.values(t):[];if(0===r.length)throw Error(`You have an empty array for "${i}" enum values`);return new ep(i,r)}}class ey extends ${static [r.Q]="MySqlFloatBuilder";constructor(e,t){super(e,"number","MySqlFloat"),this.config.precision=t?.precision,this.config.scale=t?.scale,this.config.unsigned=t?.unsigned}build(e){return new eb(e,this.config)}}class eb extends E{static [r.Q]="MySqlFloat";precision=this.config.precision;scale=this.config.scale;unsigned=this.config.unsigned;getSQLType(){let e="";return void 0!==this.precision&&void 0!==this.scale?e+=`float(${this.precision},${this.scale})`:void 0===this.precision?e+="float":e+=`float(${this.precision})`,this.unsigned?`${e} unsigned`:e}}function ew(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new ey(i,r)}class ev extends ${static [r.Q]="MySqlIntBuilder";constructor(e,t){super(e,"number","MySqlInt"),this.config.unsigned=!!t&&t.unsigned}build(e){return new eS(e,this.config)}}class eS extends E{static [r.Q]="MySqlInt";getSQLType(){return`int${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}}function e_(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new ev(i,r)}class eA extends T{static [r.Q]="MySqlJsonBuilder";constructor(e){super(e,"json","MySqlJson")}build(e){return new ex(e,this.config)}}class ex extends k{static [r.Q]="MySqlJson";getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}}function eT(e){return new eA(e??"")}class ek extends ${static [r.Q]="MySqlMediumIntBuilder";constructor(e,t){super(e,"number","MySqlMediumInt"),this.config.unsigned=!!t&&t.unsigned}build(e){return new e$(e,this.config)}}class e$ extends E{static [r.Q]="MySqlMediumInt";getSQLType(){return`mediumint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}}function eE(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new ek(i,r)}class eC extends ${static [r.Q]="MySqlRealBuilder";constructor(e,t){super(e,"number","MySqlReal"),this.config.precision=t?.precision,this.config.scale=t?.scale}build(e){return new eP(e,this.config)}}class eP extends E{static [r.Q]="MySqlReal";precision=this.config.precision;scale=this.config.scale;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`real(${this.precision}, ${this.scale})`:void 0===this.precision?"real":`real(${this.precision})`}}function eQ(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new eC(i,r)}class eN extends ${static [r.Q]="MySqlSerialBuilder";constructor(e){super(e,"number","MySqlSerial"),this.config.hasDefault=!0,this.config.autoIncrement=!0}build(e){return new eO(e,this.config)}}class eO extends E{static [r.Q]="MySqlSerial";getSQLType(){return"serial"}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}}function eq(e){return new eN(e??"")}class eI extends ${static [r.Q]="MySqlSmallIntBuilder";constructor(e,t){super(e,"number","MySqlSmallInt"),this.config.unsigned=!!t&&t.unsigned}build(e){return new ej(e,this.config)}}class ej extends E{static [r.Q]="MySqlSmallInt";getSQLType(){return`smallint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}}function eL(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new eI(i,r)}class eU extends T{static [r.Q]="MySqlTextBuilder";constructor(e,t,i){super(e,"string","MySqlText"),this.config.textType=t,this.config.enumValues=i.enum}build(e){return new eD(e,this.config)}}class eD extends k{static [r.Q]="MySqlText";textType=this.config.textType;enumValues=this.config.enumValues;getSQLType(){return this.textType}}function eB(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new eU(i,"text",r)}function eR(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new eU(i,"tinytext",r)}function eM(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new eU(i,"mediumtext",r)}function eK(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return new eU(i,"longtext",r)}class eF extends T{static [r.Q]="MySqlTimeBuilder";constructor(e,t){super(e,"string","MySqlTime"),this.config.fsp=t?.fsp}build(e){return new eJ(e,this.config)}}class eJ extends k{static [r.Q]="MySqlTime";fsp=this.config.fsp;getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`time${e}`}}function eH(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new eF(i,r)}class ez extends T{static [r.Q]="MySqlDateColumnBuilder";defaultNow(){return this.default((0,s.i6)`(now())`)}onUpdateNow(){return this.config.hasOnUpdateNow=!0,this.config.hasDefault=!0,this}}class eW extends k{static [r.Q]="MySqlDateColumn";hasOnUpdateNow=this.config.hasOnUpdateNow}class eV extends ez{static [r.Q]="MySqlTimestampBuilder";constructor(e,t){super(e,"date","MySqlTimestamp"),this.config.fsp=t?.fsp}build(e){return new eZ(e,this.config)}}class eZ extends eW{static [r.Q]="MySqlTimestamp";fsp=this.config.fsp;getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`timestamp${e}`}mapFromDriverValue(e){return new Date(e+"+0000")}mapToDriverValue(e){return e.toISOString().slice(0,-1).replace("T"," ")}}class eG extends ez{static [r.Q]="MySqlTimestampStringBuilder";constructor(e,t){super(e,"string","MySqlTimestampString"),this.config.fsp=t?.fsp}build(e){return new eY(e,this.config)}}class eY extends eW{static [r.Q]="MySqlTimestampString";fsp=this.config.fsp;getSQLType(){let e=void 0===this.fsp?"":`(${this.fsp})`;return`timestamp${e}`}}function eX(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return r?.mode==="string"?new eG(i,r):new eV(i,r)}class e0 extends ${static [r.Q]="MySqlTinyIntBuilder";constructor(e,t){super(e,"number","MySqlTinyInt"),this.config.unsigned=!!t&&t.unsigned}build(e){return new e1(e,this.config)}}class e1 extends E{static [r.Q]="MySqlTinyInt";getSQLType(){return`tinyint${this.config.unsigned?" unsigned":""}`}mapFromDriverValue(e){return"string"==typeof e?Number(e):e}}function e6(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new e0(i,r)}class e2 extends T{static [r.Q]="MySqlVarBinaryBuilder";constructor(e,t){super(e,"string","MySqlVarBinary"),this.config.length=t?.length}build(e){return new e5(e,this.config)}}class e5 extends k{static [r.Q]="MySqlVarBinary";length=this.config.length;mapFromDriverValue(e){if("string"==typeof e)return e;if(Buffer.isBuffer(e))return e.toString();let t=[];for(let i of e)t.push(49===i?"1":"0");return t.join("")}getSQLType(){return void 0===this.length?"varbinary":`varbinary(${this.length})`}}function e8(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new e2(i,r)}class e3 extends T{static [r.Q]="MySqlVarCharBuilder";constructor(e,t){super(e,"string","MySqlVarChar"),this.config.length=t.length,this.config.enum=t.enum}build(e){return new e4(e,this.config)}}class e4 extends k{static [r.Q]="MySqlVarChar";length=this.config.length;enumValues=this.config.enum;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function e9(e,t){let{name:i,config:r}=(0,m.An)(e,t);return new e3(i,r)}class e7 extends T{static [r.Q]="MySqlYearBuilder";constructor(e){super(e,"number","MySqlYear")}build(e){return new te(e,this.config)}}class te extends k{static [r.Q]="MySqlYear";getSQLType(){return"year"}}function tt(e){return new e7(e??"")}let ti=Symbol.for("drizzle:MySqlInlineForeignKeys");class tr extends p.iA{static [r.Q]="MySqlTable";static Symbol=Object.assign({},p.iA.Symbol,{InlineForeignKeys:ti});[p.iA.Symbol.Columns];[ti]=[];[p.iA.Symbol.ExtraConfigBuilder]=void 0}let tn=(e,t,i)=>(function(e,t,i,r,n=e){let s=new tr(e,r,n),a=Object.fromEntries(Object.entries("function"==typeof t?t({bigint:O,binary:j,boolean:D,char:M,customType:J,date:Z,datetime:et,decimal:el,double:ed,mysqlEnum:eg,float:ew,int:e_,json:eT,mediumint:eE,real:eQ,serial:eq,smallint:eL,text:eB,time:eH,timestamp:eX,tinyint:e6,varbinary:e8,varchar:e9,year:tt,longtext:eK,mediumtext:eM,tinytext:eR}):t).map(([e,t])=>{t.setName(e);let i=t.build(s);return s[ti].push(...t.buildForeignKeys(i,s)),[e,i]})),o=Object.assign(s,a);return o[p.iA.Symbol.Columns]=a,o[p.iA.Symbol.ExtraConfigColumns]=a,i&&(o[tr.Symbol.ExtraConfigBuilder]=i),o})(e,t,i,void 0,e);class ts extends s.G7{static [r.Q]="MySqlViewBase"}class ta{static [r.Q]="MySqlDialect";casing;constructor(e){this.casing=new c.xC(e?.casing)}async migrate(e,t,i){let r=i.migrationsTable??"__drizzle_migrations",n=(0,s.i6)`
			create table if not exists ${s.i6.identifier(r)} (
				id serial primary key,
				hash text not null,
				created_at bigint
			)
		`;await t.execute(n);let a=(await t.all((0,s.i6)`select id, hash, created_at from ${s.i6.identifier(r)} order by created_at desc limit 1`))[0];await t.transaction(async t=>{for(let i of e)if(!a||Number(a.created_at)<i.folderMillis){for(let e of i.sql)await t.execute(s.i6.raw(e));await t.execute((0,s.i6)`insert into ${s.i6.identifier(r)} (\`hash\`, \`created_at\`) values(${i.hash}, ${i.folderMillis})`)}})}escapeName(e){return`\`${e}\``}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[(0,s.i6)`with `];for(let[i,r]of e.entries())t.push((0,s.i6)`${s.i6.identifier(r._.alias)} as (${r._.sql})`),i<e.length-1&&t.push((0,s.i6)`, `);return t.push((0,s.i6)` `),s.i6.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:r,limit:n,orderBy:a}){let o=this.buildWithCTE(r),l=i?(0,s.i6)` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,c=t?(0,s.i6)` where ${t}`:void 0,u=this.buildOrderBy(a),d=this.buildLimit(n);return(0,s.i6)`${o}delete from ${e}${c}${u}${d}${l}`}buildUpdateSet(e,t){let i=e[p.iA.Symbol.Columns],r=Object.keys(i).filter(e=>void 0!==t[e]||i[e]?.onUpdateFn!==void 0),n=r.length;return s.i6.join(r.flatMap((e,r)=>{let a=i[e],o=t[e]??s.i6.param(a.onUpdateFn(),a),l=(0,s.i6)`${s.i6.identifier(this.casing.getColumnCasing(a))} = ${o}`;return r<n-1?[l,s.i6.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:i,returning:r,withList:n,limit:a,orderBy:o}){let l=this.buildWithCTE(n),c=this.buildUpdateSet(e,t),u=r?(0,s.i6)` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,d=i?(0,s.i6)` where ${i}`:void 0,h=this.buildOrderBy(o),f=this.buildLimit(a);return(0,s.i6)`${l}update ${e} set ${c}${d}${h}${f}${u}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,n=e.flatMap(({field:e},n)=>{let a=[];if((0,r.is)(e,s.$s.Aliased)&&e.isSelectionField)a.push(s.i6.identifier(e.fieldAlias));else if((0,r.is)(e,s.$s.Aliased)||(0,r.is)(e,s.$s)){let i=(0,r.is)(e,s.$s.Aliased)?e.sql:e;t?a.push(new s.$s(i.queryChunks.map(e=>(0,r.is)(e,k)?s.i6.identifier(this.casing.getColumnCasing(e)):e))):a.push(i),(0,r.is)(e,s.$s.Aliased)&&a.push((0,s.i6)` as ${s.i6.identifier(e.fieldAlias)}`)}else(0,r.is)(e,u.s)&&(t?a.push(s.i6.identifier(this.casing.getColumnCasing(e))):a.push(e));return n<i-1&&a.push((0,s.i6)`, `),a});return s.i6.join(n)}buildLimit(e){return"object"==typeof e||"number"==typeof e&&e>=0?(0,s.i6)` limit ${e}`:void 0}buildOrderBy(e){return e&&e.length>0?(0,s.i6)` order by ${s.i6.join(e,(0,s.i6)`, `)}`:void 0}buildIndex({indexes:e,indexFor:t}){return e&&e.length>0?(0,s.i6)` ${s.i6.raw(t)} INDEX (${s.i6.raw(e.join(", "))})`:void 0}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:n,having:o,table:l,joins:c,orderBy:d,groupBy:h,limit:f,offset:y,lockingClause:b,distinct:w,setOperators:v,useIndex:S,forceIndex:_,ignoreIndex:A}){let x;let T=i??(0,m.ZS)(t);for(let e of T){let t;if((0,r.is)(e.field,u.s)&&(0,p.SP)(e.field.table)!==((0,r.is)(l,a.k)?l._.alias:(0,r.is)(l,ts)?l[g.d].name:(0,r.is)(l,s.$s)?void 0:(0,p.SP)(l))&&(t=e.field.table,!c?.some(({alias:e})=>e===(t[p.iA.Symbol.IsAlias]?p.SP(t):t[p.iA.Symbol.BaseName])))){let t=(0,p.SP)(e.field.table);throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let k=!c||0===c.length,$=this.buildWithCTE(e),E=w?(0,s.i6)` distinct`:void 0,C=this.buildSelection(T,{isSingleTable:k}),P=(0,r.is)(l,p.iA)&&l[p.iA.Symbol.IsAlias]?(0,s.i6)`${(0,s.i6)`${s.i6.identifier(l[p.iA.Symbol.Schema]??"")}.`.if(l[p.iA.Symbol.Schema])}${s.i6.identifier(l[p.iA.Symbol.OriginalName])} ${s.i6.identifier(l[p.iA.Symbol.Name])}`:l,Q=[];if(c)for(let[e,t]of c.entries()){0===e&&Q.push((0,s.i6)` `);let i=t.table,n=t.lateral?(0,s.i6)` lateral`:void 0,a=t.on?(0,s.i6)` on ${t.on}`:void 0;if((0,r.is)(i,tr)){let e=i[tr.Symbol.Name],r=i[tr.Symbol.Schema],o=i[tr.Symbol.OriginalName],l=e===o?void 0:t.alias,c=this.buildIndex({indexes:t.useIndex,indexFor:"USE"}),u=this.buildIndex({indexes:t.forceIndex,indexFor:"FORCE"}),d=this.buildIndex({indexes:t.ignoreIndex,indexFor:"IGNORE"});Q.push((0,s.i6)`${s.i6.raw(t.joinType)} join${n} ${r?(0,s.i6)`${s.i6.identifier(r)}.`:void 0}${s.i6.identifier(o)}${c}${u}${d}${l&&(0,s.i6)` ${s.i6.identifier(l)}`}${a}`)}else if((0,r.is)(i,s.G7)){let e=i[g.d].name,r=i[g.d].schema,o=i[g.d].originalName,l=e===o?void 0:t.alias;Q.push((0,s.i6)`${s.i6.raw(t.joinType)} join${n} ${r?(0,s.i6)`${s.i6.identifier(r)}.`:void 0}${s.i6.identifier(o)}${l&&(0,s.i6)` ${s.i6.identifier(l)}`}${a}`)}else Q.push((0,s.i6)`${s.i6.raw(t.joinType)} join${n} ${i}${a}`);e<c.length-1&&Q.push((0,s.i6)` `)}let N=s.i6.join(Q),O=n?(0,s.i6)` where ${n}`:void 0,q=o?(0,s.i6)` having ${o}`:void 0,I=this.buildOrderBy(d),j=h&&h.length>0?(0,s.i6)` group by ${s.i6.join(h,(0,s.i6)`, `)}`:void 0,L=this.buildLimit(f),U=y?(0,s.i6)` offset ${y}`:void 0,D=this.buildIndex({indexes:S,indexFor:"USE"}),B=this.buildIndex({indexes:_,indexFor:"FORCE"}),R=this.buildIndex({indexes:A,indexFor:"IGNORE"});if(b){let{config:e,strength:t}=b;x=(0,s.i6)` for ${s.i6.raw(t)}`,e.noWait?x.append((0,s.i6)` nowait`):e.skipLocked&&x.append((0,s.i6)` skip locked`)}let M=(0,s.i6)`${$}select${E} ${C} from ${P}${D}${B}${R}${N}${O}${j}${q}${I}${L}${U}${x}`;return v.length>0?this.buildSetOperations(M,v):M}buildSetOperations(e,t){let[i,...r]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===r.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),r)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:n,limit:a,orderBy:o,offset:l}}){let c;let u=(0,s.i6)`(${e.getSQL()}) `,d=(0,s.i6)`(${n.getSQL()})`;if(o&&o.length>0){let e=[];for(let t of o)if((0,r.is)(t,k))e.push(s.i6.identifier(this.casing.getColumnCasing(t)));else if((0,r.is)(t,s.$s)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];(0,r.is)(i,k)&&(t.queryChunks[e]=s.i6.identifier(this.casing.getColumnCasing(i)))}e.push((0,s.i6)`${t}`)}else e.push((0,s.i6)`${t}`);c=(0,s.i6)` order by ${s.i6.join(e,(0,s.i6)`, `)} `}let h="object"==typeof a||"number"==typeof a&&a>=0?(0,s.i6)` limit ${a}`:void 0,f=s.i6.raw(`${t} ${i?"all ":""}`),p=l?(0,s.i6)` offset ${l}`:void 0;return(0,s.i6)`${u}${f}${d}${c}${h}${p}`}buildInsertQuery({table:e,values:t,ignore:i,onConflict:n,select:a}){let o=[],l=Object.entries(e[p.iA.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),c=l.map(([,e])=>s.i6.identifier(this.casing.getColumnCasing(e))),u=[];if(a)(0,r.is)(t,s.$s)?o.push(t):o.push(t.getSQL());else for(let[e,i]of(o.push(s.i6.raw("values ")),t.entries())){let n={},a=[];for(let[e,t]of l){let o=i[e];if(void 0===o||(0,r.is)(o,s.dO)&&void 0===o.value){if(void 0!==t.defaultFn){let i=t.defaultFn();n[e]=i;let o=(0,r.is)(i,s.$s)?i:s.i6.param(i,t);a.push(o)}else if(t.default||void 0===t.onUpdateFn)a.push((0,s.i6)`default`);else{let e=t.onUpdateFn(),i=(0,r.is)(e,s.$s)?e:s.i6.param(e,t);a.push(i)}}else t.defaultFn&&(0,r.is)(o,s.dO)&&(n[e]=o.value),a.push(o)}u.push(n),o.push(a),e<t.length-1&&o.push((0,s.i6)`, `)}let d=s.i6.join(o),h=i?(0,s.i6)` ignore`:void 0,f=n?(0,s.i6)` on duplicate key ${n}`:void 0;return{sql:(0,s.i6)`insert${h} into ${e} ${c} ${d}${f}`,generatedIds:u}}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:t})}buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:n,tableConfig:o,queryConfig:c,tableAlias:m,nestedQueryRelation:g,joinOn:y}){let b,w,v,S,_,A=[],x=[];if(!0===c)A=Object.entries(o.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:(0,l.lw)(t,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let n=Object.fromEntries(Object.entries(o.columns).map(([e,t])=>[e,(0,l.lw)(t,m)]));if(c.where){let e="function"==typeof c.where?c.where(n,(0,h.vU)()):c.where;S=e&&(0,l.UI)(e,m)}let d=[],g=[];if(c.columns){let e=!1;for(let[t,i]of Object.entries(c.columns))void 0!==i&&t in o.columns&&(e||!0!==i||(e=!0),g.push(t));g.length>0&&(g=e?g.filter(e=>c.columns?.[e]===!0):Object.keys(o.columns).filter(e=>!g.includes(e)))}else g=Object.keys(o.columns);for(let e of g){let t=o.columns[e];d.push({tsKey:e,value:t})}let y=[];if(c.with&&(y=Object.entries(c.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:o.relations[e]}))),c.extras)for(let[e,t]of Object.entries("function"==typeof c.extras?c.extras(n,{sql:s.i6}):c.extras))d.push({tsKey:e,value:(0,l.qD)(t,m)});for(let{tsKey:e,value:t}of d)A.push({dbKey:(0,r.is)(t,s.$s.Aliased)?t.fieldAlias:o.columns[e].name,tsKey:e,field:(0,r.is)(t,u.s)?(0,l.lw)(t,m):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let _="function"==typeof c.orderBy?c.orderBy(n,(0,h.pl)()):c.orderBy??[];for(let{tsKey:n,queryConfig:o,relation:d}of(Array.isArray(_)||(_=[_]),v=_.map(e=>(0,r.is)(e,u.s)?(0,l.lw)(e,m):(0,l.UI)(e,m)),b=c.limit,w=c.offset,y)){let c=(0,h.wG)(t,i,d),u=i[(0,p.Q0)(d.referencedTable)],g=`${m}_${n}`,y=(0,f.xD)(...c.fields.map((e,t)=>(0,f.eq)((0,l.lw)(c.references[t],g),(0,l.lw)(e,m)))),b=this.buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:e[u],tableConfig:t[u],queryConfig:(0,r.is)(d,h.fh)?!0===o?{limit:1}:{...o,limit:1}:o,tableAlias:g,joinOn:y,nestedQueryRelation:d}),w=(0,s.i6)`${s.i6.identifier(g)}.${s.i6.identifier("data")}`.as(n);x.push({on:(0,s.i6)`true`,table:new a.k(b.sql,{},g),alias:g,joinType:"left",lateral:!0}),A.push({dbKey:n,tsKey:n,field:w,relationTableTsKey:u,isJson:!0,selection:b.selection})}}if(0===A.length)throw new d.kR({message:`No fields selected for table "${o.tsName}" ("${m}")`});if(S=(0,f.xD)(y,S),g){let e=(0,s.i6)`json_array(${s.i6.join(A.map(({field:e,tsKey:t,isJson:i})=>i?(0,s.i6)`${s.i6.identifier(`${m}_${t}`)}.${s.i6.identifier("data")}`:(0,r.is)(e,s.$s.Aliased)?e.sql:e),(0,s.i6)`, `)})`;(0,r.is)(g,h.sj)&&(e=(0,s.i6)`coalesce(json_arrayagg(${e}), json_array())`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:A}];void 0!==b||void 0!==w||(v?.length??0)>0?(_=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:[{path:[],field:s.i6.raw("*")},...(v?.length??0)>0?[{path:[],field:(0,s.i6)`row_number() over (order by ${s.i6.join(v,(0,s.i6)`, `)})`}]:[]],where:S,limit:b,offset:w,setOperators:[]}),S=void 0,b=void 0,w=void 0,v=void 0):_=(0,l.RQ)(n,m),_=this.buildSelectQuery({table:(0,r.is)(_,tr)?_:new a.k(_,{},m),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),joins:x,where:S,limit:b,offset:w,orderBy:v,setOperators:[]})}else _=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:A.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),joins:x,where:S,limit:b,offset:w,orderBy:v,setOperators:[]});return{tableTsKey:o.tsName,sql:_,selection:A}}buildRelationalQueryWithoutLateralSubqueries({fullSchema:e,schema:t,tableNamesMap:i,table:n,tableConfig:o,queryConfig:c,tableAlias:m,nestedQueryRelation:g,joinOn:y}){let b,w=[],v,S,_=[],A;if(!0===c)w=Object.entries(o.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:(0,l.lw)(t,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let n=Object.fromEntries(Object.entries(o.columns).map(([e,t])=>[e,(0,l.lw)(t,m)]));if(c.where){let e="function"==typeof c.where?c.where(n,(0,h.vU)()):c.where;A=e&&(0,l.UI)(e,m)}let a=[],d=[];if(c.columns){let e=!1;for(let[t,i]of Object.entries(c.columns))void 0!==i&&t in o.columns&&(e||!0!==i||(e=!0),d.push(t));d.length>0&&(d=e?d.filter(e=>c.columns?.[e]===!0):Object.keys(o.columns).filter(e=>!d.includes(e)))}else d=Object.keys(o.columns);for(let e of d){let t=o.columns[e];a.push({tsKey:e,value:t})}let g=[];if(c.with&&(g=Object.entries(c.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:o.relations[e]}))),c.extras)for(let[e,t]of Object.entries("function"==typeof c.extras?c.extras(n,{sql:s.i6}):c.extras))a.push({tsKey:e,value:(0,l.qD)(t,m)});for(let{tsKey:e,value:t}of a)w.push({dbKey:(0,r.is)(t,s.$s.Aliased)?t.fieldAlias:o.columns[e].name,tsKey:e,field:(0,r.is)(t,u.s)?(0,l.lw)(t,m):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let y="function"==typeof c.orderBy?c.orderBy(n,(0,h.pl)()):c.orderBy??[];for(let{tsKey:n,queryConfig:a,relation:o}of(Array.isArray(y)||(y=[y]),_=y.map(e=>(0,r.is)(e,u.s)?(0,l.lw)(e,m):(0,l.UI)(e,m)),v=c.limit,S=c.offset,g)){let c=(0,h.wG)(t,i,o),u=i[(0,p.Q0)(o.referencedTable)],d=`${m}_${n}`,g=(0,f.xD)(...c.fields.map((e,t)=>(0,f.eq)((0,l.lw)(c.references[t],d),(0,l.lw)(e,m)))),y=this.buildRelationalQueryWithoutLateralSubqueries({fullSchema:e,schema:t,tableNamesMap:i,table:e[u],tableConfig:t[u],queryConfig:(0,r.is)(o,h.fh)?!0===a?{limit:1}:{...a,limit:1}:a,tableAlias:d,joinOn:g,nestedQueryRelation:o}),b=(0,s.i6)`(${y.sql})`;(0,r.is)(o,h.sj)&&(b=(0,s.i6)`coalesce(${b}, json_array())`);let v=b.as(n);w.push({dbKey:n,tsKey:n,field:v,relationTableTsKey:u,isJson:!0,selection:y.selection})}}if(0===w.length)throw new d.kR({message:`No fields selected for table "${o.tsName}" ("${m}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(A=(0,f.xD)(y,A),g){let e=(0,s.i6)`json_array(${s.i6.join(w.map(({field:e})=>(0,r.is)(e,k)?s.i6.identifier(this.casing.getColumnCasing(e)):(0,r.is)(e,s.$s.Aliased)?e.sql:e),(0,s.i6)`, `)})`;(0,r.is)(g,h.sj)&&(e=(0,s.i6)`json_arrayagg(${e})`);let t=[{dbKey:"data",tsKey:"data",field:e,isJson:!0,relationTableTsKey:o.tsName,selection:w}];void 0!==v||void 0!==S||_.length>0?(b=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:[{path:[],field:s.i6.raw("*")},..._.length>0?[{path:[],field:(0,s.i6)`row_number() over (order by ${s.i6.join(_,(0,s.i6)`, `)})`}]:[]],where:A,limit:v,offset:S,setOperators:[]}),A=void 0,v=void 0,S=void 0,_=void 0):b=(0,l.RQ)(n,m),b=this.buildSelectQuery({table:(0,r.is)(b,tr)?b:new a.k(b,{},m),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),where:A,limit:v,offset:S,orderBy:_,setOperators:[]})}else b=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:w.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),where:A,limit:v,offset:S,orderBy:_,setOperators:[]});return{tableTsKey:o.tsName,sql:b,selection:w}}}var to=i(88282),tl=i(9193);function tc(e){return(0,r.is)(e,tr)?[`${e[p.iA.Symbol.BaseName]}`]:(0,r.is)(e,a.k)?e._.usedTables??[]:(0,r.is)(e,s.$s)?e.usedTables??[]:[]}function tu(e){return e.map(e=>"object"==typeof e?e.config.name:e)}function td(e){return Array.isArray(e)?e:[e]}class th{static [r.Q]="MySqlSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}from(e,t){let i;let n=!!this.fields;i=this.fields?this.fields:(0,r.is)(e,a.k)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):(0,r.is)(e,ts)?e[g.d].selectedFields:(0,r.is)(e,s.$s)?{}:(0,m.SS)(e);let o=[],l=[],c=[];return(0,r.is)(e,tr)&&t&&"string"!=typeof t&&(t.useIndex&&(o=tu(td(t.useIndex))),t.forceIndex&&(l=tu(td(t.forceIndex))),t.ignoreIndex&&(c=tu(td(t.ignoreIndex)))),new tp({table:e,fields:i,isPartialSelect:n,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct,useIndex:o,forceIndex:l,ignoreIndex:c})}}class tf extends to.b{static [r.Q]="MySqlSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:i,session:r,dialect:n,withList:s,distinct:a,useIndex:o,forceIndex:l,ignoreIndex:c}){for(let u of(super(),this.config={withList:s,table:e,fields:{...t},distinct:a,setOperators:[],useIndex:o,forceIndex:l,ignoreIndex:c},this.isPartialSelect=i,this.session=r,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=(0,m.dP)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},tc(e)))this.usedTables.add(u)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(i,o,l)=>{let c="cross"===e,u=c?void 0:o,d=c?o:l,h=this.tableName,f=(0,m.dP)(i);for(let e of tc(i))this.usedTables.add(e);if("string"==typeof f&&this.config.joins?.some(e=>e.alias===f))throw Error(`Alias "${f}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof h&&(this.config.fields={[h]:this.config.fields}),"string"==typeof f&&!(0,r.is)(i,s.$s))){let e=(0,r.is)(i,a.k)?i._.selectedFields:(0,r.is)(i,s.G7)?i[g.d].selectedFields:i[p.iA.Symbol.Columns];this.config.fields[f]=e}"function"==typeof u&&(u=u(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]);let y=[],b=[],w=[];if((0,r.is)(i,tr)&&d&&"string"!=typeof d&&(d.useIndex&&(y=tu(td(d.useIndex))),d.forceIndex&&(b=tu(td(d.forceIndex))),d.ignoreIndex&&(w=tu(td(d.ignoreIndex)))),this.config.joins.push({on:u,table:i,joinType:e,alias:f,useIndex:y,forceIndex:b,ignoreIndex:w,lateral:t}),"string"==typeof f)switch(e){case"left":this.joinsNotNullableMap[f]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[f]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[f]=!0}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return i=>{let r="function"==typeof i?i(tg()):i;if(!(0,m.ux)(this.getSelectedFields(),r.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:r}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...tc(this.config.table)),this.config.joins)for(let e of this.config.joins)t.push(...tc(e.table));return new Proxy(new a.k(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new n.e({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=void 0===e?{config:{},enable:!0,autoInvalidate:!0}:!1===e?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}}class tp extends tf{static [r.Q]="MySqlSelect";prepare(){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let e=(0,m.ZS)(this.config.fields),t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),e,void 0,void 0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}execute=e=>this.prepare().execute(e);createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}};iterator=this.createIterator()}function tm(e,t){return(i,r,...n)=>{let s=[r,...n].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of s)if(!(0,m.ux)(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(s)}}(0,m.ef)(tp,[tl.N]);let tg=()=>({union:ty,unionAll:tb,intersect:tw,intersectAll:tv,except:tS,exceptAll:t_}),ty=tm("union",!1),tb=tm("union",!0),tw=tm("intersect",!1),tv=tm("intersect",!0),tS=tm("except",!1),t_=tm("except",!0);class tA{static [r.Q]="MySqlQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=(0,r.is)(e,ta)?e:void 0,this.dialectConfig=(0,r.is)(e,ta)?void 0:e}$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(i)),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(i){return new th({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(i){return new th({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}}}select(e){return new th({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new th({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new ta(this.dialectConfig)),this.dialect}}class tx{constructor(e,t,i,r){this.table=e,this.session=t,this.dialect=i,this.withList=r}static [r.Q]="MySqlUpdateBuilder";set(e){return new tT(this.table,(0,m.M6)(this.table,e),this.session,this.dialect,this.withList)}}class tT extends tl.N{constructor(e,t,i,r,n){super(),this.session=i,this.dialect=r,this.config={set:t,table:e,withList:n}}static [r.Q]="MySqlUpdate";config;cacheConfig;where(e){return this.config.where=e,this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.table[p.iA.Symbol.Columns],new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.orderBy=i}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,void 0,void 0,this.config.returning,{type:"insert",tables:tc(this.config.table)},this.cacheConfig)}execute=e=>this.prepare().execute(e);createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}};iterator=this.createIterator();$dynamic(){return this}}class tk extends tl.N{constructor(e,t,i,r){super(),this.table=e,this.session=t,this.dialect=i,this.config={table:e,withList:r}}static [r.Q]="MySqlDelete";config;where(e){return this.config.where=e,this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.table[p.iA.Symbol.Columns],new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.orderBy=i}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,void 0,void 0,void 0,{type:"delete",tables:tc(this.config.table)})}execute=e=>this.prepare().execute(e);createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}};iterator=this.createIterator();$dynamic(){return this}}class t${constructor(e,t,i){this.table=e,this.session=t,this.dialect=i}static [r.Q]="MySqlInsertBuilder";shouldIgnore=!1;ignore(){return this.shouldIgnore=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[p.iA.Symbol.Columns];for(let n of Object.keys(e)){let a=e[n];t[n]=(0,r.is)(a,s.$s)?a:new s.dO(a,i[n])}return t});return new tE(this.table,t,this.shouldIgnore,this.session,this.dialect)}select(e){let t="function"==typeof e?e(new tA):e;if(!(0,r.is)(t,s.$s)&&!(0,m.ux)(this.table[p.oe],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new tE(this.table,t,this.shouldIgnore,this.session,this.dialect,!0)}}class tE extends tl.N{constructor(e,t,i,r,n,s){super(),this.session=r,this.dialect=n,this.config={table:e,values:t,select:s,ignore:i}}static [r.Q]="MySqlInsert";config;cacheConfig;onDuplicateKeyUpdate(e){let t=this.dialect.buildUpdateSet(this.config.table,(0,m.M6)(this.config.table,e.set));return this.config.onConflict=(0,s.i6)`update ${t}`,this}$returningId(){let e=[];for(let[t,i]of Object.entries(this.config.table[p.iA.Symbol.Columns]))i.primary&&e.push({field:i,path:[t]});return this.config.returning=e,this}getSQL(){return this.dialect.buildInsertQuery(this.config).sql}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}prepare(){let{sql:e,generatedIds:t}=this.dialect.buildInsertQuery(this.config);return this.session.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,t,this.config.returning,{type:"insert",tables:tc(this.config.table)},this.cacheConfig)}execute=e=>this.prepare().execute(e);createIterator=()=>{let e=this;return async function*(t){yield*e.prepare().iterator(t)}};iterator=this.createIterator();$dynamic(){return this}}class tC{constructor(e,t,i,r,n,s,a,o){this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=r,this.tableConfig=n,this.dialect=s,this.session=a,this.mode=o}static [r.Q]="MySqlRelationalQueryBuilder";findMany(e){return new tP(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many",this.mode)}findFirst(e){return new tP(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first",this.mode)}}class tP extends tl.N{constructor(e,t,i,r,n,s,a,o,l,c){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=r,this.tableConfig=n,this.dialect=s,this.session=a,this.config=o,this.queryMode=l,this.mode=c}static [r.Q]="MySqlRelationalQuery";prepare(){let{query:e,builtQuery:t}=this._toSQL();return this.session.prepareQuery(t,void 0,t=>{let i=t.map(t=>(0,h.WX)(this.schema,this.tableConfig,t,e.selection));return"first"===this.queryMode?i[0]:i})}_getQuery(){return"planetscale"===this.mode?this.dialect.buildRelationalQueryWithoutLateralSubqueries({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}):this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}_toSQL(){let e=this._getQuery();return{builtQuery:this.dialect.sqlToQuery(e.sql),query:e}}getSQL(){return this._getQuery().sql}toSQL(){return this._toSQL().builtQuery}execute(){return this.prepare().execute()}}class tQ{constructor(e,t,i,r){if(this.dialect=e,this.session=t,this.mode=r,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={},this._.schema)for(let[r,n]of Object.entries(this._.schema))this.query[r]=new tC(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[r],n,e,t,this.mode);this.$cache={invalidate:async e=>{}}}static [r.Q]="MySqlDatabase";query;$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(new tA(i.dialect))),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new o({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;return{select:function(i){return new th({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new th({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},update:function(i){return new tx(i,t.session,t.dialect,e)},delete:function(i){return new tk(i,t.session,t.dialect,e)}}}select(e){return new th({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new th({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new tx(e,this.session,this.dialect)}insert(e){return new t$(e,this.session,this.dialect)}delete(e){return new tk(e,this.session,this.dialect)}execute(e){return this.session.execute("string"==typeof e?s.i6.raw(e):e.getSQL())}transaction(e,t){return this.session.transaction(e,t)}}var tN=i(56866);class tO{static [r.Q]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,t){this.reference=()=>{let{name:t,columns:i,foreignColumns:r}=e();return{name:t,columns:i,foreignTable:r[0].table,foreignColumns:r}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new tq(e,this)}}class tq{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static [r.Q]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),r=t.map(e=>e.name),n=i.map(e=>e.name),s=[this.table[b.m],...r,i[0].table[b.m],...n];return e??`${s.join("_")}_fk`}}function tI(e,t){return`${e[b.m]}_${t.join("_")}_unique`}class tj{constructor(e,t){this.name=t,this.columns=e}static [r.Q]=null;columns;build(e){return new tU(e,this.columns,this.name)}}class tL{static [r.Q]=null;name;constructor(e){this.name=e}on(...e){return new tj(e,this.name)}}class tU{constructor(e,t,i){this.table=e,this.columns=t,this.name=i??tI(this.table,this.columns.map(e=>e.name))}static [r.Q]=null;columns;name;getName(){return this.name}}class tD extends y.L{static [r.Q]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,t){return this.config.generated={as:e,type:"always",mode:t?.mode??"virtual"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:r})=>((i,r)=>{let n=new tO(()=>({columns:[e],foreignColumns:[i()]}));return r.onUpdate&&n.onUpdate(r.onUpdate),r.onDelete&&n.onDelete(r.onDelete),n.build(t)})(i,r))}}class tB extends u.s{constructor(e,t){t.uniqueName||(t.uniqueName=tI(e,[t.name])),super(e,t),this.table=e}static [r.Q]="SQLiteColumn"}class tR extends tD{static [r.Q]="SQLiteBigIntBuilder";constructor(e){super(e,"bigint","SQLiteBigInt")}build(e){return new tM(e,this.config)}}class tM extends tB{static [r.Q]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(e){return"undefined"!=typeof Buffer&&Buffer.from?BigInt((Buffer.isBuffer(e)?e:e instanceof ArrayBuffer?Buffer.from(e):e.buffer?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e)).toString("utf8")):BigInt(m.zN.decode(e))}mapToDriverValue(e){return Buffer.from(e.toString())}}class tK extends tD{static [r.Q]="SQLiteBlobJsonBuilder";constructor(e){super(e,"json","SQLiteBlobJson")}build(e){return new tF(e,this.config)}}class tF extends tB{static [r.Q]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(e){return"undefined"!=typeof Buffer&&Buffer.from?JSON.parse((Buffer.isBuffer(e)?e:e instanceof ArrayBuffer?Buffer.from(e):e.buffer?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e)).toString("utf8")):JSON.parse(m.zN.decode(e))}mapToDriverValue(e){return Buffer.from(JSON.stringify(e))}}class tJ extends tD{static [r.Q]="SQLiteBlobBufferBuilder";constructor(e){super(e,"buffer","SQLiteBlobBuffer")}build(e){return new tH(e,this.config)}}class tH extends tB{static [r.Q]="SQLiteBlobBuffer";mapFromDriverValue(e){return Buffer.isBuffer(e)?e:Buffer.from(e)}getSQLType(){return"blob"}}function tz(e,t){let{name:i,config:r}=(0,m.An)(e,t);return r?.mode==="json"?new tK(i):r?.mode==="bigint"?new tR(i):new tJ(i)}class tW extends tD{static [r.Q]="SQLiteCustomColumnBuilder";constructor(e,t,i){super(e,"custom","SQLiteCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=i}build(e){return new tV(e,this.config)}}class tV extends tB{static [r.Q]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function tZ(e){return(t,i)=>{let{name:r,config:n}=(0,m.An)(t,i);return new tW(r,n,e)}}class tG extends tD{static [r.Q]="SQLiteBaseIntegerBuilder";constructor(e,t,i){super(e,t,i),this.config.autoIncrement=!1}primaryKey(e){return e?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class tY extends tB{static [r.Q]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class tX extends tG{static [r.Q]="SQLiteIntegerBuilder";constructor(e){super(e,"number","SQLiteInteger")}build(e){return new t0(e,this.config)}}class t0 extends tY{static [r.Q]="SQLiteInteger"}class t1 extends tG{static [r.Q]="SQLiteTimestampBuilder";constructor(e,t){super(e,"date","SQLiteTimestamp"),this.config.mode=t}defaultNow(){return this.default((0,s.i6)`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(e){return new t6(e,this.config)}}class t6 extends tY{static [r.Q]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(e){return new Date("timestamp"===this.config.mode?1e3*e:e)}mapToDriverValue(e){let t=e.getTime();return"timestamp"===this.config.mode?Math.floor(t/1e3):t}}class t2 extends tG{static [r.Q]="SQLiteBooleanBuilder";constructor(e,t){super(e,"boolean","SQLiteBoolean"),this.config.mode=t}build(e){return new t5(e,this.config)}}class t5 extends tY{static [r.Q]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(e){return 1===Number(e)}mapToDriverValue(e){return e?1:0}}function t8(e,t){let{name:i,config:r}=(0,m.An)(e,t);return r?.mode==="timestamp"||r?.mode==="timestamp_ms"?new t1(i,r.mode):r?.mode==="boolean"?new t2(i,r.mode):new tX(i)}class t3 extends tD{static [r.Q]="SQLiteNumericBuilder";constructor(e){super(e,"string","SQLiteNumeric")}build(e){return new t4(e,this.config)}}class t4 extends tB{static [r.Q]="SQLiteNumeric";mapFromDriverValue(e){return"string"==typeof e?e:String(e)}getSQLType(){return"numeric"}}class t9 extends tD{static [r.Q]="SQLiteNumericNumberBuilder";constructor(e){super(e,"number","SQLiteNumericNumber")}build(e){return new t7(e,this.config)}}class t7 extends tB{static [r.Q]="SQLiteNumericNumber";mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}mapToDriverValue=String;getSQLType(){return"numeric"}}class ie extends tD{static [r.Q]="SQLiteNumericBigIntBuilder";constructor(e){super(e,"bigint","SQLiteNumericBigInt")}build(e){return new it(e,this.config)}}class it extends tB{static [r.Q]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function ii(e,t){let{name:i,config:r}=(0,m.An)(e,t),n=r?.mode;return"number"===n?new t9(i):"bigint"===n?new ie(i):new t3(i)}class ir extends tD{static [r.Q]="SQLiteRealBuilder";constructor(e){super(e,"number","SQLiteReal")}build(e){return new is(e,this.config)}}class is extends tB{static [r.Q]="SQLiteReal";getSQLType(){return"real"}}function ia(e){return new ir(e??"")}class io extends tD{static [r.Q]="SQLiteTextBuilder";constructor(e,t){super(e,"string","SQLiteText"),this.config.enumValues=t.enum,this.config.length=t.length}build(e){return new il(e,this.config)}}class il extends tB{static [r.Q]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(e,t){super(e,t)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class ic extends tD{static [r.Q]="SQLiteTextJsonBuilder";constructor(e){super(e,"json","SQLiteTextJson")}build(e){return new iu(e,this.config)}}class iu extends tB{static [r.Q]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(e){return JSON.parse(e)}mapToDriverValue(e){return JSON.stringify(e)}}function id(e,t={}){let{name:i,config:r}=(0,m.An)(e,t);return"json"===r.mode?new ic(i):new io(i,r)}let ih=Symbol.for("drizzle:SQLiteInlineForeignKeys");class ip extends p.iA{static [r.Q]="SQLiteTable";static Symbol=Object.assign({},p.iA.Symbol,{InlineForeignKeys:ih});[p.iA.Symbol.Columns];[ih]=[];[p.iA.Symbol.ExtraConfigBuilder]=void 0}let im=(e,t,i)=>(function(e,t,i,r,n=e){let s=new ip(e,void 0,n),a=Object.fromEntries(Object.entries("function"==typeof t?t({blob:tz,customType:tZ,integer:t8,numeric:ii,real:ia,text:id}):t).map(([e,t])=>{t.setName(e);let i=t.build(s);return s[ih].push(...t.buildForeignKeys(i,s)),[e,i]})),o=Object.assign(s,a);return o[p.iA.Symbol.Columns]=a,o[p.iA.Symbol.ExtraConfigColumns]=a,i&&(o[ip.Symbol.ExtraConfigBuilder]=i),o})(e,t,i);class ig extends s.G7{static [r.Q]="SQLiteViewBase"}class iy{static [r.Q]="SQLiteDialect";casing;constructor(e){this.casing=new c.xC(e?.casing)}escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[(0,s.i6)`with `];for(let[i,r]of e.entries())t.push((0,s.i6)`${s.i6.identifier(r._.alias)} as (${r._.sql})`),i<e.length-1&&t.push((0,s.i6)`, `);return t.push((0,s.i6)` `),s.i6.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:r,limit:n,orderBy:a}){let o=this.buildWithCTE(r),l=i?(0,s.i6)` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,c=t?(0,s.i6)` where ${t}`:void 0,u=this.buildOrderBy(a),d=this.buildLimit(n);return(0,s.i6)`${o}delete from ${e}${c}${l}${u}${d}`}buildUpdateSet(e,t){let i=e[p.iA.Symbol.Columns],r=Object.keys(i).filter(e=>void 0!==t[e]||i[e]?.onUpdateFn!==void 0),n=r.length;return s.i6.join(r.flatMap((e,r)=>{let a=i[e],o=t[e]??s.i6.param(a.onUpdateFn(),a),l=(0,s.i6)`${s.i6.identifier(this.casing.getColumnCasing(a))} = ${o}`;return r<n-1?[l,s.i6.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:i,returning:r,withList:n,joins:a,from:o,limit:l,orderBy:c}){let u=this.buildWithCTE(n),d=this.buildUpdateSet(e,t),h=o&&s.i6.join([s.i6.raw(" from "),this.buildFromTable(o)]),f=this.buildJoins(a),p=r?(0,s.i6)` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,m=i?(0,s.i6)` where ${i}`:void 0,g=this.buildOrderBy(c),y=this.buildLimit(l);return(0,s.i6)`${u}update ${e} set ${d}${h}${f}${m}${p}${g}${y}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,n=e.flatMap(({field:e},n)=>{let a=[];if((0,r.is)(e,s.$s.Aliased)&&e.isSelectionField)a.push(s.i6.identifier(e.fieldAlias));else if((0,r.is)(e,s.$s.Aliased)||(0,r.is)(e,s.$s)){let i=(0,r.is)(e,s.$s.Aliased)?e.sql:e;t?a.push(new s.$s(i.queryChunks.map(e=>(0,r.is)(e,u.s)?s.i6.identifier(this.casing.getColumnCasing(e)):e))):a.push(i),(0,r.is)(e,s.$s.Aliased)&&a.push((0,s.i6)` as ${s.i6.identifier(e.fieldAlias)}`)}else if((0,r.is)(e,u.s)){let i=e.table[p.iA.Symbol.Name];"SQLiteNumericBigInt"===e.columnType?t?a.push((0,s.i6)`cast(${s.i6.identifier(this.casing.getColumnCasing(e))} as text)`):a.push((0,s.i6)`cast(${s.i6.identifier(i)}.${s.i6.identifier(this.casing.getColumnCasing(e))} as text)`):t?a.push(s.i6.identifier(this.casing.getColumnCasing(e))):a.push((0,s.i6)`${s.i6.identifier(i)}.${s.i6.identifier(this.casing.getColumnCasing(e))}`)}return n<i-1&&a.push((0,s.i6)`, `),a});return s.i6.join(n)}buildJoins(e){if(!e||0===e.length)return;let t=[];if(e)for(let[i,n]of e.entries()){0===i&&t.push((0,s.i6)` `);let a=n.table,o=n.on?(0,s.i6)` on ${n.on}`:void 0;if((0,r.is)(a,ip)){let e=a[ip.Symbol.Name],i=a[ip.Symbol.Schema],r=a[ip.Symbol.OriginalName],l=e===r?void 0:n.alias;t.push((0,s.i6)`${s.i6.raw(n.joinType)} join ${i?(0,s.i6)`${s.i6.identifier(i)}.`:void 0}${s.i6.identifier(r)}${l&&(0,s.i6)` ${s.i6.identifier(l)}`}${o}`)}else t.push((0,s.i6)`${s.i6.raw(n.joinType)} join ${a}${o}`);i<e.length-1&&t.push((0,s.i6)` `)}return s.i6.join(t)}buildLimit(e){return"object"==typeof e||"number"==typeof e&&e>=0?(0,s.i6)` limit ${e}`:void 0}buildOrderBy(e){let t=[];if(e)for(let[i,r]of e.entries())t.push(r),i<e.length-1&&t.push((0,s.i6)`, `);return t.length>0?(0,s.i6)` order by ${s.i6.join(t)}`:void 0}buildFromTable(e){return(0,r.is)(e,p.iA)&&e[p.iA.Symbol.IsAlias]?(0,s.i6)`${(0,s.i6)`${s.i6.identifier(e[p.iA.Symbol.Schema]??"")}.`.if(e[p.iA.Symbol.Schema])}${s.i6.identifier(e[p.iA.Symbol.OriginalName])} ${s.i6.identifier(e[p.iA.Symbol.Name])}`:e}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:n,having:o,table:l,joins:c,orderBy:d,groupBy:h,limit:f,offset:y,distinct:b,setOperators:w}){let v=i??(0,m.ZS)(t);for(let e of v){let t;if((0,r.is)(e.field,u.s)&&(0,p.SP)(e.field.table)!==((0,r.is)(l,a.k)?l._.alias:(0,r.is)(l,ig)?l[g.d].name:(0,r.is)(l,s.$s)?void 0:(0,p.SP)(l))&&(t=e.field.table,!c?.some(({alias:e})=>e===(t[p.iA.Symbol.IsAlias]?p.SP(t):t[p.iA.Symbol.BaseName])))){let t=(0,p.SP)(e.field.table);throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let S=!c||0===c.length,_=this.buildWithCTE(e),A=b?(0,s.i6)` distinct`:void 0,x=this.buildSelection(v,{isSingleTable:S}),T=this.buildFromTable(l),k=this.buildJoins(c),$=n?(0,s.i6)` where ${n}`:void 0,E=o?(0,s.i6)` having ${o}`:void 0,C=[];if(h)for(let[e,t]of h.entries())C.push(t),e<h.length-1&&C.push((0,s.i6)`, `);let P=C.length>0?(0,s.i6)` group by ${s.i6.join(C)}`:void 0,Q=this.buildOrderBy(d),N=this.buildLimit(f),O=y?(0,s.i6)` offset ${y}`:void 0,q=(0,s.i6)`${_}select${A} ${x} from ${T}${k}${$}${P}${E}${Q}${N}${O}`;return w.length>0?this.buildSetOperations(q,w):q}buildSetOperations(e,t){let[i,...r]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===r.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),r)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:n,limit:a,orderBy:o,offset:l}}){let c;let u=(0,s.i6)`${e.getSQL()} `,d=(0,s.i6)`${n.getSQL()}`;if(o&&o.length>0){let e=[];for(let t of o)if((0,r.is)(t,tB))e.push(s.i6.identifier(t.name));else if((0,r.is)(t,s.$s)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];(0,r.is)(i,tB)&&(t.queryChunks[e]=s.i6.identifier(this.casing.getColumnCasing(i)))}e.push((0,s.i6)`${t}`)}else e.push((0,s.i6)`${t}`);c=(0,s.i6)` order by ${s.i6.join(e,(0,s.i6)`, `)}`}let h="object"==typeof a||"number"==typeof a&&a>=0?(0,s.i6)` limit ${a}`:void 0,f=s.i6.raw(`${t} ${i?"all ":""}`),p=l?(0,s.i6)` offset ${l}`:void 0;return(0,s.i6)`${u}${f}${d}${c}${h}${p}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:n,withList:a,select:o}){let l=[],c=Object.entries(e[p.iA.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),u=c.map(([,e])=>s.i6.identifier(this.casing.getColumnCasing(e)));if(o)(0,r.is)(t,s.$s)?l.push(t):l.push(t.getSQL());else for(let[e,i]of(l.push(s.i6.raw("values ")),t.entries())){let n=[];for(let[e,t]of c){let a=i[e];if(void 0===a||(0,r.is)(a,s.dO)&&void 0===a.value){let e;if(null!==t.default&&void 0!==t.default)e=(0,r.is)(t.default,s.$s)?t.default:s.i6.param(t.default,t);else if(void 0!==t.defaultFn){let i=t.defaultFn();e=(0,r.is)(i,s.$s)?i:s.i6.param(i,t)}else if(t.default||void 0===t.onUpdateFn)e=(0,s.i6)`null`;else{let i=t.onUpdateFn();e=(0,r.is)(i,s.$s)?i:s.i6.param(i,t)}n.push(e)}else n.push(a)}l.push(n),e<t.length-1&&l.push((0,s.i6)`, `)}let d=this.buildWithCTE(a),h=s.i6.join(l),f=n?(0,s.i6)` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,m=i?.length?s.i6.join(i):void 0;return(0,s.i6)`${d}insert into ${e} ${u} ${h}${m}${f}`}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:t})}buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:n,tableConfig:o,queryConfig:c,tableAlias:m,nestedQueryRelation:g,joinOn:y}){let b,w=[],v,S,_=[],A,x=[];if(!0===c)w=Object.entries(o.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:(0,l.lw)(t,m),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let n=Object.fromEntries(Object.entries(o.columns).map(([e,t])=>[e,(0,l.lw)(t,m)]));if(c.where){let e="function"==typeof c.where?c.where(n,(0,h.vU)()):c.where;A=e&&(0,l.UI)(e,m)}let a=[],d=[];if(c.columns){let e=!1;for(let[t,i]of Object.entries(c.columns))void 0!==i&&t in o.columns&&(e||!0!==i||(e=!0),d.push(t));d.length>0&&(d=e?d.filter(e=>c.columns?.[e]===!0):Object.keys(o.columns).filter(e=>!d.includes(e)))}else d=Object.keys(o.columns);for(let e of d){let t=o.columns[e];a.push({tsKey:e,value:t})}let g=[];if(c.with&&(g=Object.entries(c.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:o.relations[e]}))),c.extras)for(let[e,t]of Object.entries("function"==typeof c.extras?c.extras(n,{sql:s.i6}):c.extras))a.push({tsKey:e,value:(0,l.qD)(t,m)});for(let{tsKey:e,value:t}of a)w.push({dbKey:(0,r.is)(t,s.$s.Aliased)?t.fieldAlias:o.columns[e].name,tsKey:e,field:(0,r.is)(t,u.s)?(0,l.lw)(t,m):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let y="function"==typeof c.orderBy?c.orderBy(n,(0,h.pl)()):c.orderBy??[];for(let{tsKey:n,queryConfig:a,relation:o}of(Array.isArray(y)||(y=[y]),_=y.map(e=>(0,r.is)(e,u.s)?(0,l.lw)(e,m):(0,l.UI)(e,m)),v=c.limit,S=c.offset,g)){let c=(0,h.wG)(t,i,o),u=i[(0,p.Q0)(o.referencedTable)],d=`${m}_${n}`,g=(0,f.xD)(...c.fields.map((e,t)=>(0,f.eq)((0,l.lw)(c.references[t],d),(0,l.lw)(e,m)))),y=this.buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:i,table:e[u],tableConfig:t[u],queryConfig:(0,r.is)(o,h.fh)?!0===a?{limit:1}:{...a,limit:1}:a,tableAlias:d,joinOn:g,nestedQueryRelation:o}),b=(0,s.i6)`(${y.sql})`.as(n);w.push({dbKey:n,tsKey:n,field:b,relationTableTsKey:u,isJson:!0,selection:y.selection})}}if(0===w.length)throw new d.kR({message:`No fields selected for table "${o.tsName}" ("${m}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(A=(0,f.xD)(y,A),g){let e=(0,s.i6)`json_array(${s.i6.join(w.map(({field:e})=>(0,r.is)(e,tB)?s.i6.identifier(this.casing.getColumnCasing(e)):(0,r.is)(e,s.$s.Aliased)?e.sql:e),(0,s.i6)`, `)})`;(0,r.is)(g,h.sj)&&(e=(0,s.i6)`coalesce(json_group_array(${e}), json_array())`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:w}];void 0!==v||void 0!==S||_.length>0?(b=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:[{path:[],field:s.i6.raw("*")}],where:A,limit:v,offset:S,orderBy:_,setOperators:[]}),A=void 0,v=void 0,S=void 0,_=void 0):b=(0,l.RQ)(n,m),b=this.buildSelectQuery({table:(0,r.is)(b,ip)?b:new a.k(b,{},m),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),joins:x,where:A,limit:v,offset:S,orderBy:_,setOperators:[]})}else b=this.buildSelectQuery({table:(0,l.RQ)(n,m),fields:{},fieldsFlat:w.map(({field:e})=>({path:[],field:(0,r.is)(e,u.s)?(0,l.lw)(e,m):e})),joins:x,where:A,limit:v,offset:S,orderBy:_,setOperators:[]});return{tableTsKey:o.tsName,sql:b,selection:w}}}class ib extends iy{static [r.Q]="SQLiteSyncDialect";migrate(e,t,i){let r=void 0===i?"__drizzle_migrations":"string"==typeof i?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",n=(0,s.i6)`
			CREATE TABLE IF NOT EXISTS ${s.i6.identifier(r)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;t.run(n);let a=t.values((0,s.i6)`SELECT id, hash, created_at FROM ${s.i6.identifier(r)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;t.run((0,s.i6)`BEGIN`);try{for(let i of e)if(!a||Number(a[2])<i.folderMillis){for(let e of i.sql)t.run(s.i6.raw(e));t.run((0,s.i6)`INSERT INTO ${s.i6.identifier(r)} ("hash", "created_at") VALUES(${i.hash}, ${i.folderMillis})`)}t.run((0,s.i6)`COMMIT`)}catch(e){throw t.run((0,s.i6)`ROLLBACK`),e}}}class iw extends null{static [r.Q]=null;async migrate(e,t,i){let r=void 0===i?"__drizzle_migrations":"string"==typeof i?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",n=sql`
			CREATE TABLE IF NOT EXISTS ${sql.identifier(r)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await t.run(n);let s=(await t.values(sql`SELECT id, hash, created_at FROM ${sql.identifier(r)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await t.transaction(async t=>{for(let i of e)if(!s||Number(s[2])<i.folderMillis){for(let e of i.sql)await t.run(sql.raw(e));await t.run(sql`INSERT INTO ${sql.identifier(r)} ("hash", "created_at") VALUES(${i.hash}, ${i.folderMillis})`)}})}}function iv(e){return(0,r.is)(e,ip)?[`${e[p.iA.Symbol.BaseName]}`]:(0,r.is)(e,a.k)?e._.usedTables??[]:(0,r.is)(e,s.$s)?e.usedTables??[]:[]}class iS{static [r.Q]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){let t;let i=!!this.fields;return t=this.fields?this.fields:(0,r.is)(e,a.k)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):(0,r.is)(e,ig)?e[g.d].selectedFields:(0,r.is)(e,s.$s)?{}:(0,m.SS)(e),new iA({table:e,fields:t,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class i_ extends to.b{static [r.Q]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:i,session:r,dialect:n,withList:s,distinct:a}){for(let o of(super(),this.config={withList:s,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=i,this.session=r,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=(0,m.dP)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},iv(e)))this.usedTables.add(o)}getUsedTables(){return[...this.usedTables]}createJoin(e){return(t,i)=>{let o=this.tableName,l=(0,m.dP)(t);for(let e of iv(t))this.usedTables.add(e);if("string"==typeof l&&this.config.joins?.some(e=>e.alias===l))throw Error(`Alias "${l}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof o&&(this.config.fields={[o]:this.config.fields}),"string"==typeof l&&!(0,r.is)(t,s.$s))){let e=(0,r.is)(t,a.k)?t._.selectedFields:(0,r.is)(t,s.G7)?t[g.d].selectedFields:t[p.iA.Symbol.Columns];this.config.fields[l]=e}if("function"==typeof i&&(i=i(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:i,table:t,joinType:e,alias:l}),"string"==typeof l)switch(e){case"left":this.joinsNotNullableMap[l]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[l]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[l]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[l]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(e,t){return i=>{let r="function"==typeof i?i(iT()):i;if(!(0,m.ux)(this.getSelectedFields(),r.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:r}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...iv(this.config.table)),this.config.joins)for(let e of this.config.joins)t.push(...iv(e.table));return new Proxy(new a.k(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new n.e({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class iA extends i_{static [r.Q]="SQLiteSelect";_prepare(e=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let t=(0,m.ZS)(this.config.fields),i=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),t,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return i.joinsNotNullableMap=this.joinsNotNullableMap,i}$withCache(e){return this.cacheConfig=void 0===e?{config:{},enable:!0,autoInvalidate:!0}:!1===e?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.all()}}function ix(e,t){return(i,r,...n)=>{let s=[r,...n].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of s)if(!(0,m.ux)(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(s)}}(0,m.ef)(iA,[tl.N]);let iT=()=>({union:ik,unionAll:i$,intersect:iE,except:iC}),ik=ix("union",!1),i$=ix("union",!0),iE=ix("intersect",!1),iC=ix("except",!1);class iP{static [r.Q]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=(0,r.is)(e,iy)?e:void 0,this.dialectConfig=(0,r.is)(e,iy)?void 0:e}$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(i)),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(i){return new iS({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(i){return new iS({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}}}select(e){return new iS({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new iS({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new ib(this.dialectConfig)),this.dialect}}class iQ{constructor(e,t,i,r){this.table=e,this.session=t,this.dialect=i,this.withList=r}static [r.Q]="SQLiteUpdateBuilder";set(e){return new iN(this.table,(0,m.M6)(this.table,e),this.session,this.dialect,this.withList)}}class iN extends tl.N{constructor(e,t,i,r,n){super(),this.session=i,this.dialect=r,this.config={set:t,table:e,withList:n,joins:[]}}static [r.Q]="SQLiteUpdate";config;from(e){return this.config.from=e,this}createJoin(e){return(t,i)=>{let s=(0,m.dP)(t);if("string"==typeof s&&this.config.joins.some(e=>e.alias===s))throw Error(`Alias "${s}" is already used in this query`);if("function"==typeof i){let e=this.config.from?(0,r.is)(t,ip)?t[p.iA.Symbol.Columns]:(0,r.is)(t,a.k)?t._.selectedFields:(0,r.is)(t,ig)?t[g.d].selectedFields:void 0:void 0;i=i(new Proxy(this.config.table[p.iA.Symbol.Columns],new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),e&&new Proxy(e,new n.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:i,table:t,joinType:e,alias:s}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.table[p.iA.Symbol.Columns],new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.orderBy=i}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}returning(e=this.config.table[ip.Symbol.Columns]){return this.config.returning=(0,m.ZS)(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:iv(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class iO{constructor(e,t,i,r){this.table=e,this.session=t,this.dialect=i,this.withList=r}static [r.Q]="SQLiteInsertBuilder";values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[p.iA.Symbol.Columns];for(let n of Object.keys(e)){let a=e[n];t[n]=(0,r.is)(a,s.$s)?a:new s.dO(a,i[n])}return t});return new iq(this.table,t,this.session,this.dialect,this.withList)}select(e){let t="function"==typeof e?e(new iP):e;if(!(0,r.is)(t,s.$s)&&!(0,m.ux)(this.table[p.oe],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new iq(this.table,t,this.session,this.dialect,this.withList,!0)}}class iq extends tl.N{constructor(e,t,i,r,n,s){super(),this.session=i,this.dialect=r,this.config={table:e,values:t,withList:n,select:s}}static [r.Q]="SQLiteInsert";config;returning(e=this.config.table[ip.Symbol.Columns]){return this.config.returning=(0,m.ZS)(e),this}onConflictDoNothing(e={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===e.target)this.config.onConflict.push((0,s.i6)` on conflict do nothing`);else{let t=Array.isArray(e.target)?(0,s.i6)`${e.target}`:(0,s.i6)`${[e.target]}`,i=e.where?(0,s.i6)` where ${e.where}`:(0,s.i6)``;this.config.onConflict.push((0,s.i6)` on conflict ${t} do nothing${i}`)}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let t=e.where?(0,s.i6)` where ${e.where}`:void 0,i=e.targetWhere?(0,s.i6)` where ${e.targetWhere}`:void 0,r=e.setWhere?(0,s.i6)` where ${e.setWhere}`:void 0,n=Array.isArray(e.target)?(0,s.i6)`${e.target}`:(0,s.i6)`${[e.target]}`,a=this.dialect.buildUpdateSet(this.config.table,(0,m.M6)(this.config.table,e.set));return this.config.onConflict.push((0,s.i6)` on conflict ${n}${i} do update set ${a}${t}${r}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:iv(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class iI extends tl.N{constructor(e,t,i,r){super(),this.table=e,this.session=t,this.dialect=i,this.config={table:e,withList:r}}static [r.Q]="SQLiteDelete";config;where(e){return this.config.where=e,this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.table[p.iA.Symbol.Columns],new n.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.orderBy=i}else this.config.orderBy=e;return this}limit(e){return this.config.limit=e,this}returning(e=this.table[ip.Symbol.Columns]){return this.config.returning=(0,m.ZS)(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:iv(this.config.table)})}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(e){return this._prepare().execute(e)}$dynamic(){return this}}class ij extends s.$s{constructor(e){super(ij.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.session=e.session,this.sql=ij.buildCount(e.source,e.filters)}sql;static [r.Q]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(e,t){return(0,s.i6)`(select count(*) from ${e}${s.i6.raw(" where ").if(t)}${t})`}static buildCount(e,t){return(0,s.i6)`select count(*) from ${e}${s.i6.raw(" where ").if(t)}${t}`}then(e,t){return Promise.resolve(this.session.count(this.sql)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}class iL{constructor(e,t,i,r,n,s,a,o){this.mode=e,this.fullSchema=t,this.schema=i,this.tableNamesMap=r,this.table=n,this.tableConfig=s,this.dialect=a,this.session=o}static [r.Q]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return"sync"===this.mode?new iD(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new iU(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return"sync"===this.mode?new iD(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new iU(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class iU extends tl.N{constructor(e,t,i,r,n,s,a,o,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=r,this.tableConfig=n,this.dialect=s,this.session=a,this.config=o,this.mode=l}static [r.Q]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){let{query:t,builtQuery:i}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](i,void 0,"first"===this.mode?"get":"all",!0,(e,i)=>{let r=e.map(e=>(0,h.WX)(this.schema,this.tableConfig,e,t.selection,i));return"first"===this.mode?r[0]:r})}prepare(){return this._prepare(!1)}_toSQL(){let e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class iD extends iU{static [r.Q]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class iB extends tl.N{constructor(e,t,i,r,n){super(),this.execute=e,this.getSQL=t,this.dialect=r,this.mapBatchResult=n,this.config={action:i}}static [r.Q]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}class iR{constructor(e,t,i,r){this.resultKind=e,this.dialect=t,this.session=i,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let n=this.query;if(this._.schema)for(let[s,a]of Object.entries(this._.schema))n[s]=new iL(e,r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[s],a,t,i);this.$cache={invalidate:async e=>{}}}static [r.Q]="BaseSQLiteDatabase";query;$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(new iP(i.dialect))),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new n.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new ij({source:e,filters:t,session:this.session})}with(...e){let t=this;return{select:function(i){return new iS({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new iS({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},update:function(i){return new iQ(i,t.session,t.dialect,e)},insert:function(i){return new iO(i,t.session,t.dialect,e)},delete:function(i){return new iI(i,t.session,t.dialect,e)}}}select(e){return new iS({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new iS({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new iQ(e,this.session,this.dialect)}$cache;insert(e){return new iO(e,this.session,this.dialect)}delete(e){return new iI(e,this.session,this.dialect)}run(e){let t="string"==typeof e?s.i6.raw(e):e.getSQL();return"async"===this.resultKind?new iB(async()=>this.session.run(t),()=>t,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(t)}all(e){let t="string"==typeof e?s.i6.raw(e):e.getSQL();return"async"===this.resultKind?new iB(async()=>this.session.all(t),()=>t,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(t)}get(e){let t="string"==typeof e?s.i6.raw(e):e.getSQL();return"async"===this.resultKind?new iB(async()=>this.session.get(t),()=>t,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(t)}values(e){let t="string"==typeof e?s.i6.raw(e):e.getSQL();return"async"===this.resultKind?new iB(async()=>this.session.values(t),()=>t,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(t)}transaction(e,t){return this.session.transaction(e,t)}}function iM(...e){return e[0].columns?new iK(e[0].columns,e[0].name):new iK(e)}class iK{static [r.Q]="MySqlPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new iF(e,this.columns,this.name)}}class iF{constructor(e,t,i){this.table=e,this.columns=t,this.name=i}static [r.Q]="MySqlPrimaryKey";columns;name;getName(){return this.name??`${this.table[tr.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}var iJ=i(80405),iH=i(72140),iz=i(1575),iW=i(12941),iV=i(89401),iZ=i(98748);function iG(...e){return e[0].columns?new iY(e[0].columns,e[0].name):new iY(e)}class iY{static [r.Q]="SQLitePrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new iX(e,this.columns,this.name)}}class iX{constructor(e,t,i){this.table=e,this.columns=t,this.name=i}static [r.Q]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[ip.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}function i0(e,t){if((0,r.is)(e,tQ))return function(e,t){let{usersTable:i,accountsTable:r,sessionsTable:n,verificationTokensTable:s,authenticatorsTable:a}=function(e={}){let t=e.usersTable??tn("user",{id:e9("id",{length:255}).primaryKey().$defaultFn(()=>crypto.randomUUID()),name:e9("name",{length:255}),email:e9("email",{length:255}).unique(),emailVerified:eX("emailVerified",{mode:"date",fsp:3}),image:e9("image",{length:255})}),i=e.accountsTable??tn("account",{userId:e9("userId",{length:255}).notNull().references(()=>t.id,{onDelete:"cascade"}),type:e9("type",{length:255}).$type().notNull(),provider:e9("provider",{length:255}).notNull(),providerAccountId:e9("providerAccountId",{length:255}).notNull(),refresh_token:e9("refresh_token",{length:255}),access_token:e9("access_token",{length:255}),expires_at:e_("expires_at"),token_type:e9("token_type",{length:255}),scope:e9("scope",{length:255}),id_token:e9("id_token",{length:2048}),session_state:e9("session_state",{length:255})},e=>({compositePk:iM({columns:[e.provider,e.providerAccountId]})})),r=e.sessionsTable??tn("session",{sessionToken:e9("sessionToken",{length:255}).primaryKey(),userId:e9("userId",{length:255}).notNull().references(()=>t.id,{onDelete:"cascade"}),expires:eX("expires",{mode:"date"}).notNull()}),n=e.verificationTokensTable??tn("verificationToken",{identifier:e9("identifier",{length:255}).notNull(),token:e9("token",{length:255}).notNull(),expires:eX("expires",{mode:"date"}).notNull()},e=>({compositePk:iM({columns:[e.identifier,e.token]})})),s=e.authenticatorsTable??tn("authenticator",{credentialID:e9("credentialID",{length:255}).notNull().unique(),userId:e9("userId",{length:255}).notNull().references(()=>t.id,{onDelete:"cascade"}),providerAccountId:e9("providerAccountId",{length:255}).notNull(),credentialPublicKey:e9("credentialPublicKey",{length:255}).notNull(),counter:e_("counter").notNull(),credentialDeviceType:e9("credentialDeviceType",{length:255}).notNull(),credentialBackedUp:D("credentialBackedUp").notNull(),transports:e9("transports",{length:255})},e=>({compositePk:iM({columns:[e.userId,e.credentialID]})}));return{usersTable:t,accountsTable:i,sessionsTable:r,verificationTokensTable:n,authenticatorsTable:s}}(t);return{async createUser(t){let{id:r,...n}=t,s=(0,m.SS)(i).id.defaultFn,[a]=await e.insert(i).values(s?n:{...n,id:r}).$returningId();return e.select().from(i).where((0,f.eq)(i.id,a?a.id:r)).then(e=>e[0])},getUser:async t=>e.select().from(i).where((0,f.eq)(i.id,t)).then(e=>e.length>0?e[0]:null),getUserByEmail:async t=>e.select().from(i).where((0,f.eq)(i.email,t)).then(e=>e.length>0?e[0]:null),createSession:async t=>(await e.insert(n).values(t),e.select().from(n).where((0,f.eq)(n.sessionToken,t.sessionToken)).then(e=>e[0])),getSessionAndUser:async t=>e.select({session:n,user:i}).from(n).where((0,f.eq)(n.sessionToken,t)).innerJoin(i,(0,f.eq)(i.id,n.userId)).then(e=>e.length>0?e[0]:null),async updateUser(t){if(!t.id)throw Error("No user id.");await e.update(i).set(t).where((0,f.eq)(i.id,t.id));let[r]=await e.select().from(i).where((0,f.eq)(i.id,t.id));if(!r)throw Error("No user found.");return r},updateSession:async t=>(await e.update(n).set(t).where((0,f.eq)(n.sessionToken,t.sessionToken)),e.select().from(n).where((0,f.eq)(n.sessionToken,t.sessionToken)).then(e=>e[0])),async linkAccount(t){await e.insert(r).values(t)},async getUserByAccount(t){let n=await e.select({account:r,user:i}).from(r).innerJoin(i,(0,f.eq)(r.userId,i.id)).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId))).then(e=>e[0]);return n?.user??null},async deleteSession(t){await e.delete(n).where((0,f.eq)(n.sessionToken,t))},createVerificationToken:async t=>(await e.insert(s).values(t),e.select().from(s).where((0,f.eq)(s.identifier,t.identifier)).then(e=>e[0])),async useVerificationToken(t){let i=await e.select().from(s).where((0,f.xD)((0,f.eq)(s.identifier,t.identifier),(0,f.eq)(s.token,t.token))).then(e=>e.length>0?e[0]:null);return i&&await e.delete(s).where((0,f.xD)((0,f.eq)(s.identifier,t.identifier),(0,f.eq)(s.token,t.token))),i},async deleteUser(t){await e.delete(i).where((0,f.eq)(i.id,t))},async unlinkAccount(t){await e.delete(r).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId)))},getAccount:async(t,i)=>e.select().from(r).where((0,f.xD)((0,f.eq)(r.provider,i),(0,f.eq)(r.providerAccountId,t))).then(e=>e[0]??null),createAuthenticator:async t=>(await e.insert(a).values(t),await e.select().from(a).where((0,f.eq)(a.credentialID,t.credentialID)).then(e=>e[0]??null)),getAuthenticator:async t=>await e.select().from(a).where((0,f.eq)(a.credentialID,t)).then(e=>e[0]??null),listAuthenticatorsByUserId:async t=>await e.select().from(a).where((0,f.eq)(a.userId,t)).then(e=>e),async updateAuthenticatorCounter(t,i){await e.update(a).set({counter:i}).where((0,f.eq)(a.credentialID,t));let r=await e.select().from(a).where((0,f.eq)(a.credentialID,t)).then(e=>e[0]);if(!r)throw Error("Authenticator not found.");return r}}}(e,t);if((0,r.is)(e,tN.M))return function(e,t){let{usersTable:i,accountsTable:r,sessionsTable:n,verificationTokensTable:s,authenticatorsTable:a}=function(e={}){let t=e.usersTable??(0,iJ.af)("user",{id:(0,iH.fL)("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),name:(0,iH.fL)("name"),email:(0,iH.fL)("email").unique(),emailVerified:(0,iz.AB)("emailVerified",{mode:"date"}),image:(0,iH.fL)("image")}),i=e.accountsTable??(0,iJ.af)("account",{userId:(0,iH.fL)("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),type:(0,iH.fL)("type").$type().notNull(),provider:(0,iH.fL)("provider").notNull(),providerAccountId:(0,iH.fL)("providerAccountId").notNull(),refresh_token:(0,iH.fL)("refresh_token"),access_token:(0,iH.fL)("access_token"),expires_at:(0,iW._L)("expires_at"),token_type:(0,iH.fL)("token_type"),scope:(0,iH.fL)("scope"),id_token:(0,iH.fL)("id_token"),session_state:(0,iH.fL)("session_state")},e=>({compositePk:(0,iV.CK)({columns:[e.provider,e.providerAccountId]})})),r=e.sessionsTable??(0,iJ.af)("session",{sessionToken:(0,iH.fL)("sessionToken").primaryKey(),userId:(0,iH.fL)("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),expires:(0,iz.AB)("expires",{mode:"date"}).notNull()}),n=e.verificationTokensTable??(0,iJ.af)("verificationToken",{identifier:(0,iH.fL)("identifier").notNull(),token:(0,iH.fL)("token").notNull(),expires:(0,iz.AB)("expires",{mode:"date"}).notNull()},e=>({compositePk:(0,iV.CK)({columns:[e.identifier,e.token]})})),s=e.authenticatorsTable??(0,iJ.af)("authenticator",{credentialID:(0,iH.fL)("credentialID").notNull().unique(),userId:(0,iH.fL)("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),providerAccountId:(0,iH.fL)("providerAccountId").notNull(),credentialPublicKey:(0,iH.fL)("credentialPublicKey").notNull(),counter:(0,iW._L)("counter").notNull(),credentialDeviceType:(0,iH.fL)("credentialDeviceType").notNull(),credentialBackedUp:(0,iZ.O7)("credentialBackedUp").notNull(),transports:(0,iH.fL)("transports")},e=>({compositePK:(0,iV.CK)({columns:[e.userId,e.credentialID]})}));return{usersTable:t,accountsTable:i,sessionsTable:r,verificationTokensTable:n,authenticatorsTable:s}}(t);return{async createUser(t){let{id:r,...n}=t,s=(0,m.SS)(i).id.hasDefault;return e.insert(i).values(s?n:{...n,id:r}).returning().then(e=>e[0])},getUser:async t=>e.select().from(i).where((0,f.eq)(i.id,t)).then(e=>e.length>0?e[0]:null),getUserByEmail:async t=>e.select().from(i).where((0,f.eq)(i.email,t)).then(e=>e.length>0?e[0]:null),createSession:async t=>e.insert(n).values(t).returning().then(e=>e[0]),getSessionAndUser:async t=>e.select({session:n,user:i}).from(n).where((0,f.eq)(n.sessionToken,t)).innerJoin(i,(0,f.eq)(i.id,n.userId)).then(e=>e.length>0?e[0]:null),async updateUser(t){if(!t.id)throw Error("No user id.");let[r]=await e.update(i).set(t).where((0,f.eq)(i.id,t.id)).returning();if(!r)throw Error("No user found.");return r},updateSession:async t=>e.update(n).set(t).where((0,f.eq)(n.sessionToken,t.sessionToken)).returning().then(e=>e[0]),async linkAccount(t){await e.insert(r).values(t)},async getUserByAccount(t){let n=await e.select({account:r,user:i}).from(r).innerJoin(i,(0,f.eq)(r.userId,i.id)).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId))).then(e=>e[0]);return n?.user??null},async deleteSession(t){await e.delete(n).where((0,f.eq)(n.sessionToken,t))},createVerificationToken:async t=>e.insert(s).values(t).returning().then(e=>e[0]),useVerificationToken:async t=>e.delete(s).where((0,f.xD)((0,f.eq)(s.identifier,t.identifier),(0,f.eq)(s.token,t.token))).returning().then(e=>e.length>0?e[0]:null),async deleteUser(t){await e.delete(i).where((0,f.eq)(i.id,t))},async unlinkAccount(t){await e.delete(r).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId)))},getAccount:async(t,i)=>e.select().from(r).where((0,f.xD)((0,f.eq)(r.provider,i),(0,f.eq)(r.providerAccountId,t))).then(e=>e[0]??null),createAuthenticator:async t=>e.insert(a).values(t).returning().then(e=>e[0]??null),getAuthenticator:async t=>e.select().from(a).where((0,f.eq)(a.credentialID,t)).then(e=>e[0]??null),listAuthenticatorsByUserId:async t=>e.select().from(a).where((0,f.eq)(a.userId,t)).then(e=>e),async updateAuthenticatorCounter(t,i){let r=await e.update(a).set({counter:i}).where((0,f.eq)(a.credentialID,t)).returning().then(e=>e[0]);if(!r)throw Error("Authenticator not found.");return r}}}(e,t);if((0,r.is)(e,iR))return function(e,t){let{usersTable:i,accountsTable:r,sessionsTable:n,verificationTokensTable:s,authenticatorsTable:a}=function(e={}){let t=e.usersTable??im("user",{id:id("id").primaryKey().$defaultFn(()=>crypto.randomUUID()),name:id("name"),email:id("email").unique(),emailVerified:t8("emailVerified",{mode:"timestamp_ms"}),image:id("image")}),i=e.accountsTable??im("account",{userId:id("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),type:id("type").$type().notNull(),provider:id("provider").notNull(),providerAccountId:id("providerAccountId").notNull(),refresh_token:id("refresh_token"),access_token:id("access_token"),expires_at:t8("expires_at"),token_type:id("token_type"),scope:id("scope"),id_token:id("id_token"),session_state:id("session_state")},e=>({compositePk:iG({columns:[e.provider,e.providerAccountId]})})),r=e.sessionsTable??im("session",{sessionToken:id("sessionToken").primaryKey(),userId:id("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),expires:t8("expires",{mode:"timestamp_ms"}).notNull()}),n=e.verificationTokensTable??im("verificationToken",{identifier:id("identifier").notNull(),token:id("token").notNull(),expires:t8("expires",{mode:"timestamp_ms"}).notNull()},e=>({compositePk:iG({columns:[e.identifier,e.token]})})),s=e.authenticatorsTable??im("authenticator",{credentialID:id("credentialID").notNull().unique(),userId:id("userId").notNull().references(()=>t.id,{onDelete:"cascade"}),providerAccountId:id("providerAccountId").notNull(),credentialPublicKey:id("credentialPublicKey").notNull(),counter:t8("counter").notNull(),credentialDeviceType:id("credentialDeviceType").notNull(),credentialBackedUp:t8("credentialBackedUp",{mode:"boolean"}).notNull(),transports:id("transports")},e=>({compositePK:iG({columns:[e.userId,e.credentialID]})}));return{usersTable:t,accountsTable:i,sessionsTable:r,verificationTokensTable:n,authenticatorsTable:s}}(t);return{async createUser(t){let{id:r,...n}=t,s=(0,m.SS)(i).id.hasDefault;return e.insert(i).values(s?n:{...n,id:r}).returning().get()},getUser:async t=>await e.select().from(i).where((0,f.eq)(i.id,t)).get()??null,getUserByEmail:async t=>await e.select().from(i).where((0,f.eq)(i.email,t)).get()??null,createSession:async t=>e.insert(n).values(t).returning().get(),getSessionAndUser:async t=>await e.select({session:n,user:i}).from(n).where((0,f.eq)(n.sessionToken,t)).innerJoin(i,(0,f.eq)(i.id,n.userId)).get()??null,async updateUser(t){if(!t.id)throw Error("No user id.");let r=await e.update(i).set(t).where((0,f.eq)(i.id,t.id)).returning().get();if(!r)throw Error("User not found.");return r},updateSession:async t=>await e.update(n).set(t).where((0,f.eq)(n.sessionToken,t.sessionToken)).returning().get()??null,async linkAccount(t){await e.insert(r).values(t).run()},async getUserByAccount(t){let n=await e.select({account:r,user:i}).from(r).innerJoin(i,(0,f.eq)(r.userId,i.id)).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId))).get();return n?.user??null},async deleteSession(t){await e.delete(n).where((0,f.eq)(n.sessionToken,t)).run()},createVerificationToken:async t=>e.insert(s).values(t).returning().get(),useVerificationToken:async t=>await e.delete(s).where((0,f.xD)((0,f.eq)(s.identifier,t.identifier),(0,f.eq)(s.token,t.token))).returning().get()??null,async deleteUser(t){await e.delete(i).where((0,f.eq)(i.id,t)).run()},async unlinkAccount(t){await e.delete(r).where((0,f.xD)((0,f.eq)(r.provider,t.provider),(0,f.eq)(r.providerAccountId,t.providerAccountId))).run()},getAccount:async(t,i)=>e.select().from(r).where((0,f.xD)((0,f.eq)(r.provider,i),(0,f.eq)(r.providerAccountId,t))).then(e=>e[0]??null),createAuthenticator:async t=>e.insert(a).values(t).returning().then(e=>e[0]??null),getAuthenticator:async t=>e.select().from(a).where((0,f.eq)(a.credentialID,t)).then(e=>e[0]??null),listAuthenticatorsByUserId:async t=>e.select().from(a).where((0,f.eq)(a.userId,t)).then(e=>e),async updateAuthenticatorCounter(t,i){let r=await e.update(a).set({counter:i}).where((0,f.eq)(a.credentialID,t)).returning().then(e=>e[0]);if(!r)throw Error("Authenticator not found.");return r}}}(e,t);throw Error(`Unsupported database type (${typeof e}) in Auth.js Drizzle adapter.`)}},2285:(e,t,i)=>{i.d(t,{RQ:()=>d,UI:()=>p,dZ:()=>l,lw:()=>h,qD:()=>f,wH:()=>c});var r=i(83596),n=i(19326),s=i(62315),a=i(80298),o=i(62413);class l{constructor(e){this.table=e}static [n.Q]="ColumnAliasProxyHandler";get(e,t){return"table"===t?this.table:e[t]}}class c{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static [n.Q]="TableAliasProxyHandler";get(e,t){if(t===a.iA.Symbol.IsAlias)return!0;if(t===a.iA.Symbol.Name||this.replaceOriginalName&&t===a.iA.Symbol.OriginalName)return this.alias;if(t===o.d)return{...e[o.d],name:this.alias,isAlias:!0};if(t===a.iA.Symbol.Columns){let t=e[a.iA.Symbol.Columns];if(!t)return t;let i={};return Object.keys(t).map(r=>{i[r]=new Proxy(t[r],new l(new Proxy(e,this)))}),i}let i=e[t];return(0,n.is)(i,r.s)?new Proxy(i,new l(new Proxy(e,this))):i}}class u{constructor(e){this.alias=e}static [n.Q]=null;get(e,t){return"sourceTable"===t?d(e.sourceTable,this.alias):e[t]}}function d(e,t){return new Proxy(e,new c(t,!1))}function h(e,t){return new Proxy(e,new l(new Proxy(e.table,new c(t,!1))))}function f(e,t){return new s.$s.Aliased(p(e.sql,t),e.fieldAlias)}function p(e,t){return s.i6.join(e.queryChunks.map(e=>(0,n.is)(e,r.s)?h(e,t):(0,n.is)(e,s.$s)?p(e,t):(0,n.is)(e,s.$s.Aliased)?f(e,t):e))}},85675:(e,t,i)=>{i.d(t,{xC:()=>l});var r=i(19326),n=i(80298);function s(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(e=>e.toLowerCase()).join("_")}function a(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((e,t,i)=>e+(0===i?t.toLowerCase():`${t[0].toUpperCase()}${t.slice(1)}`),"")}function o(e){return e}class l{static [r.Q]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert="snake_case"===e?s:"camelCase"===e?a:o}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[n.iA.Symbol.Schema]??"public",i=e.table[n.iA.Symbol.OriginalName],r=`${t}.${i}.${e.name}`;return this.cache[r]||this.cacheTable(e.table),this.cache[r]}cacheTable(e){let t=e[n.iA.Symbol.Schema]??"public",i=e[n.iA.Symbol.OriginalName],r=`${t}.${i}`;if(!this.cachedTables[r]){for(let t of Object.values(e[n.iA.Symbol.Columns])){let e=`${r}.${t.name}`;this.cache[e]=this.convert(t.name)}this.cachedTables[r]=!0}}clearCache(){this.cache={},this.cachedTables={}}}},35418:(e,t,i)=>{i.d(t,{L:()=>n});var r=i(19326);class n{static [r.Q]="ColumnBuilder";config;constructor(e,t,i){this.config={name:e,keyAsName:""===e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:i,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){""===this.config.name&&(this.config.name=e)}}},83596:(e,t,i)=>{i.d(t,{s:()=>n});var r=i(19326);class n{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static [r.Q]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}},19326:(e,t,i)=>{i.d(t,{Q:()=>r,is:()=>n});let r=Symbol.for("drizzle:entityKind");function n(e,t){if(!e||"object"!=typeof e)return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,r))throw Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let i=Object.getPrototypeOf(e).constructor;if(i)for(;i;){if(r in i&&i[r]===t[r])return!0;i=Object.getPrototypeOf(i)}return!1}Symbol.for("drizzle:hasOwnEntityKind")},7313:(e,t,i)=>{i.d(t,{Fx:()=>a,SR:()=>s,kR:()=>n});var r=i(19326);class n extends Error{static [r.Q]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}}class s extends Error{constructor(e,t,i){super(`Failed query: ${e}
params: ${t}`),this.query=e,this.params=t,this.cause=i,Error.captureStackTrace(this,s),i&&(this.cause=i)}}class a extends n{static [r.Q]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}},98748:(e,t,i)=>{i.d(t,{O7:()=>o});var r=i(19326),n=i(12596);class s extends n.b1{static [r.Q]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new a(e,this.config)}}class a extends n.df{static [r.Q]="PgBoolean";getSQLType(){return"boolean"}}function o(e){return new s(e??"")}},12596:(e,t,i)=>{i.d(t,{df:()=>g,b1:()=>m});var r=i(35418),n=i(83596),s=i(19326),a=i(18933);class o{static [s.Q]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:t,columns:i,foreignColumns:r}=e();return{name:t,columns:i,foreignTable:r[0].table,foreignColumns:r}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new l(e,this)}}class l{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static [s.Q]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:i}=this.reference(),r=t.map(e=>e.name),n=i.map(e=>e.name),s=[this.table[a.m],...r,i[0].table[a.m],...n];return e??`${s.join("_")}_fk`}}var c=i(19082);function u(e,t){return`${e[a.m]}_${t.join("_")}_unique`}class d{constructor(e,t){this.name=t,this.columns=e}static [s.Q]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new f(e,this.columns,this.nullsNotDistinctConfig,this.name)}}class h{static [s.Q]=null;name;constructor(e){this.name=e}on(...e){return new d(e,this.name)}}class f{constructor(e,t,i,r){this.table=e,this.columns=t,this.name=r??u(this.table,this.columns.map(e=>e.name)),this.nullsNotDistinct=i}static [s.Q]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function p(e,t,i){for(let r=t;r<e.length;r++){let n=e[r];if("\\"===n){r++;continue}if('"'===n)return[e.slice(t,r).replace(/\\/g,""),r+1];if(!i&&(","===n||"}"===n))return[e.slice(t,r).replace(/\\/g,""),r]}return[e.slice(t).replace(/\\/g,""),e.length]}class m extends r.L{foreignKeyConfigs=[];static [s.Q]="PgColumnBuilder";array(e){return new w(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:i,actions:r})=>(0,c.t)((i,r)=>{let n=new o(()=>({columns:[e],foreignColumns:[i()]}));return r.onUpdate&&n.onUpdate(r.onUpdate),r.onDelete&&n.onDelete(r.onDelete),n.build(t)},i,r))}buildExtraConfigColumn(e){return new y(e,this.config)}}class g extends n.s{constructor(e,t){t.uniqueName||(t.uniqueName=u(e,[t.name])),super(e,t),this.table=e}static [s.Q]="PgColumn"}class y extends g{static [s.Q]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}}class b{static [s.Q]=null;constructor(e,t,i,r){this.name=e,this.keyAsName=t,this.type=i,this.indexConfig=r}name;keyAsName;type;indexConfig}class w extends m{static [s.Q]="PgArrayBuilder";constructor(e,t,i){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=i}build(e){let t=this.config.baseBuilder.build(e);return new v(e,this.config,t)}}class v extends g{constructor(e,t,i,r){super(e,t),this.baseColumn=i,this.range=r,this.size=t.size}size;static [s.Q]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=function(e){let[t]=function e(t,i=0){let r=[],n=i,s=!1;for(;n<t.length;){let a=t[n];if(","===a){(s||n===i)&&r.push(""),s=!0,n++;continue}if(s=!1,"\\"===a){n+=2;continue}if('"'===a){let[e,i]=p(t,n+1,!0);r.push(e),n=i;continue}if("}"===a)return[r,n+1];if("{"===a){let[i,s]=e(t,n+1);r.push(i),n=s;continue}let[o,l]=p(t,n,!1);r.push(o),n=l}return[r,n]}(e,1);return t}(e)),e.map(e=>this.baseColumn.mapFromDriverValue(e))}mapToDriverValue(e,t=!1){let i=e.map(e=>null===e?null:(0,s.is)(this.baseColumn,v)?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e));return t?i:function e(t){return`{${t.map(t=>Array.isArray(t)?e(t):"string"==typeof t?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}(i)}}},2182:(e,t,i)=>{i.d(t,{M:()=>a});var r=i(19326),n=i(62315),s=i(12596);class a extends s.b1{static [r.Q]="PgDateColumnBaseBuilder";defaultNow(){return this.default((0,n.i6)`now()`)}}},26073:(e,t,i)=>{i.d(t,{Ec:()=>u,ch:()=>l,hT:()=>d});var r=i(19326),n=i(49237),s=i(12596),a=i(2182);class o extends a.M{static [r.Q]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new l(e,this.config)}}class l extends s.df{static [r.Q]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}class c extends a.M{static [r.Q]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new u(e,this.config)}}class u extends s.df{static [r.Q]="PgDateString";getSQLType(){return"date"}}function d(e,t){let{name:i,config:r}=(0,n.An)(e,t);return r?.mode==="date"?new o(i):new c(i)}},18802:(e,t,i)=>{i.d(t,{O:()=>s});var r=i(19326),n=i(12596);class s extends n.b1{static [r.Q]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...i}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:i}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...i}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:i}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}},12941:(e,t,i)=>{i.d(t,{_L:()=>l});var r=i(19326),n=i(12596),s=i(18802);class a extends s.O{static [r.Q]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new o(e,this.config)}}class o extends n.df{static [r.Q]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return"string"==typeof e?Number.parseInt(e):e}}function l(e){return new a(e??"")}},32851:(e,t,i)=>{i.d(t,{AV:()=>o,y2:()=>a});var r=i(19326),n=i(12596);class s extends n.b1{static [r.Q]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new a(e,this.config)}}class a extends n.df{static [r.Q]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function o(e){return new s(e??"")}},28680:(e,t,i)=>{i.d(t,{B2:()=>a,JB:()=>o});var r=i(19326),n=i(12596);class s extends n.b1{static [r.Q]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new a(e,this.config)}}class a extends n.df{static [r.Q]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function o(e){return new s(e??"")}},43050:(e,t,i)=>{i.d(t,{OJ:()=>o,uR:()=>h});var r=i(19326),n=i(49237),s=i(12596);class a extends s.b1{static [r.Q]="PgNumericBuilder";constructor(e,t,i){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=i}build(e){return new o(e,this.config)}}class o extends s.df{static [r.Q]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return"string"==typeof e?e:String(e)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class l extends s.b1{static [r.Q]="PgNumericNumberBuilder";constructor(e,t,i){super(e,"number","PgNumericNumber"),this.config.precision=t,this.config.scale=i}build(e){return new c(e,this.config)}}class c extends s.df{static [r.Q]="PgNumericNumber";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class u extends s.b1{static [r.Q]="PgNumericBigIntBuilder";constructor(e,t,i){super(e,"bigint","PgNumericBigInt"),this.config.precision=t,this.config.scale=i}build(e){return new d(e,this.config)}}class d extends s.df{static [r.Q]="PgNumericBigInt";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function h(e,t){let{name:i,config:r}=(0,n.An)(e,t),s=r?.mode;return"number"===s?new l(i,r?.precision,r?.scale):"bigint"===s?new u(i,r?.precision,r?.scale):new a(i,r?.precision,r?.scale)}},72140:(e,t,i)=>{i.d(t,{fL:()=>l});var r=i(19326),n=i(49237),s=i(12596);class a extends s.b1{static [r.Q]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new o(e,this.config)}}class o extends s.df{static [r.Q]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function l(e,t={}){let{name:i,config:r}=(0,n.An)(e,t);return new a(i,r)}},77796:(e,t,i)=>{i.d(t,{XV:()=>c,vu:()=>l});var r=i(19326),n=i(49237),s=i(12596),a=i(2182);class o extends a.M{constructor(e,t,i){super(e,"string","PgTime"),this.withTimezone=t,this.precision=i,this.config.withTimezone=t,this.config.precision=i}static [r.Q]="PgTimeBuilder";build(e){return new l(e,this.config)}}class l extends s.df{static [r.Q]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`time${e}${this.withTimezone?" with time zone":""}`}}function c(e,t={}){let{name:i,config:r}=(0,n.An)(e,t);return new o(i,r.withTimezone??!1,r.precision)}},1575:(e,t,i)=>{i.d(t,{AB:()=>d,bf:()=>u,sC:()=>l});var r=i(19326),n=i(49237),s=i(12596),a=i(2182);class o extends a.M{static [r.Q]="PgTimestampBuilder";constructor(e,t,i){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=i}build(e){return new l(e,this.config)}}class l extends s.df{static [r.Q]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":` (${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()}class c extends a.M{static [r.Q]="PgTimestampStringBuilder";constructor(e,t,i){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=i}build(e){return new u(e,this.config)}}class u extends s.df{static [r.Q]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}}function d(e,t={}){let{name:i,config:r}=(0,n.An)(e,t);return r?.mode==="string"?new c(i,r.withTimezone??!1,r.precision):new o(i,r?.withTimezone??!1,r?.precision)}},80967:(e,t,i)=>{i.d(t,{RX:()=>o,Vj:()=>l});var r=i(19326),n=i(62315),s=i(12596);class a extends s.b1{static [r.Q]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default((0,n.i6)`gen_random_uuid()`)}build(e){return new o(e,this.config)}}class o extends s.df{static [r.Q]="PgUUID";getSQLType(){return"uuid"}}function l(e){return new a(e??"")}},56866:(e,t,i)=>{i.d(t,{M:()=>B});var r=i(19326),n=i(1114),s=i(3003),a=i(78586),o=i(7642),l=i(88282),c=i(9193),u=i(62315),d=i(80298),h=i(10836),f=i(49237),p=i(62413),m=i(80405);function g(e){return(0,r.is)(e,m.YA)?[e[d.V_]?`${e[d.V_]}.${e[d.iA.Symbol.BaseName]}`:e[d.iA.Symbol.BaseName]]:(0,r.is)(e,a.k)?e._.usedTables??[]:(0,r.is)(e,u.$s)?e.usedTables??[]:[]}class y{static [r.Q]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t;let i=!!this.fields;return t=this.fields?this.fields:(0,r.is)(e,a.k)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):(0,r.is)(e,o.O)?e[p.d].selectedFields:(0,r.is)(e,u.$s)?{}:(0,f.SS)(e),new w({table:e,fields:t,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class b extends l.b{static [r.Q]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:i,session:r,dialect:n,withList:s,distinct:a}){for(let o of(super(),this.config={withList:s,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=i,this.session=r,this.dialect=n,this._={selectedFields:t,config:this.config},this.tableName=(0,f.dP)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},g(e)))this.usedTables.add(o)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(i,n)=>{let o=this.tableName,l=(0,f.dP)(i);for(let e of g(i))this.usedTables.add(e);if("string"==typeof l&&this.config.joins?.some(e=>e.alias===l))throw Error(`Alias "${l}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof o&&(this.config.fields={[o]:this.config.fields}),"string"==typeof l&&!(0,r.is)(i,u.$s))){let e=(0,r.is)(i,a.k)?i._.selectedFields:(0,r.is)(i,u.G7)?i[p.d].selectedFields:i[d.iA.Symbol.Columns];this.config.fields[l]=e}if("function"==typeof n&&(n=n(new Proxy(this.config.fields,new s.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:i,joinType:e,alias:l,lateral:t}),"string"==typeof l)switch(e){case"left":this.joinsNotNullableMap[l]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[l]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[l]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[l]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return i=>{let r="function"==typeof i?i(S()):i;if(!(0,f.ux)(this.getSelectedFields(),r.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:r}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new s.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new s.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new s.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new s.e({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...g(this.config.table)),this.config.joins)for(let e of this.config.joins)t.push(...g(e.table));return new Proxy(new a.k(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new s.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new s.e({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=void 0===e?{config:{},enable:!0,autoInvalidate:!0}:!1===e?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}}class w extends b{static [r.Q]="PgSelect";_prepare(e){let{session:t,config:i,dialect:r,joinsNotNullableMap:n,authToken:s,cacheConfig:a,usedTables:o}=this;if(!t)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:l}=i;return h.Z.startActiveSpan("drizzle.prepareQuery",()=>{let i=(0,f.ZS)(l),c=t.prepareQuery(r.sqlToQuery(this.getSQL()),i,e,!0,void 0,{type:"select",tables:[...o]},a);return c.joinsNotNullableMap=n,c.setToken(s)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>h.Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}function v(e,t){return(i,r,...n)=>{let s=[r,...n].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of s)if(!(0,f.ux)(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(s)}}(0,f.ef)(w,[c.N]);let S=()=>({union:_,unionAll:A,intersect:x,intersectAll:T,except:k,exceptAll:$}),_=v("union",!1),A=v("union",!0),x=v("intersect",!1),T=v("intersect",!0),k=v("except",!1),$=v("except",!0);class E{static [r.Q]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=(0,r.is)(e,n.n)?e:void 0,this.dialectConfig=(0,r.is)(e,n.n)?void 0:e}$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(i)),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new s.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(i){return new y({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(e){return new y({fields:e??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})},selectDistinctOn:function(e,i){return new y({fields:i??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:e}})}}}select(e){return new y({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new y({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new y({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new n.n(this.dialectConfig)),this.dialect}}class C{constructor(e,t,i,r){this.table=e,this.session=t,this.dialect=i,this.withList=r}static [r.Q]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new P(this.table,(0,f.M6)(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}}class P extends c.N{constructor(e,t,i,r,n){super(),this.session=i,this.dialect=r,this.config={set:t,table:e,withList:n,joins:[]},this.tableName=(0,f.dP)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [r.Q]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){let t=(0,f.dP)(e);return"string"==typeof t&&(this.joinsNotNullableMap[t]=!0),this.config.from=e,this}getTableLikeFields(e){return(0,r.is)(e,m.YA)?e[d.iA.Symbol.Columns]:(0,r.is)(e,a.k)?e._.selectedFields:e[p.d].selectedFields}createJoin(e){return(t,i)=>{let n=(0,f.dP)(t);if("string"==typeof n&&this.config.joins.some(e=>e.alias===n))throw Error(`Alias "${n}" is already used in this query`);if("function"==typeof i){let e=this.config.from&&!(0,r.is)(this.config.from,u.$s)?this.getTableLikeFields(this.config.from):void 0;i=i(new Proxy(this.config.table[d.iA.Symbol.Columns],new s.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),e&&new Proxy(e,new s.e({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:i,table:t,joinType:e,alias:n}),"string"==typeof n)switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!0;break;case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[d.iA.Symbol.Columns]),this.config.from)){let t=(0,f.dP)(this.config.from);if("string"==typeof t&&this.config.from&&!(0,r.is)(this.config.from,u.$s)){let i=this.getTableLikeFields(this.config.from);e[t]=i}for(let t of this.config.joins){let i=(0,f.dP)(t.table);if("string"==typeof i&&!(0,r.is)(t.table,u.$s)){let r=this.getTableLikeFields(t.table);e[i]=r}}}return this.config.returningFields=e,this.config.returning=(0,f.ZS)(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:g(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new s.e({alias:(0,d.SP)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class Q{constructor(e,t,i,r,n){this.table=e,this.session=t,this.dialect=i,this.withList=r,this.overridingSystemValue_=n}static [r.Q]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[d.iA.Symbol.Columns];for(let n of Object.keys(e)){let s=e[n];t[n]=(0,r.is)(s,u.$s)?s:new u.dO(s,i[n])}return t});return new N(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t="function"==typeof e?e(new E):e;if(!(0,r.is)(t,u.$s)&&!(0,f.ux)(this.table[d.oe],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new N(this.table,t,this.session,this.dialect,this.withList,!0)}}class N extends c.N{constructor(e,t,i,r,n,s,a){super(),this.session=i,this.dialect=r,this.config={table:e,values:t,withList:n,select:s,overridingSystemValue_:a}}static [r.Q]="PgInsert";config;cacheConfig;returning(e=this.config.table[d.iA.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=(0,f.ZS)(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=(0,u.i6)`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let i=e.where?(0,u.i6)` where ${e.where}`:void 0;this.config.onConflict=(0,u.i6)`(${u.i6.raw(t)})${i} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?(0,u.i6)` where ${e.where}`:void 0,i=e.targetWhere?(0,u.i6)` where ${e.targetWhere}`:void 0,r=e.setWhere?(0,u.i6)` where ${e.setWhere}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,(0,f.M6)(this.config.table,e.set)),s="";return s=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=(0,u.i6)`(${u.i6.raw(s)})${i} do update set ${n}${t}${r}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return h.Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:g(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>h.Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new s.e({alias:(0,d.SP)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class O extends c.N{constructor(e,t,i,r){super(),this.session=t,this.dialect=i,this.config={table:e,withList:r}}static [r.Q]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[d.iA.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=(0,f.ZS)(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return h.Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:g(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>h.Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new s.e({alias:(0,d.SP)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class q extends u.$s{constructor(e){super(q.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=q.buildCount(e.source,e.filters)}sql;token;static [r.Q]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return(0,u.i6)`(select count(*) from ${e}${u.i6.raw(" where ").if(t)}${t})`}static buildCount(e,t){return(0,u.i6)`select count(*) as count from ${e}${u.i6.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}var I=i(1608);class j{constructor(e,t,i,r,n,s,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=r,this.tableConfig=n,this.dialect=s,this.session=a}static [r.Q]="PgRelationalQueryBuilder";findMany(e){return new L(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new L(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class L extends c.N{constructor(e,t,i,r,n,s,a,o,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=r,this.tableConfig=n,this.dialect=s,this.session=a,this.config=o,this.mode=l}static [r.Q]="PgRelationalQuery";_prepare(e){return h.Z.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:i}=this._toSQL();return this.session.prepareQuery(i,void 0,e,!0,(e,i)=>{let r=e.map(e=>(0,I.WX)(this.schema,this.tableConfig,e,t.selection,i));return"first"===this.mode?r[0]:r})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return h.Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class U extends c.N{constructor(e,t,i,r){super(),this.execute=e,this.sql=t,this.query=i,this.mapBatchResult=r}static [r.Q]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}class D extends c.N{constructor(e,t,i){super(),this.session=t,this.dialect=i,this.config={view:e}}static [r.Q]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return h.Z.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>h.Z.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}class B{constructor(e,t,i){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[r,n]of Object.entries(this._.schema))this.query[r]=new j(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[r],n,e,t);this.$cache={invalidate:async e=>{}}}static [r.Q]="PgDatabase";query;$with=(e,t)=>{let i=this;return{as:r=>("function"==typeof r&&(r=r(new E(i.dialect))),new Proxy(new a.S(r.getSQL(),t??("getSelectedFields"in r?r.getSelectedFields()??{}:{}),e,!0),new s.e({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new q({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;return{select:function(i){return new y({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new y({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},selectDistinctOn:function(i,r){return new y({fields:r??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:i}})},update:function(i){return new C(i,t.session,t.dialect,e)},insert:function(i){return new Q(i,t.session,t.dialect,e)},delete:function(i){return new O(i,t.session,t.dialect,e)}}}select(e){return new y({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new y({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new y({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new C(e,this.session,this.dialect)}insert(e){return new Q(e,this.session,this.dialect)}delete(e){return new O(e,this.session,this.dialect)}refreshMaterializedView(e){return new D(e,this.session,this.dialect)}authToken;execute(e){let t="string"==typeof e?u.i6.raw(e):e.getSQL(),i=this.dialect.sqlToQuery(t),r=this.session.prepareQuery(i,void 0,void 0,!1);return new U(()=>r.execute(void 0,this.authToken),t,i,e=>r.mapResult(e,!0))}transaction(e,t){return this.session.transaction(e,t)}}},1114:(e,t,i)=>{i.d(t,{n:()=>T});var r=i(2285),n=i(85675),s=i(83596),a=i(19326),o=i(7313),l=i(12596),c=i(28680),u=i(32851),d=i(43050),h=i(77796),f=i(1575),p=i(26073),m=i(80967),g=i(80405),y=i(1608),b=i(62315),w=i(57745),v=i(78586),S=i(80298),_=i(49237),A=i(62413),x=i(7642);class T{static [a.Q]="PgDialect";casing;constructor(e){this.casing=new n.xC(e?.casing)}async migrate(e,t,i){let r="string"==typeof i?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",n="string"==typeof i?"drizzle":i.migrationsSchema??"drizzle",s=(0,b.i6)`
			CREATE TABLE IF NOT EXISTS ${b.i6.identifier(n)}.${b.i6.identifier(r)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute((0,b.i6)`CREATE SCHEMA IF NOT EXISTS ${b.i6.identifier(n)}`),await t.execute(s);let a=(await t.all((0,b.i6)`select id, hash, created_at from ${b.i6.identifier(n)}.${b.i6.identifier(r)} order by created_at desc limit 1`))[0];await t.transaction(async t=>{for await(let i of e)if(!a||Number(a.created_at)<i.folderMillis){for(let e of i.sql)await t.execute(b.i6.raw(e));await t.execute((0,b.i6)`insert into ${b.i6.identifier(n)}.${b.i6.identifier(r)} ("hash", "created_at") values(${i.hash}, ${i.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[(0,b.i6)`with `];for(let[i,r]of e.entries())t.push((0,b.i6)`${b.i6.identifier(r._.alias)} as (${r._.sql})`),i<e.length-1&&t.push((0,b.i6)`, `);return t.push((0,b.i6)` `),b.i6.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:r}){let n=this.buildWithCTE(r),s=i?(0,b.i6)` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,a=t?(0,b.i6)` where ${t}`:void 0;return(0,b.i6)`${n}delete from ${e}${a}${s}`}buildUpdateSet(e,t){let i=e[S.iA.Symbol.Columns],r=Object.keys(i).filter(e=>void 0!==t[e]||i[e]?.onUpdateFn!==void 0),n=r.length;return b.i6.join(r.flatMap((e,r)=>{let s=i[e],a=t[e]??b.i6.param(s.onUpdateFn(),s),o=(0,b.i6)`${b.i6.identifier(this.casing.getColumnCasing(s))} = ${a}`;return r<n-1?[o,b.i6.raw(", ")]:[o]}))}buildUpdateQuery({table:e,set:t,where:i,returning:r,withList:n,from:s,joins:a}){let o=this.buildWithCTE(n),l=e[g.YA.Symbol.Name],c=e[g.YA.Symbol.Schema],u=e[g.YA.Symbol.OriginalName],d=l===u?void 0:l,h=(0,b.i6)`${c?(0,b.i6)`${b.i6.identifier(c)}.`:void 0}${b.i6.identifier(u)}${d&&(0,b.i6)` ${b.i6.identifier(d)}`}`,f=this.buildUpdateSet(e,t),p=s&&b.i6.join([b.i6.raw(" from "),this.buildFromTable(s)]),m=this.buildJoins(a),y=r?(0,b.i6)` returning ${this.buildSelection(r,{isSingleTable:!s})}`:void 0,w=i?(0,b.i6)` where ${i}`:void 0;return(0,b.i6)`${o}update ${h} set ${f}${p}${m}${w}${y}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,r=e.flatMap(({field:e},r)=>{let n=[];if((0,a.is)(e,b.$s.Aliased)&&e.isSelectionField)n.push(b.i6.identifier(e.fieldAlias));else if((0,a.is)(e,b.$s.Aliased)||(0,a.is)(e,b.$s)){let i=(0,a.is)(e,b.$s.Aliased)?e.sql:e;t?n.push(new b.$s(i.queryChunks.map(e=>(0,a.is)(e,l.df)?b.i6.identifier(this.casing.getColumnCasing(e)):e))):n.push(i),(0,a.is)(e,b.$s.Aliased)&&n.push((0,b.i6)` as ${b.i6.identifier(e.fieldAlias)}`)}else(0,a.is)(e,s.s)&&(t?n.push(b.i6.identifier(this.casing.getColumnCasing(e))):n.push(e));return r<i-1&&n.push((0,b.i6)`, `),n});return b.i6.join(r)}buildJoins(e){if(!e||0===e.length)return;let t=[];for(let[i,r]of e.entries()){0===i&&t.push((0,b.i6)` `);let n=r.table,s=r.lateral?(0,b.i6)` lateral`:void 0,o=r.on?(0,b.i6)` on ${r.on}`:void 0;if((0,a.is)(n,g.YA)){let e=n[g.YA.Symbol.Name],i=n[g.YA.Symbol.Schema],a=n[g.YA.Symbol.OriginalName],l=e===a?void 0:r.alias;t.push((0,b.i6)`${b.i6.raw(r.joinType)} join${s} ${i?(0,b.i6)`${b.i6.identifier(i)}.`:void 0}${b.i6.identifier(a)}${l&&(0,b.i6)` ${b.i6.identifier(l)}`}${o}`)}else if((0,a.is)(n,b.G7)){let e=n[A.d].name,i=n[A.d].schema,a=n[A.d].originalName,l=e===a?void 0:r.alias;t.push((0,b.i6)`${b.i6.raw(r.joinType)} join${s} ${i?(0,b.i6)`${b.i6.identifier(i)}.`:void 0}${b.i6.identifier(a)}${l&&(0,b.i6)` ${b.i6.identifier(l)}`}${o}`)}else t.push((0,b.i6)`${b.i6.raw(r.joinType)} join${s} ${n}${o}`);i<e.length-1&&t.push((0,b.i6)` `)}return b.i6.join(t)}buildFromTable(e){if((0,a.is)(e,S.iA)&&e[S.iA.Symbol.IsAlias]){let t=(0,b.i6)`${b.i6.identifier(e[S.iA.Symbol.OriginalName])}`;return e[S.iA.Symbol.Schema]&&(t=(0,b.i6)`${b.i6.identifier(e[S.iA.Symbol.Schema])}.${t}`),(0,b.i6)`${t} ${b.i6.identifier(e[S.iA.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:r,having:n,table:o,joins:l,orderBy:c,groupBy:u,limit:d,offset:h,lockingClause:f,distinct:p,setOperators:m}){let g,y,w;let T=i??(0,_.ZS)(t);for(let e of T){let t;if((0,a.is)(e.field,s.s)&&(0,S.SP)(e.field.table)!==((0,a.is)(o,v.k)?o._.alias:(0,a.is)(o,x.O)?o[A.d].name:(0,a.is)(o,b.$s)?void 0:(0,S.SP)(o))&&(t=e.field.table,!l?.some(({alias:e})=>e===(t[S.iA.Symbol.IsAlias]?S.SP(t):t[S.iA.Symbol.BaseName])))){let t=(0,S.SP)(e.field.table);throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let k=!l||0===l.length,$=this.buildWithCTE(e);p&&(g=!0===p?(0,b.i6)` distinct`:(0,b.i6)` distinct on (${b.i6.join(p.on,(0,b.i6)`, `)})`);let E=this.buildSelection(T,{isSingleTable:k}),C=this.buildFromTable(o),P=this.buildJoins(l),Q=r?(0,b.i6)` where ${r}`:void 0,N=n?(0,b.i6)` having ${n}`:void 0;c&&c.length>0&&(y=(0,b.i6)` order by ${b.i6.join(c,(0,b.i6)`, `)}`),u&&u.length>0&&(w=(0,b.i6)` group by ${b.i6.join(u,(0,b.i6)`, `)}`);let O="object"==typeof d||"number"==typeof d&&d>=0?(0,b.i6)` limit ${d}`:void 0,q=h?(0,b.i6)` offset ${h}`:void 0,I=b.i6.empty();if(f){let e=(0,b.i6)` for ${b.i6.raw(f.strength)}`;f.config.of&&e.append((0,b.i6)` of ${b.i6.join(Array.isArray(f.config.of)?f.config.of:[f.config.of],(0,b.i6)`, `)}`),f.config.noWait?e.append((0,b.i6)` nowait`):f.config.skipLocked&&e.append((0,b.i6)` skip locked`),I.append(e)}let j=(0,b.i6)`${$}select${g} ${E} from ${C}${P}${Q}${w}${N}${y}${O}${q}${I}`;return m.length>0?this.buildSetOperations(j,m):j}buildSetOperations(e,t){let[i,...r]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===r.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),r)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:r,limit:n,orderBy:s,offset:o}}){let c;let u=(0,b.i6)`(${e.getSQL()}) `,d=(0,b.i6)`(${r.getSQL()})`;if(s&&s.length>0){let e=[];for(let t of s)if((0,a.is)(t,l.df))e.push(b.i6.identifier(t.name));else if((0,a.is)(t,b.$s)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];(0,a.is)(i,l.df)&&(t.queryChunks[e]=b.i6.identifier(i.name))}e.push((0,b.i6)`${t}`)}else e.push((0,b.i6)`${t}`);c=(0,b.i6)` order by ${b.i6.join(e,(0,b.i6)`, `)} `}let h="object"==typeof n||"number"==typeof n&&n>=0?(0,b.i6)` limit ${n}`:void 0,f=b.i6.raw(`${t} ${i?"all ":""}`),p=o?(0,b.i6)` offset ${o}`:void 0;return(0,b.i6)`${u}${f}${d}${c}${h}${p}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:r,withList:n,select:s,overridingSystemValue_:o}){let l=[],c=Object.entries(e[S.iA.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),u=c.map(([,e])=>b.i6.identifier(this.casing.getColumnCasing(e)));if(s)(0,a.is)(t,b.$s)?l.push(t):l.push(t.getSQL());else for(let[e,i]of(l.push(b.i6.raw("values ")),t.entries())){let r=[];for(let[e,t]of c){let n=i[e];if(void 0===n||(0,a.is)(n,b.dO)&&void 0===n.value){if(void 0!==t.defaultFn){let e=t.defaultFn(),i=(0,a.is)(e,b.$s)?e:b.i6.param(e,t);r.push(i)}else if(t.default||void 0===t.onUpdateFn)r.push((0,b.i6)`default`);else{let e=t.onUpdateFn(),i=(0,a.is)(e,b.$s)?e:b.i6.param(e,t);r.push(i)}}else r.push(n)}l.push(r),e<t.length-1&&l.push((0,b.i6)`, `)}let d=this.buildWithCTE(n),h=b.i6.join(l),f=r?(0,b.i6)` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,p=i?(0,b.i6)` on conflict ${i}`:void 0,m=!0===o?(0,b.i6)`overriding system value `:void 0;return(0,b.i6)`${d}insert into ${e} ${u} ${m}${h}${p}${f}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:i}){let r=t?(0,b.i6)` concurrently`:void 0,n=i?(0,b.i6)` with no data`:void 0;return(0,b.i6)`refresh materialized view${r} ${e}${n}`}prepareTyping(e){return(0,a.is)(e,c.B2)||(0,a.is)(e,u.y2)?"json":(0,a.is)(e,d.OJ)?"decimal":(0,a.is)(e,h.vu)?"time":(0,a.is)(e,f.sC)||(0,a.is)(e,f.bf)?"timestamp":(0,a.is)(e,p.ch)||(0,a.is)(e,p.Ec)?"date":(0,a.is)(e,m.RX)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:n,tableConfig:l,queryConfig:c,tableAlias:u,nestedQueryRelation:d,joinOn:h}){let f,p=[],m,_,A=[],x,T=[];if(!0===c)p=Object.entries(l.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:(0,r.lw)(t,u),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let n=Object.fromEntries(Object.entries(l.columns).map(([e,t])=>[e,(0,r.lw)(t,u)]));if(c.where){let e="function"==typeof c.where?c.where(n,(0,y.vU)()):c.where;x=e&&(0,r.UI)(e,u)}let o=[],d=[];if(c.columns){let e=!1;for(let[t,i]of Object.entries(c.columns))void 0!==i&&t in l.columns&&(e||!0!==i||(e=!0),d.push(t));d.length>0&&(d=e?d.filter(e=>c.columns?.[e]===!0):Object.keys(l.columns).filter(e=>!d.includes(e)))}else d=Object.keys(l.columns);for(let e of d){let t=l.columns[e];o.push({tsKey:e,value:t})}let h=[];if(c.with&&(h=Object.entries(c.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:l.relations[e]}))),c.extras)for(let[e,t]of Object.entries("function"==typeof c.extras?c.extras(n,{sql:b.i6}):c.extras))o.push({tsKey:e,value:(0,r.qD)(t,u)});for(let{tsKey:e,value:t}of o)p.push({dbKey:(0,a.is)(t,b.$s.Aliased)?t.fieldAlias:l.columns[e].name,tsKey:e,field:(0,a.is)(t,s.s)?(0,r.lw)(t,u):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let f="function"==typeof c.orderBy?c.orderBy(n,(0,y.pl)()):c.orderBy??[];for(let{tsKey:n,queryConfig:o,relation:l}of(Array.isArray(f)||(f=[f]),A=f.map(e=>(0,a.is)(e,s.s)?(0,r.lw)(e,u):(0,r.UI)(e,u)),m=c.limit,_=c.offset,h)){let s=(0,y.wG)(t,i,l),c=i[(0,S.Q0)(l.referencedTable)],d=`${u}_${n}`,h=(0,w.xD)(...s.fields.map((e,t)=>(0,w.eq)((0,r.lw)(s.references[t],d),(0,r.lw)(e,u)))),f=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:e[c],tableConfig:t[c],queryConfig:(0,a.is)(l,y.fh)?!0===o?{limit:1}:{...o,limit:1}:o,tableAlias:d,joinOn:h,nestedQueryRelation:l}),m=(0,b.i6)`${b.i6.identifier(d)}.${b.i6.identifier("data")}`.as(n);T.push({on:(0,b.i6)`true`,table:new v.k(f.sql,{},d),alias:d,joinType:"left",lateral:!0}),p.push({dbKey:n,tsKey:n,field:m,relationTableTsKey:c,isJson:!0,selection:f.selection})}}if(0===p.length)throw new o.kR({message:`No fields selected for table "${l.tsName}" ("${u}")`});if(x=(0,w.xD)(h,x),d){let e=(0,b.i6)`json_build_array(${b.i6.join(p.map(({field:e,tsKey:t,isJson:i})=>i?(0,b.i6)`${b.i6.identifier(`${u}_${t}`)}.${b.i6.identifier("data")}`:(0,a.is)(e,b.$s.Aliased)?e.sql:e),(0,b.i6)`, `)})`;(0,a.is)(d,y.sj)&&(e=(0,b.i6)`coalesce(json_agg(${e}${A.length>0?(0,b.i6)` order by ${b.i6.join(A,(0,b.i6)`, `)}`:void 0}), '[]'::json)`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:l.tsName,selection:p}];void 0!==m||void 0!==_||A.length>0?(f=this.buildSelectQuery({table:(0,r.RQ)(n,u),fields:{},fieldsFlat:[{path:[],field:b.i6.raw("*")}],where:x,limit:m,offset:_,orderBy:A,setOperators:[]}),x=void 0,m=void 0,_=void 0,A=[]):f=(0,r.RQ)(n,u),f=this.buildSelectQuery({table:(0,a.is)(f,g.YA)?f:new v.k(f,{},u),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,a.is)(e,s.s)?(0,r.lw)(e,u):e})),joins:T,where:x,limit:m,offset:_,orderBy:A,setOperators:[]})}else f=this.buildSelectQuery({table:(0,r.RQ)(n,u),fields:{},fieldsFlat:p.map(({field:e})=>({path:[],field:(0,a.is)(e,s.s)?(0,r.lw)(e,u):e})),joins:T,where:x,limit:m,offset:_,orderBy:A,setOperators:[]});return{tableTsKey:l.tsName,sql:f,selection:p}}}},89401:(e,t,i)=>{i.d(t,{CK:()=>s,ut:()=>a});var r=i(19326),n=i(80405);function s(...e){return e[0].columns?new a(e[0].columns,e[0].name):new a(e)}class a{static [r.Q]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new o(e,this.columns,this.name)}}class o{constructor(e,t,i){this.table=e,this.columns=t,this.name=i}static [r.Q]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[n.YA.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}},80405:(e,t,i)=>{i.d(t,{YA:()=>eF,af:()=>eJ});var r=i(19326),n=i(80298),s=i(49237),a=i(12596),o=i(18802);class l extends o.O{static [r.Q]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new c(e,this.config)}}class c extends a.df{static [r.Q]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class u extends o.O{static [r.Q]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new d(e,this.config)}}class d extends a.df{static [r.Q]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}function h(e,t){let{name:i,config:r}=(0,s.An)(e,t);return"number"===r.mode?new l(i):new u(i)}class f extends a.b1{static [r.Q]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new p(e,this.config)}}class p extends a.df{static [r.Q]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class m extends a.b1{static [r.Q]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new g(e,this.config)}}class g extends a.df{static [r.Q]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}function y(e,t){let{name:i,config:r}=(0,s.An)(e,t);return"number"===r.mode?new f(i):new m(i)}var b=i(98748);class w extends a.b1{static [r.Q]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new v(e,this.config)}}class v extends a.df{static [r.Q]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function S(e,t={}){let{name:i,config:r}=(0,s.An)(e,t);return new w(i,r)}class _ extends a.b1{static [r.Q]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new A(e,this.config)}}class A extends a.df{static [r.Q]="PgCidr";getSQLType(){return"cidr"}}function x(e){return new _(e??"")}class T extends a.b1{static [r.Q]="PgCustomColumnBuilder";constructor(e,t,i){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=i}build(e){return new k(e,this.config)}}class k extends a.df{static [r.Q]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function $(e){return(t,i)=>{let{name:r,config:n}=(0,s.An)(t,i);return new T(r,n,e)}}var E=i(26073);class C extends a.b1{static [r.Q]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new P(e,this.config)}}class P extends a.df{static [r.Q]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return"string"==typeof e?Number.parseFloat(e):e}}function Q(e){return new C(e??"")}class N extends a.b1{static [r.Q]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new O(e,this.config)}}class O extends a.df{static [r.Q]="PgInet";getSQLType(){return"inet"}}function q(e){return new N(e??"")}var I=i(12941);class j extends a.b1{static [r.Q]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new L(e,this.config)}}class L extends a.df{static [r.Q]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}}function U(e,t={}){let{name:i,config:r}=(0,s.An)(e,t);return new j(i,r)}var D=i(32851),B=i(28680);class R extends a.b1{static [r.Q]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new M(e,this.config)}}class M extends a.df{static [r.Q]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,i,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(i),Number.parseFloat(r)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}class K extends a.b1{static [r.Q]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new F(e,this.config)}}class F extends a.df{static [r.Q]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,i,r]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(i),c:Number.parseFloat(r)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}function J(e,t){let{name:i,config:r}=(0,s.An)(e,t);return r?.mode&&"tuple"!==r.mode?new K(i):new R(i)}class H extends a.b1{static [r.Q]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new z(e,this.config)}}class z extends a.df{static [r.Q]="PgMacaddr";getSQLType(){return"macaddr"}}function W(e){return new H(e??"")}class V extends a.b1{static [r.Q]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Z(e,this.config)}}class Z extends a.df{static [r.Q]="PgMacaddr8";getSQLType(){return"macaddr8"}}function G(e){return new V(e??"")}var Y=i(43050);class X extends a.b1{static [r.Q]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new ee(e,this.config)}}class ee extends a.df{static [r.Q]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,i]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(i)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}class et extends a.b1{static [r.Q]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new ei(e,this.config)}}class ei extends a.df{static [r.Q]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,i]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(i)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}function er(e,t){let{name:i,config:r}=(0,s.An)(e,t);return r?.mode&&"tuple"!==r.mode?new et(i):new X(i)}function en(e,t){let i=new DataView(new ArrayBuffer(8));for(let r=0;r<8;r++)i.setUint8(r,e[t+r]);return i.getFloat64(0,!0)}function es(e){let t=function(e){let t=[];for(let i=0;i<e.length;i+=2)t.push(Number.parseInt(e.slice(i,i+2),16));return new Uint8Array(t)}(e),i=0,r=t[0];i+=1;let n=new DataView(t.buffer),s=n.getUint32(i,1===r);if(i+=4,536870912&s&&(n.getUint32(i,1===r),i+=4),(65535&s)==1){let e=en(t,i),r=en(t,i+=8);return i+=8,[e,r]}throw Error("Unsupported geometry type")}class ea extends a.b1{static [r.Q]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new eo(e,this.config)}}class eo extends a.df{static [r.Q]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return es(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}class el extends a.b1{static [r.Q]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new ec(e,this.config)}}class ec extends a.df{static [r.Q]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=es(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}function eu(e,t){let{name:i,config:r}=(0,s.An)(e,t);return r?.mode&&"tuple"!==r.mode?new el(i):new ea(i)}class ed extends a.b1{static [r.Q]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new eh(e,this.config)}}class eh extends a.df{static [r.Q]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>"string"==typeof e?Number.parseFloat(e):e}function ef(e){return new ed(e??"")}class ep extends a.b1{static [r.Q]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new em(e,this.config)}}class em extends a.df{static [r.Q]="PgSerial";getSQLType(){return"serial"}}function eg(e){return new ep(e??"")}class ey extends o.O{static [r.Q]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new eb(e,this.config)}}class eb extends a.df{static [r.Q]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>"string"==typeof e?Number(e):e}function ew(e){return new ey(e??"")}class ev extends a.b1{static [r.Q]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new eS(e,this.config)}}class eS extends a.df{static [r.Q]="PgSmallSerial";getSQLType(){return"smallserial"}}function e_(e){return new ev(e??"")}var eA=i(72140),ex=i(77796),eT=i(1575),ek=i(80967);class e$ extends a.b1{static [r.Q]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new eE(e,this.config)}}class eE extends a.df{static [r.Q]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function eC(e,t={}){let{name:i,config:r}=(0,s.An)(e,t);return new e$(i,r)}class eP extends a.b1{static [r.Q]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new eQ(e,this.config)}}class eQ extends a.df{static [r.Q]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function eN(e,t){let{name:i,config:r}=(0,s.An)(e,t);return new eP(i,r)}class eO extends a.b1{static [r.Q]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new eq(e,this.config)}}class eq extends a.df{static [r.Q]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function eI(e,t){let{name:i,config:r}=(0,s.An)(e,t);return new eO(i,r)}class ej extends a.b1{static [r.Q]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new eL(e,this.config)}}class eL extends a.df{static [r.Q]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function eU(e,t){let{name:i,config:r}=(0,s.An)(e,t);return new ej(i,r)}class eD extends a.b1{static [r.Q]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new eB(e,this.config)}}class eB extends a.df{static [r.Q]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function eR(e,t){let{name:i,config:r}=(0,s.An)(e,t);return new eD(i,r)}let eM=Symbol.for("drizzle:PgInlineForeignKeys"),eK=Symbol.for("drizzle:EnableRLS");class eF extends n.iA{static [r.Q]="PgTable";static Symbol=Object.assign({},n.iA.Symbol,{InlineForeignKeys:eM,EnableRLS:eK});[eM]=[];[eK]=!1;[n.iA.Symbol.ExtraConfigBuilder]=void 0;[n.iA.Symbol.ExtraConfigColumns]={}}let eJ=(e,t,i)=>(function(e,t,i,r,s=e){let a=new eF(e,r,s),o="function"==typeof t?t({bigint:h,bigserial:y,boolean:b.O7,char:S,cidr:x,customType:$,date:E.hT,doublePrecision:Q,inet:q,integer:I._L,interval:U,json:D.AV,jsonb:B.JB,line:J,macaddr:W,macaddr8:G,numeric:Y.uR,point:er,geometry:eu,real:ef,serial:eg,smallint:ew,smallserial:e_,text:eA.fL,time:ex.XV,timestamp:eT.AB,uuid:ek.Vj,varchar:eC,bit:eN,halfvec:eI,sparsevec:eU,vector:eR}):t,l=Object.fromEntries(Object.entries(o).map(([e,t])=>{t.setName(e);let i=t.build(a);return a[eM].push(...t.buildForeignKeys(i,a)),[e,i]})),c=Object.fromEntries(Object.entries(o).map(([e,t])=>(t.setName(e),[e,t.buildExtraConfigColumn(a)]))),u=Object.assign(a,l);return u[n.iA.Symbol.Columns]=l,u[n.iA.Symbol.ExtraConfigColumns]=c,i&&(u[eF.Symbol.ExtraConfigBuilder]=i),Object.assign(u,{enableRLS:()=>(u[eF.Symbol.EnableRLS]=!0,u)})})(e,t,i,void 0)},7642:(e,t,i)=>{i.d(t,{O:()=>s});var r=i(19326),n=i(62315);class s extends n.G7{static [r.Q]="PgViewBase"}},7810:(e,t,i)=>{i.d(t,{t:()=>k});var r=i(48937),n=i(19326);class s{static [n.Q]="ConsoleLogWriter";write(e){console.log(e)}}class a{static [n.Q]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new s}logQuery(e,t){let i=t.map(e=>{try{return JSON.stringify(e)}catch{return String(e)}}),r=i.length?` -- params: [${i.join(", ")}]`:"";this.writer.write(`Query: ${e}${r}`)}}class o{static [n.Q]="NoopLogger";logQuery(){}}var l=i(56866),c=i(1114),u=i(1608),d=i(49237);class h{static [n.Q]="Cache"}class f extends h{strategy(){return"all"}static [n.Q]="NoopCache";async get(e){}async put(e,t,i,r){}async onMutate(e){}}async function p(e,t){let i=`${e}-${JSON.stringify(t)}`,r=new TextEncoder().encode(i);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",r))].map(e=>e.toString(16).padStart(2,"0")).join("")}var m=i(7313),g=i(62315),y=i(10836);class b{constructor(e,t,i,r){this.query=e,this.cache=t,this.queryMetadata=i,this.cacheConfig=r,t&&"all"===t.strategy()&&void 0===r&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static [n.Q]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,i){if(void 0===this.cache||(0,n.is)(this.cache,f)||void 0===this.queryMetadata)try{return await i()}catch(i){throw new m.SR(e,t,i)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await i()}catch(i){throw new m.SR(e,t,i)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[e]=await Promise.all([i(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return e}catch(i){throw new m.SR(e,t,i)}if(!this.cacheConfig)try{return await i()}catch(i){throw new m.SR(e,t,i)}if("select"===this.queryMetadata.type){let r=await this.cache.get(this.cacheConfig.tag??await p(e,t),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===r){let r;try{r=await i()}catch(i){throw new m.SR(e,t,i)}return await this.cache.put(this.cacheConfig.tag??await p(e,t),r,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),r}return r}try{return await i()}catch(i){throw new m.SR(e,t,i)}}}class w{constructor(e){this.dialect=e}static [n.Q]="PgSession";execute(e,t){return y.Z.startActiveSpan("drizzle.operation",()=>y.Z.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){return Number((await this.execute(e,t))[0].count)}}class v extends l.M{constructor(e,t,i,r=0){super(e,t,i),this.schema=i,this.nestedIndex=r}static [n.Q]="PgTransaction";rollback(){throw new m.Fx}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),g.i6.raw(t.join(" "))}setTransaction(e){return this.session.execute((0,g.i6)`set transaction ${this.getTransactionConfigSQL(e)}`)}}class S extends b{constructor(e,t,i,r,n,s,a,o,l,c){super({sql:t,params:i},n,s,a),this.client=e,this.queryString=t,this.params=i,this.logger=r,this.fields=o,this._isResponseInArrayMode=l,this.customResultMapper=c}static [n.Q]="PostgresJsPreparedQuery";async execute(e={}){return y.Z.startActiveSpan("drizzle.execute",async t=>{let i=(0,g.Pr)(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.logger.logQuery(this.queryString,i);let{fields:r,queryString:n,client:s,joinsNotNullableMap:a,customResultMapper:o}=this;if(!r&&!o)return y.Z.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(n,i,async()=>await s.unsafe(n,i)));let l=await y.Z.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":n,"drizzle.query.params":JSON.stringify(i)}),this.queryWithCache(n,i,async()=>await s.unsafe(n,i).values())));return y.Z.startActiveSpan("drizzle.mapResponse",()=>o?o(l):l.map(e=>(0,d.M4)(r,e,a)))})}all(e={}){return y.Z.startActiveSpan("drizzle.execute",async t=>{let i=(0,g.Pr)(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.logger.logQuery(this.queryString,i),y.Z.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.queryWithCache(this.queryString,i,async()=>this.client.unsafe(this.queryString,i))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class _ extends w{constructor(e,t,i,r={}){super(t),this.client=e,this.schema=i,this.options=r,this.logger=r.logger??new o,this.cache=r.cache??new f}static [n.Q]="PostgresJsSession";logger;cache;prepareQuery(e,t,i,r,n,s,a){return new S(this.client,e.sql,e.params,this.logger,this.cache,s,a,t,r,n)}query(e,t){return this.logger.logQuery(e,t),this.client.unsafe(e,t).values()}queryObjects(e,t){return this.client.unsafe(e,t)}transaction(e,t){return this.client.begin(async i=>{let r=new _(i,this.dialect,this.schema,this.options),n=new A(this.dialect,r,this.schema);return t&&await n.setTransaction(t),e(n)})}}class A extends v{constructor(e,t,i,r=0){super(e,t,i,r),this.session=t}static [n.Q]="PostgresJsTransaction";transaction(e){return this.session.client.savepoint(t=>{let i=new _(t,this.dialect,this.schema,this.session.options);return e(new A(this.dialect,i,this.schema))})}}class x extends l.M{static [n.Q]="PostgresJsDatabase"}function T(e,t={}){let i,r;let n=e=>e;for(let t of["1184","1082","1083","1114","1182","1185","1115","1231"])e.options.parsers[t]=n,e.options.serializers[t]=n;e.options.serializers["114"]=n,e.options.serializers["3802"]=n;let s=new c.n({casing:t.casing});if(!0===t.logger?i=new a:!1!==t.logger&&(i=t.logger),t.schema){let e=(0,u.pb)(t.schema,u._J);r={fullSchema:t.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}let o=new _(e,s,r,{logger:i,cache:t.cache}),l=new x(s,o,r);return l.$client=e,l.$cache=t.cache,l.$cache&&(l.$cache.invalidate=t.cache?.onMutate),l}function k(...e){if("string"==typeof e[0])return T((0,r.Z)(e[0]),e[1]);if((0,d.wM)(e[0])){let{connection:t,client:i,...n}=e[0];if(i)return T(i,n);if("object"==typeof t&&void 0!==t.url){let{url:e,...i}=t;return T((0,r.Z)(e,i),n)}return T((0,r.Z)(t),n)}return T(e[0],e[1])}(k||(k={})).mock=function(e){return T({options:{parsers:{},serializers:{}}},e)}},88282:(e,t,i)=>{i.d(t,{b:()=>n});var r=i(19326);class n{static [r.Q]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}},9193:(e,t,i)=>{i.d(t,{N:()=>n});var r=i(19326);class n{static [r.Q]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}}},1608:(e,t,i)=>{i.d(t,{sj:()=>p,fh:()=>f,_J:()=>w,pb:()=>y,vU:()=>m,pl:()=>g,WX:()=>function e(t,i,r,a,o=e=>e){let c={};for(let[u,d]of a.entries())if(d.isJson){let n=i.relations[d.tsKey],a=r[u],l="string"==typeof a?JSON.parse(a):a;c[d.tsKey]=(0,s.is)(n,f)?l&&e(t,t[d.relationTableTsKey],l,d.selection,o):l.map(i=>e(t,t[d.relationTableTsKey],i,d.selection,o))}else{let e;let t=o(r[u]),i=d.field;e=(0,s.is)(i,n.s)?i:(0,s.is)(i,l.$s)?i.decoder:i.sql.decoder,c[d.tsKey]=null===t?null:e.mapFromDriverValue(t)}return c},wG:()=>b});var r=i(80298),n=i(83596),s=i(19326),a=i(89401),o=i(57745),l=i(62315);function c(e){return(0,l.i6)`${e} asc`}function u(e){return(0,l.i6)`${e} desc`}class d{constructor(e,t,i){this.sourceTable=e,this.referencedTable=t,this.relationName=i,this.referencedTableName=t[r.iA.Symbol.Name]}static [s.Q]="Relation";referencedTableName;fieldName}class h{constructor(e,t){this.table=e,this.config=t}static [s.Q]="Relations"}class f extends d{constructor(e,t,i,r){super(e,t,i?.relationName),this.config=i,this.isNullable=r}static [s.Q]="One";withFieldName(e){let t=new f(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}}class p extends d{constructor(e,t,i){super(e,t,i?.relationName),this.config=i}static [s.Q]="Many";withFieldName(e){let t=new p(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}function m(){return{and:o.xD,between:o.vX,eq:o.eq,exists:o.Gg,gt:o.gt,gte:o.eg,ilike:o.o$,inArray:o.d3,isNull:o.Ft,isNotNull:o.K0,like:o.vL,lt:o.lt,lte:o.G,ne:o.ne,not:o.ff,notBetween:o.OL,notExists:o.UN,notLike:o.Qg,notIlike:o.mM,notInArray:o.Nl,or:o.or,sql:l.i6}}function g(){return{sql:l.i6,asc:c,desc:u}}function y(e,t){1===Object.keys(e).length&&"default"in e&&!(0,s.is)(e.default,r.iA)&&(e=e.default);let i={},n={},o={};for(let[l,c]of Object.entries(e))if((0,s.is)(c,r.iA)){let e=(0,r.Q0)(c),t=n[e];for(let n of(i[e]=l,o[l]={tsName:l,dbName:c[r.iA.Symbol.Name],schema:c[r.iA.Symbol.Schema],columns:c[r.iA.Symbol.Columns],relations:t?.relations??{},primaryKey:t?.primaryKey??[]},Object.values(c[r.iA.Symbol.Columns])))n.primary&&o[l].primaryKey.push(n);let u=c[r.iA.Symbol.ExtraConfigBuilder]?.(c[r.iA.Symbol.ExtraConfigColumns]);if(u)for(let e of Object.values(u))(0,s.is)(e,a.ut)&&o[l].primaryKey.push(...e.columns)}else if((0,s.is)(c,h)){let e;let s=(0,r.Q0)(c.table),a=i[s];for(let[i,r]of Object.entries(c.config(t(c.table))))if(a){let t=o[a];t.relations[i]=r,e&&t.primaryKey.push(...e)}else s in n||(n[s]={relations:{},primaryKey:e}),n[s].relations[i]=r}return{tables:o,tableNamesMap:i}}function b(e,t,i){if((0,s.is)(i,f)&&i.config)return{fields:i.config.fields,references:i.config.references};let n=t[(0,r.Q0)(i.referencedTable)];if(!n)throw Error(`Table "${i.referencedTable[r.iA.Symbol.Name]}" not found in schema`);let a=e[n];if(!a)throw Error(`Table "${n}" not found in schema`);let o=i.sourceTable,l=t[(0,r.Q0)(o)];if(!l)throw Error(`Table "${o[r.iA.Symbol.Name]}" not found in schema`);let c=[];for(let e of Object.values(a.relations))(i.relationName&&i!==e&&e.relationName===i.relationName||!i.relationName&&e.referencedTable===i.sourceTable)&&c.push(e);if(c.length>1)throw i.relationName?Error(`There are multiple relations with name "${i.relationName}" in table "${n}"`):Error(`There are multiple relations between "${n}" and "${i.sourceTable[r.iA.Symbol.Name]}". Please specify relation name`);if(c[0]&&(0,s.is)(c[0],f)&&c[0].config)return{fields:c[0].config.references,references:c[0].config.fields};throw Error(`There is not enough information to infer relation "${l}.${i.fieldName}"`)}function w(e){return{one:function(t,i){return new f(e,t,i,i?.fields.reduce((e,t)=>e&&t.notNull,!0)??!1)},many:function(t,i){return new p(e,t,i)}}}},3003:(e,t,i)=>{i.d(t,{e:()=>c});var r=i(2285),n=i(83596),s=i(19326),a=i(62315),o=i(78586),l=i(62413);class c{static [s.Q]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if("_"===t)return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===l.d)return{...e[l.d],selectedFields:new Proxy(e[l.d].selectedFields,this)};if("symbol"==typeof t)return e[t];let i=((0,s.is)(e,o.k)?e._.selectedFields:(0,s.is)(e,a.G7)?e[l.d].selectedFields:e)[t];if((0,s.is)(i,a.$s.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!i.isSelectionField)return i.sql;let e=i.clone();return e.isSelectionField=!0,e}if((0,s.is)(i,a.$s)){if("sql"===this.config.sqlBehavior)return i;throw Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,s.is)(i,n.s)?this.config.alias?new Proxy(i,new r.dZ(new Proxy(i.table,new r.wH(this.config.alias,this.config.replaceOriginalName??!1)))):i:"object"!=typeof i||null===i?i:new Proxy(i,new c(this.config))}}},57745:(e,t,i)=>{i.d(t,{Ft:()=>w,G:()=>g,Gg:()=>S,K0:()=>v,Nl:()=>b,OL:()=>x,Qg:()=>k,UN:()=>_,d3:()=>y,eg:()=>p,eq:()=>l,ff:()=>h,gt:()=>f,lt:()=>m,mM:()=>E,ne:()=>c,o$:()=>$,or:()=>d,vL:()=>T,vX:()=>A,xD:()=>u});var r=i(83596),n=i(19326),s=i(80298),a=i(62315);function o(e,t){return!(0,a._B)(t)||(0,a.zl)(e)||(0,n.is)(e,a.dO)||(0,n.is)(e,a.Vm)||(0,n.is)(e,r.s)||(0,n.is)(e,s.iA)||(0,n.is)(e,a.G7)?e:new a.dO(e,t)}let l=(e,t)=>(0,a.i6)`${e} = ${o(t,e)}`,c=(e,t)=>(0,a.i6)`${e} <> ${o(t,e)}`;function u(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new a.$s(1===t.length?t:[new a.Zm("("),a.i6.join(t,new a.Zm(" and ")),new a.Zm(")")])}function d(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new a.$s(1===t.length?t:[new a.Zm("("),a.i6.join(t,new a.Zm(" or ")),new a.Zm(")")])}function h(e){return(0,a.i6)`not ${e}`}let f=(e,t)=>(0,a.i6)`${e} > ${o(t,e)}`,p=(e,t)=>(0,a.i6)`${e} >= ${o(t,e)}`,m=(e,t)=>(0,a.i6)`${e} < ${o(t,e)}`,g=(e,t)=>(0,a.i6)`${e} <= ${o(t,e)}`;function y(e,t){return Array.isArray(t)?0===t.length?(0,a.i6)`false`:(0,a.i6)`${e} in ${t.map(t=>o(t,e))}`:(0,a.i6)`${e} in ${o(t,e)}`}function b(e,t){return Array.isArray(t)?0===t.length?(0,a.i6)`true`:(0,a.i6)`${e} not in ${t.map(t=>o(t,e))}`:(0,a.i6)`${e} not in ${o(t,e)}`}function w(e){return(0,a.i6)`${e} is null`}function v(e){return(0,a.i6)`${e} is not null`}function S(e){return(0,a.i6)`exists ${e}`}function _(e){return(0,a.i6)`not exists ${e}`}function A(e,t,i){return(0,a.i6)`${e} between ${o(t,e)} and ${o(i,e)}`}function x(e,t,i){return(0,a.i6)`${e} not between ${o(t,e)} and ${o(i,e)}`}function T(e,t){return(0,a.i6)`${e} like ${t}`}function k(e,t){return(0,a.i6)`${e} not like ${t}`}function $(e,t){return(0,a.i6)`${e} ilike ${t}`}function E(e,t){return(0,a.i6)`${e} not ilike ${t}`}},62315:(e,t,i)=>{i.d(t,{dO:()=>A,Vm:()=>T,$s:()=>b,Zm:()=>y,G7:()=>E,Pr:()=>k,_B:()=>v,zl:()=>g,i6:()=>x});var r=i(19326),n=i(12596);class s extends n.b1{static [r.Q]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string","PgEnumObjectColumn"),this.config.enum=t}build(e){return new a(e,this.config)}}class a extends n.df{static [r.Q]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}let o=Symbol.for("drizzle:isPgEnum");class l extends n.b1{static [r.Q]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new c(e,this.config)}}class c extends n.df{static [r.Q]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}var u=i(78586),d=i(10836),h=i(62413),f=i(83596),p=i(80298);class m{static [r.Q]=null}function g(e){return null!=e&&"function"==typeof e.getSQL}class y{static [r.Q]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new b([this])}}class b{constructor(e){for(let t of(this.queryChunks=e,e))if((0,r.is)(t,p.iA)){let e=t[p.iA.Symbol.Schema];this.usedTables.push(void 0===e?t[p.iA.Symbol.Name]:e+"."+t[p.iA.Symbol.Name])}}static [r.Q]="SQL";decoder=S;shouldInlineParams=!1;usedTables=[];append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return d.Z.startActiveSpan("drizzle.buildSQL",t=>{let i=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":i.sql,"drizzle.query.params":JSON.stringify(i.params)}),i})}buildQueryFromSourceParams(e,t){let i=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:n,escapeName:s,escapeParam:a,prepareTyping:l,inlineParams:c,paramStartIndex:d}=i;return function(e){let t={sql:"",params:[]};for(let i of e)t.sql+=i.sql,t.params.push(...i.params),i.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...i.typings));return t}(e.map(e=>{if((0,r.is)(e,y))return{sql:e.value.join(""),params:[]};if((0,r.is)(e,w))return{sql:s(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){let t=[new y("(")];for(let[i,r]of e.entries())t.push(r),i<e.length-1&&t.push(new y(", "));return t.push(new y(")")),this.buildQueryFromSourceParams(t,i)}if((0,r.is)(e,b))return this.buildQueryFromSourceParams(e.queryChunks,{...i,inlineParams:c||e.shouldInlineParams});if((0,r.is)(e,p.iA)){let t=e[p.iA.Symbol.Schema],i=e[p.iA.Symbol.Name];return{sql:void 0===t||e[p.Zk]?s(i):s(t)+"."+s(i),params:[]}}if((0,r.is)(e,f.s)){let i=n.getColumnCasing(e);if("indexes"===t.invokeSource)return{sql:s(i),params:[]};let r=e.table[p.iA.Symbol.Schema];return{sql:e.table[p.Zk]||void 0===r?s(e.table[p.iA.Symbol.Name])+"."+s(i):s(r)+"."+s(e.table[p.iA.Symbol.Name])+"."+s(i),params:[]}}if((0,r.is)(e,E)){let t=e[h.d].schema,i=e[h.d].name;return{sql:void 0===t||e[h.d].isAlias?s(i):s(t)+"."+s(i),params:[]}}if((0,r.is)(e,A)){if((0,r.is)(e.value,T))return{sql:a(d.value++,e),params:[e],typings:["none"]};let t=null===e.value?null:e.encoder.mapToDriverValue(e.value);if((0,r.is)(t,b))return this.buildQueryFromSourceParams([t],i);if(c)return{sql:this.mapInlineParam(t,i),params:[]};let n=["none"];return l&&(n=[l(e.encoder)]),{sql:a(d.value++,t),params:[t],typings:n}}return(0,r.is)(e,T)?{sql:a(d.value++,e),params:[e],typings:["none"]}:(0,r.is)(e,b.Aliased)&&void 0!==e.fieldAlias?{sql:s(e.fieldAlias),params:[]}:(0,r.is)(e,u.k)?e._.isWith?{sql:s(e._.alias),params:[]}:this.buildQueryFromSourceParams([new y("("),e._.sql,new y(") "),new w(e._.alias)],i):e&&"function"==typeof e&&o in e&&!0===e[o]?e.schema?{sql:s(e.schema)+"."+s(e.enumName),params:[]}:{sql:s(e.enumName),params:[]}:g(e)?e.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([e.getSQL()],i):this.buildQueryFromSourceParams([new y("("),e.getSQL(),new y(")")],i):c?{sql:this.mapInlineParam(e,i),params:[]}:{sql:a(d.value++,e),params:[e],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){let i=e.toString();return"[object Object]"===i?t(JSON.stringify(e)):t(i)}throw Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new b.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}}class w{constructor(e){this.value=e}static [r.Q]="Name";brand;getSQL(){return new b([this])}}function v(e){return"object"==typeof e&&null!==e&&"mapToDriverValue"in e&&"function"==typeof e.mapToDriverValue}let S={mapFromDriverValue:e=>e},_={mapToDriverValue:e=>e};({...S,..._});class A{constructor(e,t=_){this.value=e,this.encoder=t}static [r.Q]="Param";brand;getSQL(){return new b([this])}}function x(e,...t){let i=[];for(let[r,n]of((t.length>0||e.length>0&&""!==e[0])&&i.push(new y(e[0])),t.entries()))i.push(n,new y(e[r+1]));return new b(i)}(e=>{e.empty=function(){return new b([])},e.fromList=function(e){return new b(e)},e.raw=function(e){return new b([new y(e)])},e.join=function(e,t){let i=[];for(let[r,n]of e.entries())r>0&&void 0!==t&&i.push(t),i.push(n);return new b(i)},e.identifier=function(e){return new w(e)},e.placeholder=function(e){return new T(e)},e.param=function(e,t){return new A(e,t)}})(x||(x={})),(e=>{class t{constructor(e,t){this.sql=e,this.fieldAlias=t}static [r.Q]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new t(this.sql,this.fieldAlias)}}e.Aliased=t})(b||(b={}));class T{constructor(e){this.name=e}static [r.Q]="Placeholder";getSQL(){return new b([this])}}function k(e,t){return e.map(e=>{if((0,r.is)(e,T)){if(!(e.name in t))throw Error(`No value for placeholder "${e.name}" was provided`);return t[e.name]}if((0,r.is)(e,A)&&(0,r.is)(e.value,T)){if(!(e.value.name in t))throw Error(`No value for placeholder "${e.value.name}" was provided`);return e.encoder.mapToDriverValue(t[e.value.name])}return e})}let $=Symbol.for("drizzle:IsDrizzleView");class E{static [r.Q]="View";[h.d];[$]=!0;constructor({name:e,schema:t,selectedFields:i,query:r}){this[h.d]={name:e,originalName:e,schema:t,selectedFields:i,query:r,isExisting:!r,isAlias:!1}}getSQL(){return new b([this])}}f.s.prototype.getSQL=function(){return new b([this])},p.iA.prototype.getSQL=function(){return new b([this])},u.k.prototype.getSQL=function(){return new b([this])}},78586:(e,t,i)=>{i.d(t,{S:()=>s,k:()=>n});var r=i(19326);class n{static [r.Q]="Subquery";constructor(e,t,i,r=!1,n=[]){this._={brand:"Subquery",sql:e,selectedFields:t,alias:i,isWith:r,usedTables:n}}}class s extends n{static [r.Q]="WithSubquery"}},80298:(e,t,i)=>{i.d(t,{Q0:()=>m,SP:()=>p,V_:()=>s,Zk:()=>u,iA:()=>f,oe:()=>a});var r=i(19326),n=i(18933);let s=Symbol.for("drizzle:Schema"),a=Symbol.for("drizzle:Columns"),o=Symbol.for("drizzle:ExtraConfigColumns"),l=Symbol.for("drizzle:OriginalName"),c=Symbol.for("drizzle:BaseName"),u=Symbol.for("drizzle:IsAlias"),d=Symbol.for("drizzle:ExtraConfigBuilder"),h=Symbol.for("drizzle:IsDrizzleTable");class f{static [r.Q]="Table";static Symbol={Name:n.m,Schema:s,OriginalName:l,Columns:a,ExtraConfigColumns:o,BaseName:c,IsAlias:u,ExtraConfigBuilder:d};[n.m];[l];[s];[a];[o];[c];[u]=!1;[h]=!0;[d]=void 0;constructor(e,t,i){this[n.m]=this[l]=e,this[s]=t,this[c]=i}}function p(e){return e[n.m]}function m(e){return`${e[s]??"public"}.${e[n.m]}`}},18933:(e,t,i)=>{i.d(t,{m:()=>r});let r=Symbol.for("drizzle:Name")},19082:(e,t,i)=>{i.d(t,{t:()=>r});function r(e,...t){return e(...t)}},10836:(e,t,i)=>{let r,n;i.d(t,{Z:()=>a});var s=i(19082);let a={startActiveSpan:(e,t)=>r?(n||(n=r.trace.getTracer("drizzle-orm","0.44.7")),(0,s.t)((i,r)=>r.startActiveSpan(e,e=>{try{return t(e)}catch(t){throw e.setStatus({code:i.SpanStatusCode.ERROR,message:t instanceof Error?t.message:"Unknown error"}),t}finally{e.end()}}),r,n)):t()}},49237:(e,t,i)=>{i.d(t,{An:()=>m,M4:()=>c,M6:()=>d,SS:()=>f,ZS:()=>function e(t,i){return Object.entries(t).reduce((t,[a,l])=>{if("string"!=typeof a)return t;let c=i?[...i,a]:[a];return(0,n.is)(l,r.s)||(0,n.is)(l,s.$s)||(0,n.is)(l,s.$s.Aliased)?t.push({path:c,field:l}):(0,n.is)(l,o.iA)?t.push(...e(l[o.iA.Symbol.Columns],c)):t.push(...e(l,c)),t},[])},dP:()=>p,ef:()=>h,ux:()=>u,wM:()=>g,zN:()=>y});var r=i(83596),n=i(19326),s=i(62315),a=i(78586),o=i(80298),l=i(62413);function c(e,t,i){let a={},l=e.reduce((e,{path:l,field:c},u)=>{let d;d=(0,n.is)(c,r.s)?c:(0,n.is)(c,s.$s)?c.decoder:c.sql.decoder;let h=e;for(let[e,s]of l.entries())if(e<l.length-1)s in h||(h[s]={}),h=h[s];else{let e=t[u],f=h[s]=null===e?null:d.mapFromDriverValue(e);if(i&&(0,n.is)(c,r.s)&&2===l.length){let e=l[0];e in a?"string"==typeof a[e]&&a[e]!==(0,o.SP)(c.table)&&(a[e]=!1):a[e]=null===f&&(0,o.SP)(c.table)}}return e},{});if(i&&Object.keys(a).length>0)for(let[e,t]of Object.entries(a))"string"!=typeof t||i[t]||(l[e]=null);return l}function u(e,t){let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let[e,t]of i.entries())if(t!==r[e])return!1;return!0}function d(e,t){let i=Object.entries(t).filter(([,e])=>void 0!==e).map(([t,i])=>(0,n.is)(i,s.$s)||(0,n.is)(i,r.s)?[t,i]:[t,new s.dO(i,e[o.iA.Symbol.Columns][t])]);if(0===i.length)throw Error("No values to set");return Object.fromEntries(i)}function h(e,t){for(let i of t)for(let t of Object.getOwnPropertyNames(i.prototype))"constructor"!==t&&Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(i.prototype,t)||Object.create(null))}function f(e){return e[o.iA.Symbol.Columns]}function p(e){return(0,n.is)(e,a.k)?e._.alias:(0,n.is)(e,s.G7)?e[l.d].name:(0,n.is)(e,s.$s)?void 0:e[o.iA.Symbol.IsAlias]?e[o.iA.Symbol.Name]:e[o.iA.Symbol.BaseName]}function m(e,t){return{name:"string"==typeof e&&e.length>0?e:"",config:"object"==typeof e?e:t}}function g(e){if("object"!=typeof e||null===e||"Object"!==e.constructor.name)return!1;if("logger"in e){let t=typeof e.logger;return"boolean"===t||"object"===t&&"function"==typeof e.logger.logQuery||"undefined"===t}if("schema"in e){let t=typeof e.schema;return"object"===t||"undefined"===t}if("casing"in e){let t=typeof e.casing;return"string"===t||"undefined"===t}if("mode"in e)return"default"===e.mode&&"planetscale"===e.mode&&void 0===e.mode;if("connection"in e){let t=typeof e.connection;return"string"===t||"object"===t||"undefined"===t}if("client"in e){let t=typeof e.client;return"object"===t||"function"===t||"undefined"===t}return 0===Object.keys(e).length}let y="undefined"==typeof TextDecoder?null:new TextDecoder},62413:(e,t,i)=>{i.d(t,{d:()=>r});let r=Symbol.for("drizzle:ViewBaseConfig")},96572:(e,t,i)=>{i.d(t,{Jz:()=>l,bx:()=>o,cv:()=>c,g7:()=>r,xv:()=>n,zo:()=>s});let r=new TextEncoder,n=new TextDecoder;function s(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),i=0;for(let r of e)t.set(r,i),i+=r.length;return t}function a(e,t,i){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],i)}function o(e){let t=new Uint8Array(8);return a(t,Math.floor(e/4294967296),0),a(t,e%4294967296,4),t}function l(e){let t=new Uint8Array(4);return a(t,e),t}function c(e){let t=new Uint8Array(e.length);for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>127)throw TypeError("non-ASCII string encountered in encode()");t[i]=r}return t}},9744:(e,t,i)=>{i.d(t,{K:()=>n});let r=e=>"object"==typeof e&&null!==e;function n(e){if(!r(e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}},58091:(e,t,i)=>{i.d(t,{J:()=>n,c:()=>s});var r=i(96572);function n(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:r.xv.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=r.xv.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/");try{return function(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(e);let t=atob(e),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function s(e){let t=e;return("string"==typeof t&&(t=r.g7.encode(t)),Uint8Array.prototype.toBase64)?t.toBase64({alphabet:"base64url",omitPadding:!0}):(function(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let i=0;i<e.length;i+=32768)t.push(String.fromCharCode.apply(null,e.subarray(i,i+32768)));return btoa(t.join(""))})(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},20218:(e,t,i)=>{i.d(t,{FP:()=>a,NM:()=>l,YS:()=>n,Zw:()=>c,fy:()=>s,jq:()=>o,uv:()=>u,yc:()=>d});class r extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class n extends r{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,i="unspecified",r="unspecified"){super(e,{cause:{claim:i,reason:r,payload:t}}),this.claim=i,this.reason=r,this.payload=t}}class s extends r{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,i="unspecified",r="unspecified"){super(e,{cause:{claim:i,reason:r,payload:t}}),this.claim=i,this.reason=r,this.payload=t}}class a extends r{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class o extends r{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class l extends r{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(e="decryption operation failed",t){super(e,t)}}class c extends r{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class u extends r{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class d extends r{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class h extends r{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}},80499:(e,t,i)=>{let r,n,s,a,o;i.d(t,{ZP:()=>rN});var l=i(2104),c=i(62391);let u=!1;function d(e,t){try{return/^https?:/.test(new URL(e,e.startsWith("/")?t:void 0).protocol)}catch{return!1}}let h=!1,f=!1,p=!1,m=["createVerificationToken","useVerificationToken","getUserByEmail"],g=["createUser","getUser","getUserByEmail","getUserByAccount","updateUser","linkAccount","createSession","getSessionAndUser","updateSession","deleteSession"],y=["createUser","getUser","linkAccount","getAccount","getAuthenticator","createAuthenticator","listAuthenticatorsByUserId","updateAuthenticatorCounter"];var b=i(83854);async function w({options:e,paramValue:t,cookieValue:i}){let{url:r,callbacks:n}=e,s=r.origin;return t?s=await n.redirect({url:t,baseUrl:r.origin}):i&&(s=await n.redirect({url:i,baseUrl:r.origin})),{callbackUrl:s,callbackUrlCookie:s!==i?s:void 0}}var v=i(83213);let S="\x1b[31m",_="\x1b[0m",A={error(e){let t=e instanceof c.l4?e.type:e.name;if(console.error(`${S}[auth][error]${_} ${t}: ${e.message}`),e.cause&&"object"==typeof e.cause&&"err"in e.cause&&e.cause.err instanceof Error){let{err:t,...i}=e.cause;console.error(`${S}[auth][cause]${_}:`,t.stack),i&&console.error(`${S}[auth][details]${_}:`,JSON.stringify(i,null,2))}else e.stack&&console.error(e.stack.replace(/.*/,"").substring(1))},warn(e){console.warn(`\x1b[33m[auth][warn][${e}]${_}`,"Read more: https://warnings.authjs.dev")},debug(e,t){console.log(`\x1b[90m[auth][debug]:${_} ${e}`,JSON.stringify(t,null,2))}};function x(e){let t={...A};return e.debug||(t.debug=()=>{}),e.logger?.error&&(t.error=e.logger.error),e.logger?.warn&&(t.warn=e.logger.warn),e.logger?.debug&&(t.debug=e.logger.debug),e.logger??(e.logger=t),t}let T=["providers","session","csrf","signin","signout","callback","verify-request","error","webauthn-options"],{parse:k,serialize:$}=v;async function E(e){if(!("body"in e)||!e.body||"POST"!==e.method)return;let t=e.headers.get("content-type");return t?.includes("application/json")?await e.json():t?.includes("application/x-www-form-urlencoded")?Object.fromEntries(new URLSearchParams(await e.text())):void 0}async function C(e,t){try{if("GET"!==e.method&&"POST"!==e.method)throw new c.D7("Only GET and POST requests are supported");t.basePath??(t.basePath="/auth");let i=new URL(e.url),{action:r,providerId:n}=function(e,t){let i=e.match(RegExp(`^${t}(.+)`));if(null===i)throw new c.D7(`Cannot parse action at ${e}`);let r=i.at(-1).replace(/^\//,"").split("/").filter(Boolean);if(1!==r.length&&2!==r.length)throw new c.D7(`Cannot parse action at ${e}`);let[n,s]=r;if(!T.includes(n)||s&&!["signin","callback","webauthn-options"].includes(n))throw new c.D7(`Cannot parse action at ${e}`);return{action:n,providerId:"undefined"==s?void 0:s}}(i.pathname,t.basePath);return{url:i,action:r,providerId:n,method:e.method,headers:Object.fromEntries(e.headers),body:e.body?await E(e):void 0,cookies:k(e.headers.get("cookie")??"")??{},error:i.searchParams.get("error")??void 0,query:Object.fromEntries(i.searchParams)}}catch(r){let i=x(t);i.error(r),i.debug("request",e)}}function P(e){let t=new Headers(e.headers);e.cookies?.forEach(e=>{let{name:i,value:r,options:n}=e,s=$(i,r,n);t.has("Set-Cookie")?t.append("Set-Cookie",s):t.set("Set-Cookie",s)});let i=e.body;"application/json"===t.get("content-type")?i=JSON.stringify(e.body):"application/x-www-form-urlencoded"===t.get("content-type")&&(i=new URLSearchParams(e.body).toString());let r=new Response(i,{headers:t,status:e.redirect?302:e.status??200});return e.redirect&&r.headers.set("Location",e.redirect),r}async function Q(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("").toString()}function N(e){let t=e=>("0"+e.toString(16)).slice(-2);return Array.from(crypto.getRandomValues(new Uint8Array(e))).reduce((e,i)=>e+t(i),"")}async function O({options:e,cookieValue:t,isPost:i,bodyValue:r}){if(t){let[n,s]=t.split("|");if(s===await Q(`${n}${e.secret}`))return{csrfTokenVerified:i&&n===r,csrfToken:n}}let n=N(32),s=await Q(`${n}${e.secret}`);return{cookie:`${n}|${s}`,csrfToken:n}}function q(e,t){if(!t)throw new c.Rk(`CSRF token was missing during an action ${e}`)}function I(e){return null!==e&&"object"==typeof e}function j(e,...t){if(!t.length)return e;let i=t.shift();if(I(e)&&I(i))for(let t in i)I(i[t])?(I(e[t])||(e[t]=Array.isArray(i[t])?[]:{}),j(e[t],i[t])):void 0!==i[t]&&(e[t]=i[t]);return j(e,...t)}let L=Symbol("skip-csrf-check"),U=Symbol("return-type-raw"),D=Symbol("custom-fetch"),B=Symbol("conform-internal"),R=e=>K({id:e.sub??e.id??crypto.randomUUID(),name:e.name??e.nickname??e.preferred_username,email:e.email,image:e.picture}),M=e=>K({access_token:e.access_token,id_token:e.id_token,refresh_token:e.refresh_token,expires_at:e.expires_at,scope:e.scope,token_type:e.token_type,session_state:e.session_state});function K(e){let t={};for(let[i,r]of Object.entries(e))void 0!==r&&(t[i]=r);return t}function F(e,t){if(!e&&t)return;if("string"==typeof e)return{url:new URL(e)};let i=new URL(e?.url??"https://authjs.dev");if(e?.params!=null)for(let[t,r]of Object.entries(e.params))"claims"===t&&(r=JSON.stringify(r)),i.searchParams.set(t,String(r));return{url:i,request:e?.request,conform:e?.conform,...e?.clientPrivateKey?{clientPrivateKey:e?.clientPrivateKey}:null}}let J={signIn:()=>!0,redirect:({url:e,baseUrl:t})=>e.startsWith("/")?`${t}${e}`:new URL(e).origin===t?e:t,session:({session:e})=>({user:{name:e.user?.name,email:e.user?.email,image:e.user?.image},expires:e.expires?.toISOString?.()??e.expires}),jwt:({token:e})=>e};async function H({authOptions:e,providerId:t,action:i,url:r,cookies:n,callbackUrl:s,csrfToken:a,csrfDisabled:o,isPost:u}){var d;let h=x(e),{providers:f,provider:p}=function(e){let{providerId:t,config:i}=e,r=new URL(i.basePath??"/auth",e.url.origin),n=i.providers.map(e=>{let t="function"==typeof e?e():e,{options:n,...s}=t,a=n?.id??s.id,o=j(s,n,{signinUrl:`${r}/signin/${a}`,callbackUrl:`${r}/callback/${a}`});if("oauth"===t.type||"oidc"===t.type){o.redirectProxyUrl??(o.redirectProxyUrl=n?.redirectProxyUrl??i.redirectProxyUrl);let e=function(e){e.issuer&&(e.wellKnown??(e.wellKnown=`${e.issuer}/.well-known/openid-configuration`));let t=F(e.authorization,e.issuer);t&&!t.url?.searchParams.has("scope")&&t.url.searchParams.set("scope","openid profile email");let i=F(e.token,e.issuer),r=F(e.userinfo,e.issuer),n=e.checks??["pkce"];return e.redirectProxyUrl&&(n.includes("state")||n.push("state"),e.redirectProxyUrl=`${e.redirectProxyUrl}/callback/${e.id}`),{...e,authorization:t,token:i,checks:n,userinfo:r,profile:e.profile??R,account:e.account??M}}(o);return e.authorization?.url.searchParams.get("response_mode")==="form_post"&&delete e.redirectProxyUrl,e[D]??(e[D]=n?.[D]),e}return o}),s=n.find(({id:e})=>e===t);if(t&&!s){let e=n.map(e=>e.id).join(", ");throw Error(`Provider with id "${t}" not found. Available providers: [${e}].`)}return{providers:n,provider:s}}({url:r,providerId:t,config:e}),m=!1;if((p?.type==="oauth"||p?.type==="oidc")&&p.redirectProxyUrl)try{m=new URL(p.redirectProxyUrl).origin===r.origin}catch{throw TypeError(`redirectProxyUrl must be a valid URL. Received: ${p.redirectProxyUrl}`)}let g={debug:!1,pages:{},theme:{colorScheme:"auto",logo:"",brandColor:"",buttonText:""},...e,url:r,action:i,provider:p,cookies:j(l.x(e.useSecureCookies??"https:"===r.protocol),e.cookies),providers:f,session:{strategy:e.adapter?"database":"jwt",maxAge:2592e3,updateAge:86400,generateSessionToken:()=>crypto.randomUUID(),...e.session},jwt:{secret:e.secret,maxAge:e.session?.maxAge??2592e3,encode:b.cv,decode:b.Jx,...e.jwt},events:Object.keys(d=e.events??{}).reduce((e,t)=>(e[t]=async(...e)=>{try{let i=d[t];return await i(...e)}catch(e){h.error(new c.xQ(e))}},e),{}),adapter:function(e,t){if(e)return Object.keys(e).reduce((i,r)=>(i[r]=async(...i)=>{try{t.debug(`adapter_${r}`,{args:i});let n=e[r];return await n(...i)}catch(i){let e=new c.dq(i);throw t.error(e),e}},i),{})}(e.adapter,h),callbacks:{...J,...e.callbacks},logger:h,callbackUrl:r.origin,isOnRedirectProxy:m,experimental:{...e.experimental}},y=[];if(o)g.csrfTokenVerified=!0;else{let{csrfToken:e,cookie:t,csrfTokenVerified:i}=await O({options:g,cookieValue:n?.[g.cookies.csrfToken.name],isPost:u,bodyValue:a});g.csrfToken=e,g.csrfTokenVerified=i,t&&y.push({name:g.cookies.csrfToken.name,value:t,options:g.cookies.csrfToken.options})}let{callbackUrl:v,callbackUrlCookie:S}=await w({options:g,cookieValue:n?.[g.cookies.callbackUrl.name],paramValue:s});return g.callbackUrl=v,S&&y.push({name:g.cookies.callbackUrl.name,value:S,options:g.cookies.callbackUrl.options}),{options:g,cookies:y}}var z,W,V,Z,G,Y,X,ee,et,ei,er={},en=[],es=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ea=Array.isArray;function eo(e,t){for(var i in t)e[i]=t[i];return e}function el(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ec(e,t,i){var r,n,s,a={};for(s in t)"key"==s?r=t[s]:"ref"==s?n=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?z.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return eu(e,a,r,n,null)}function eu(e,t,i,r,n){var s={type:e,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==n?++V:n,__i:-1,__u:0};return null==n&&null!=W.vnode&&W.vnode(s),s}function ed(e){return e.children}function eh(e,t){this.props=e,this.context=t}function ef(e,t){if(null==t)return e.__?ef(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?ef(e):null}function ep(e){(!e.__d&&(e.__d=!0)&&Z.push(e)&&!em.__r++||G!==W.debounceRendering)&&((G=W.debounceRendering)||Y)(em)}function em(){var e,t,i,r,n,s,a,o;for(Z.sort(X);e=Z.shift();)e.__d&&(t=Z.length,r=void 0,s=(n=(i=e).__v).__e,a=[],o=[],i.__P&&((r=eo({},n)).__v=n.__v+1,W.vnode&&W.vnode(r),ev(i.__P,r,n,i.__n,i.__P.namespaceURI,32&n.__u?[s]:null,a,null==s?ef(n):s,!!(32&n.__u),o),r.__v=n.__v,r.__.__k[r.__i]=r,eS(a,r,o),r.__e!=s&&function e(t){var i,r;if(null!=(t=t.__)&&null!=t.__c){for(t.__e=t.__c.base=null,i=0;i<t.__k.length;i++)if(null!=(r=t.__k[i])&&null!=r.__e){t.__e=t.__c.base=r.__e;break}return e(t)}}(r)),Z.length>t&&Z.sort(X));em.__r=0}function eg(e,t,i,r,n,s,a,o,l,c,u){var d,h,f,p,m,g=r&&r.__k||en,y=t.length;for(i.__d=l,function(e,t,i){var r,n,s,a,o,l=t.length,c=i.length,u=c,d=0;for(e.__k=[],r=0;r<l;r++)null!=(n=t[r])&&"boolean"!=typeof n&&"function"!=typeof n?(a=r+d,(n=e.__k[r]="string"==typeof n||"number"==typeof n||"bigint"==typeof n||n.constructor==String?eu(null,n,null,null,null):ea(n)?eu(ed,{children:n},null,null,null):void 0===n.constructor&&n.__b>0?eu(n.type,n.props,n.key,n.ref?n.ref:null,n.__v):n).__=e,n.__b=e.__b+1,s=null,-1!==(o=n.__i=function(e,t,i,r){var n=e.key,s=e.type,a=i-1,o=i+1,l=t[i];if(null===l||l&&n==l.key&&s===l.type&&0==(131072&l.__u))return i;if(r>(null!=l&&0==(131072&l.__u)?1:0))for(;a>=0||o<t.length;){if(a>=0){if((l=t[a])&&0==(131072&l.__u)&&n==l.key&&s===l.type)return a;a--}if(o<t.length){if((l=t[o])&&0==(131072&l.__u)&&n==l.key&&s===l.type)return o;o++}}return -1}(n,i,a,u))&&(u--,(s=i[o])&&(s.__u|=131072)),null==s||null===s.__v?(-1==o&&d--,"function"!=typeof n.type&&(n.__u|=65536)):o!==a&&(o==a-1?d--:o==a+1?d++:(o>a?d--:d++,n.__u|=65536))):n=e.__k[r]=null;if(u)for(r=0;r<c;r++)null!=(s=i[r])&&0==(131072&s.__u)&&(s.__e==e.__d&&(e.__d=ef(s)),function e(t,i,r){var n,s;if(W.unmount&&W.unmount(t),(n=t.ref)&&(n.current&&n.current!==t.__e||e_(n,null,i)),null!=(n=t.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){W.__e(e,i)}n.base=n.__P=null}if(n=t.__k)for(s=0;s<n.length;s++)n[s]&&e(n[s],i,r||"function"!=typeof t.type);r||el(t.__e),t.__c=t.__=t.__e=t.__d=void 0}(s,s))}(i,t,g),l=i.__d,d=0;d<y;d++)null!=(f=i.__k[d])&&(h=-1===f.__i?er:g[f.__i]||er,f.__i=d,ev(e,f,h,n,s,a,o,l,c,u),p=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&e_(h.ref,null,f),u.push(f.ref,f.__c||p,f)),null==m&&null!=p&&(m=p),65536&f.__u||h.__k===f.__k?l=function e(t,i,r){var n,s;if("function"==typeof t.type){for(n=t.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=t,i=e(n[s],i,r));return i}t.__e!=i&&(i&&t.type&&!r.contains(i)&&(i=ef(t)),r.insertBefore(t.__e,i||null),i=t.__e);do i=i&&i.nextSibling;while(null!=i&&8===i.nodeType);return i}(f,l,e):"function"==typeof f.type&&void 0!==f.__d?l=f.__d:p&&(l=p.nextSibling),f.__d=void 0,f.__u&=-196609);i.__d=l,i.__e=m}function ey(e,t,i){"-"===t[0]?e.setProperty(t,null==i?"":i):e[t]=null==i?"":"number"!=typeof i||es.test(t)?i:i+"px"}function eb(e,t,i,r,n){var s;e:if("style"===t){if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)i&&t in i||ey(e.style,t,"");if(i)for(t in i)r&&i[t]===r[t]||ey(e.style,t,i[t])}}else if("o"===t[0]&&"n"===t[1])s=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase() in e||"onFocusOut"===t||"onFocusIn"===t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+s]=i,i?r?i.u=r.u:(i.u=ee,e.addEventListener(t,s?ei:et,s)):e.removeEventListener(t,s?ei:et,s);else{if("http://www.w3.org/2000/svg"==n)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null==i||!1===i&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==i?"":i))}}function ew(e){return function(t){if(this.l){var i=this.l[t.type+e];if(null==t.t)t.t=ee++;else if(t.t<i.u)return;return i(W.event?W.event(t):t)}}}function ev(e,t,i,r,n,s,a,o,l,c){var u,d,h,f,p,m,g,y,b,w,v,S,_,A,x,T,k=t.type;if(void 0!==t.constructor)return null;128&i.__u&&(l=!!(32&i.__u),s=[o=t.__e=i.__e]),(u=W.__b)&&u(t);e:if("function"==typeof k)try{if(y=t.props,b="prototype"in k&&k.prototype.render,w=(u=k.contextType)&&r[u.__c],v=u?w?w.props.value:u.__:r,i.__c?g=(d=t.__c=i.__c).__=d.__E:(b?t.__c=d=new k(y,v):(t.__c=d=new eh(y,v),d.constructor=k,d.render=eA),w&&w.sub(d),d.props=y,d.state||(d.state={}),d.context=v,d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),b&&null==d.__s&&(d.__s=d.state),b&&null!=k.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=eo({},d.__s)),eo(d.__s,k.getDerivedStateFromProps(y,d.__s))),f=d.props,p=d.state,d.__v=t,h)b&&null==k.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),b&&null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(b&&null==k.getDerivedStateFromProps&&y!==f&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(y,v),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(y,d.__s,v)||t.__v===i.__v)){for(t.__v!==i.__v&&(d.props=y,d.state=d.__s,d.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some(function(e){e&&(e.__=t)}),S=0;S<d._sb.length;S++)d.__h.push(d._sb[S]);d._sb=[],d.__h.length&&a.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(y,d.__s,v),b&&null!=d.componentDidUpdate&&d.__h.push(function(){d.componentDidUpdate(f,p,m)})}if(d.context=v,d.props=y,d.__P=e,d.__e=!1,_=W.__r,A=0,b){for(d.state=d.__s,d.__d=!1,_&&_(t),u=d.render(d.props,d.state,d.context),x=0;x<d._sb.length;x++)d.__h.push(d._sb[x]);d._sb=[]}else do d.__d=!1,_&&_(t),u=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++A<25);d.state=d.__s,null!=d.getChildContext&&(r=eo(eo({},r),d.getChildContext())),b&&!h&&null!=d.getSnapshotBeforeUpdate&&(m=d.getSnapshotBeforeUpdate(f,p)),eg(e,ea(T=null!=u&&u.type===ed&&null==u.key?u.props.children:u)?T:[T],t,i,r,n,s,a,o,l,c),d.base=t.__e,t.__u&=-161,d.__h.length&&a.push(d),g&&(d.__E=d.__=null)}catch(e){if(t.__v=null,l||null!=s){for(t.__u|=l?160:128;o&&8===o.nodeType&&o.nextSibling;)o=o.nextSibling;s[s.indexOf(o)]=null,t.__e=o}else t.__e=i.__e,t.__k=i.__k;W.__e(e,t,i)}else null==s&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=function(e,t,i,r,n,s,a,o,l){var c,u,d,h,f,p,m,g=i.props,y=t.props,b=t.type;if("svg"===b?n="http://www.w3.org/2000/svg":"math"===b?n="http://www.w3.org/1998/Math/MathML":n||(n="http://www.w3.org/1999/xhtml"),null!=s){for(c=0;c<s.length;c++)if((f=s[c])&&"setAttribute"in f==!!b&&(b?f.localName===b:3===f.nodeType)){e=f,s[c]=null;break}}if(null==e){if(null===b)return document.createTextNode(y);e=document.createElementNS(n,b,y.is&&y),o&&(W.__m&&W.__m(t,s),o=!1),s=null}if(null===b)g===y||o&&e.data===y||(e.data=y);else{if(s=s&&z.call(e.childNodes),g=i.props||er,!o&&null!=s)for(g={},c=0;c<e.attributes.length;c++)g[(f=e.attributes[c]).name]=f.value;for(c in g)if(f=g[c],"children"==c);else if("dangerouslySetInnerHTML"==c)d=f;else if(!(c in y)){if("value"==c&&"defaultValue"in y||"checked"==c&&"defaultChecked"in y)continue;eb(e,c,null,f,n)}for(c in y)f=y[c],"children"==c?h=f:"dangerouslySetInnerHTML"==c?u=f:"value"==c?p=f:"checked"==c?m=f:o&&"function"!=typeof f||g[c]===f||eb(e,c,f,g[c],n);if(u)o||d&&(u.__html===d.__html||u.__html===e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(d&&(e.innerHTML=""),eg(e,ea(h)?h:[h],t,i,r,"foreignObject"===b?"http://www.w3.org/1999/xhtml":n,s,a,s?s[0]:i.__k&&ef(i,0),o,l),null!=s)for(c=s.length;c--;)el(s[c]);o||(c="value","progress"===b&&null==p?e.removeAttribute("value"):void 0===p||p===e[c]&&("progress"!==b||p)&&("option"!==b||p===g[c])||eb(e,c,p,g[c],n),c="checked",void 0!==m&&m!==e[c]&&eb(e,c,m,g[c],n))}return e}(i.__e,t,i,r,n,s,a,l,c);(u=W.diffed)&&u(t)}function eS(e,t,i){t.__d=void 0;for(var r=0;r<i.length;r++)e_(i[r],i[++r],i[++r]);W.__c&&W.__c(t,e),e.some(function(t){try{e=t.__h,t.__h=[],e.some(function(e){e.call(t)})}catch(e){W.__e(e,t.__v)}})}function e_(e,t,i){try{if("function"==typeof e){var r="function"==typeof e.__u;r&&e.__u(),r&&null==t||(e.__u=e(t))}else e.current=t}catch(e){W.__e(e,i)}}function eA(e,t,i){return this.constructor(e,i)}function ex(e,t){var i,r,n,s,a;i=e,W.__&&W.__(i,t),n=(r="function"==typeof ex)?null:ex&&ex.__k||t.__k,s=[],a=[],ev(t,i=(!r&&ex||t).__k=ec(ed,null,[i]),n||er,er,t.namespaceURI,!r&&ex?[ex]:n?null:t.firstChild?z.call(t.childNodes):null,s,!r&&ex?ex:n?n.__e:t.firstChild,r,a),eS(s,i,a)}z=en.slice,W={__e:function(e,t,i,r){for(var n,s,a;t=t.__;)if((n=t.__c)&&!n.__)try{if((s=n.constructor)&&null!=s.getDerivedStateFromError&&(n.setState(s.getDerivedStateFromError(e)),a=n.__d),null!=n.componentDidCatch&&(n.componentDidCatch(e,r||{}),a=n.__d),a)return n.__E=n}catch(t){e=t}throw e}},V=0,eh.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=eo({},this.state),"function"==typeof e&&(e=e(eo({},i),this.props)),e&&eo(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),ep(this))},eh.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),ep(this))},eh.prototype.render=ed,Z=[],Y="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,X=function(e,t){return e.__v.__b-t.__v.__b},em.__r=0,ee=0,et=ew(!1),ei=ew(!0);var eT=/[\s\n\\/='"\0<>]/,ek=/^(xlink|xmlns|xml)([A-Z])/,e$=/^accessK|^auto[A-Z]|^cell|^ch|^col|cont|cross|dateT|encT|form[A-Z]|frame|hrefL|inputM|maxL|minL|noV|playsI|popoverT|readO|rowS|src[A-Z]|tabI|useM|item[A-Z]/,eE=/^ac|^ali|arabic|basel|cap|clipPath$|clipRule$|color|dominant|enable|fill|flood|font|glyph[^R]|horiz|image|letter|lighting|marker[^WUH]|overline|panose|pointe|paint|rendering|shape|stop|strikethrough|stroke|text[^L]|transform|underline|unicode|units|^v[^i]|^w|^xH/,eC=new Set(["draggable","spellcheck"]),eP=/["&<]/;function eQ(e){if(0===e.length||!1===eP.test(e))return e;for(var t=0,i=0,r="",n="";i<e.length;i++){switch(e.charCodeAt(i)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;default:continue}i!==t&&(r+=e.slice(t,i)),r+=n,t=i+1}return i!==t&&(r+=e.slice(t,i)),r}var eN={},eO=new Set(["animation-iteration-count","border-image-outset","border-image-slice","border-image-width","box-flex","box-flex-group","box-ordinal-group","column-count","fill-opacity","flex","flex-grow","flex-negative","flex-order","flex-positive","flex-shrink","flood-opacity","font-weight","grid-column","grid-row","line-clamp","line-height","opacity","order","orphans","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-miterlimit","stroke-opacity","stroke-width","tab-size","widows","z-index","zoom"]),eq=/[A-Z]/g;function eI(){this.__d=!0}var ej,eL,eU,eD,eB={},eR=[],eM=Array.isArray,eK=Object.assign;function eF(e,t){var i,r=e.type,n=!0;return e.__c?(n=!1,(i=e.__c).state=i.__s):i=new r(e.props,t),e.__c=i,i.__v=e,i.props=e.props,i.context=t,i.__d=!0,null==i.state&&(i.state=eB),null==i.__s&&(i.__s=i.state),r.getDerivedStateFromProps?i.state=eK({},i.state,r.getDerivedStateFromProps(i.props,i.state)):n&&i.componentWillMount?(i.componentWillMount(),i.state=i.__s!==i.state?i.__s:i.state):!n&&i.componentWillUpdate&&i.componentWillUpdate(),eU&&eU(e),i.render(i.props,i.state,t)}var eJ=new Set(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),eH=0;function ez(e,t,i,r,n,s){t||(t={});var a,o,l=t;"ref"in t&&(a=t.ref,delete t.ref);var c={type:e,props:l,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--eH,__i:-1,__u:0,__source:n,__self:s};if("function"==typeof e&&(a=e.defaultProps))for(o in a)void 0===l[o]&&(l[o]=a[o]);return W.vnode&&W.vnode(c),c}async function eW(e,t){let i=window.SimpleWebAuthnBrowser;async function r(i){let r=new URL(`${e}/webauthn-options/${t}`);i&&r.searchParams.append("action",i),s().forEach(e=>{r.searchParams.append(e.name,e.value)});let n=await fetch(r);if(!n.ok){console.error("Failed to fetch options",n);return}return n.json()}function n(){let e=`#${t}-form`,i=document.querySelector(e);if(!i)throw Error(`Form '${e}' not found`);return i}function s(){return Array.from(n().querySelectorAll("input[data-form-field]"))}async function a(e,t){let i=n();if(e){let t=document.createElement("input");t.type="hidden",t.name="action",t.value=e,i.appendChild(t)}if(t){let e=document.createElement("input");e.type="hidden",e.name="data",e.value=JSON.stringify(t),i.appendChild(e)}return i.submit()}async function o(e,t){let r=await i.startAuthentication(e,t);return await a("authenticate",r)}async function l(e){s().forEach(e=>{if(e.required&&!e.value)throw Error(`Missing required field: ${e.name}`)});let t=await i.startRegistration(e);return await a("register",t)}async function c(){if(!i.browserSupportsWebAuthnAutofill())return;let e=await r("authenticate");if(!e){console.error("Failed to fetch option for autofill authentication");return}try{await o(e.options,!0)}catch(e){console.error(e)}}(async function(){let e=n();if(!i.browserSupportsWebAuthn()){e.style.display="none";return}e&&e.addEventListener("submit",async e=>{e.preventDefault();let t=await r(void 0);if(!t){console.error("Failed to fetch options for form submission");return}if("authenticate"===t.action)try{await o(t.options,!1)}catch(e){console.error(e)}else if("register"===t.action)try{await l(t.options)}catch(e){console.error(e)}})})(),c()}let eV={default:"Unable to sign in.",Signin:"Try signing in with a different account.",OAuthSignin:"Try signing in with a different account.",OAuthCallbackError:"Try signing in with a different account.",OAuthCreateAccount:"Try signing in with a different account.",EmailCreateAccount:"Try signing in with a different account.",Callback:"Try signing in with a different account.",OAuthAccountNotLinked:"To confirm your identity, sign in with the same account you used originally.",EmailSignin:"The e-mail could not be sent.",CredentialsSignin:"Sign in failed. Check the details you provided are correct.",SessionRequired:"Please sign in to access this page."},eZ=`:root {
  --border-width: 1px;
  --border-radius: 0.5rem;
  --color-error: #c94b4b;
  --color-info: #157efb;
  --color-info-hover: #0f6ddb;
  --color-info-text: #fff;
}

.__next-auth-theme-auto,
.__next-auth-theme-light {
  --color-background: #ececec;
  --color-background-hover: rgba(236, 236, 236, 0.8);
  --color-background-card: #fff;
  --color-text: #000;
  --color-primary: #444;
  --color-control-border: #bbb;
  --color-button-active-background: #f9f9f9;
  --color-button-active-border: #aaa;
  --color-separator: #ccc;
  --provider-bg: #fff;
  --provider-bg-hover: color-mix(
    in srgb,
    var(--provider-brand-color) 30%,
    #fff
  );
}

.__next-auth-theme-dark {
  --color-background: #161b22;
  --color-background-hover: rgba(22, 27, 34, 0.8);
  --color-background-card: #0d1117;
  --color-text: #fff;
  --color-primary: #ccc;
  --color-control-border: #555;
  --color-button-active-background: #060606;
  --color-button-active-border: #666;
  --color-separator: #444;
  --provider-bg: #161b22;
  --provider-bg-hover: color-mix(
    in srgb,
    var(--provider-brand-color) 30%,
    #000
  );
}

.__next-auth-theme-dark img[src$="42-school.svg"],
  .__next-auth-theme-dark img[src$="apple.svg"],
  .__next-auth-theme-dark img[src$="boxyhq-saml.svg"],
  .__next-auth-theme-dark img[src$="eveonline.svg"],
  .__next-auth-theme-dark img[src$="github.svg"],
  .__next-auth-theme-dark img[src$="mailchimp.svg"],
  .__next-auth-theme-dark img[src$="medium.svg"],
  .__next-auth-theme-dark img[src$="okta.svg"],
  .__next-auth-theme-dark img[src$="patreon.svg"],
  .__next-auth-theme-dark img[src$="ping-id.svg"],
  .__next-auth-theme-dark img[src$="roblox.svg"],
  .__next-auth-theme-dark img[src$="threads.svg"],
  .__next-auth-theme-dark img[src$="wikimedia.svg"] {
    filter: invert(1);
  }

.__next-auth-theme-dark #submitButton {
    background-color: var(--provider-bg, var(--color-info));
  }

@media (prefers-color-scheme: dark) {
  .__next-auth-theme-auto {
    --color-background: #161b22;
    --color-background-hover: rgba(22, 27, 34, 0.8);
    --color-background-card: #0d1117;
    --color-text: #fff;
    --color-primary: #ccc;
    --color-control-border: #555;
    --color-button-active-background: #060606;
    --color-button-active-border: #666;
    --color-separator: #444;
    --provider-bg: #161b22;
    --provider-bg-hover: color-mix(
      in srgb,
      var(--provider-brand-color) 30%,
      #000
    );
  }
    .__next-auth-theme-auto img[src$="42-school.svg"],
    .__next-auth-theme-auto img[src$="apple.svg"],
    .__next-auth-theme-auto img[src$="boxyhq-saml.svg"],
    .__next-auth-theme-auto img[src$="eveonline.svg"],
    .__next-auth-theme-auto img[src$="github.svg"],
    .__next-auth-theme-auto img[src$="mailchimp.svg"],
    .__next-auth-theme-auto img[src$="medium.svg"],
    .__next-auth-theme-auto img[src$="okta.svg"],
    .__next-auth-theme-auto img[src$="patreon.svg"],
    .__next-auth-theme-auto img[src$="ping-id.svg"],
    .__next-auth-theme-auto img[src$="roblox.svg"],
    .__next-auth-theme-auto img[src$="threads.svg"],
    .__next-auth-theme-auto img[src$="wikimedia.svg"] {
      filter: invert(1);
    }
    .__next-auth-theme-auto #submitButton {
      background-color: var(--provider-bg, var(--color-info));
    }
}

html {
  box-sizing: border-box;
}

*,
*:before,
*:after {
  box-sizing: inherit;
  margin: 0;
  padding: 0;
}

body {
  background-color: var(--color-background);
  margin: 0;
  padding: 0;
  font-family:
    ui-sans-serif,
    system-ui,
    -apple-system,
    BlinkMacSystemFont,
    "Segoe UI",
    Roboto,
    "Helvetica Neue",
    Arial,
    "Noto Sans",
    sans-serif,
    "Apple Color Emoji",
    "Segoe UI Emoji",
    "Segoe UI Symbol",
    "Noto Color Emoji";
}

h1 {
  margin-bottom: 1.5rem;
  padding: 0 1rem;
  font-weight: 400;
  color: var(--color-text);
}

p {
  margin-bottom: 1.5rem;
  padding: 0 1rem;
  color: var(--color-text);
}

form {
  margin: 0;
  padding: 0;
}

label {
  font-weight: 500;
  text-align: left;
  margin-bottom: 0.25rem;
  display: block;
  color: var(--color-text);
}

input[type] {
  box-sizing: border-box;
  display: block;
  width: 100%;
  padding: 0.5rem 1rem;
  border: var(--border-width) solid var(--color-control-border);
  background: var(--color-background-card);
  font-size: 1rem;
  border-radius: var(--border-radius);
  color: var(--color-text);
}

p {
  font-size: 1.1rem;
  line-height: 2rem;
}

a.button {
  text-decoration: none;
  line-height: 1rem;
}

a.button:link,
  a.button:visited {
    background-color: var(--color-background);
    color: var(--color-primary);
  }

button,
a.button {
  padding: 0.75rem 1rem;
  color: var(--provider-color, var(--color-primary));
  background-color: var(--provider-bg, var(--color-background));
  border: 1px solid #00000031;
  font-size: 0.9rem;
  height: 50px;
  border-radius: var(--border-radius);
  transition: background-color 250ms ease-in-out;
  font-weight: 300;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

:is(button,a.button):hover {
    background-color: var(--provider-bg-hover, var(--color-background-hover));
    cursor: pointer;
  }

:is(button,a.button):active {
    cursor: pointer;
  }

:is(button,a.button) span {
    color: var(--provider-bg);
  }

#submitButton {
  color: var(--button-text-color, var(--color-info-text));
  background-color: var(--brand-color, var(--color-info));
  width: 100%;
}

#submitButton:hover {
    background-color: var(
      --button-hover-bg,
      var(--color-info-hover)
    ) !important;
  }

a.site {
  color: var(--color-primary);
  text-decoration: none;
  font-size: 1rem;
  line-height: 2rem;
}

a.site:hover {
    text-decoration: underline;
  }

.page {
  position: absolute;
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.page > div {
    text-align: center;
  }

.error a.button {
    padding-left: 2rem;
    padding-right: 2rem;
    margin-top: 0.5rem;
  }

.error .message {
    margin-bottom: 1.5rem;
  }

.signin input[type="text"] {
    margin-left: auto;
    margin-right: auto;
    display: block;
  }

.signin hr {
    display: block;
    border: 0;
    border-top: 1px solid var(--color-separator);
    margin: 2rem auto 1rem auto;
    overflow: visible;
  }

.signin hr::before {
      content: "or";
      background: var(--color-background-card);
      color: #888;
      padding: 0 0.4rem;
      position: relative;
      top: -0.7rem;
    }

.signin .error {
    background: #f5f5f5;
    font-weight: 500;
    border-radius: 0.3rem;
    background: var(--color-error);
  }

.signin .error p {
      text-align: left;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      line-height: 1.2rem;
      color: var(--color-info-text);
    }

.signin > div,
  .signin form {
    display: block;
  }

.signin > div input[type], .signin form input[type] {
      margin-bottom: 0.5rem;
    }

.signin > div button, .signin form button {
      width: 100%;
    }

.signin .provider + .provider {
    margin-top: 1rem;
  }

.logo {
  display: inline-block;
  max-width: 150px;
  margin: 1.25rem 0;
  max-height: 70px;
}

.card {
  background-color: var(--color-background-card);
  border-radius: 1rem;
  padding: 1.25rem 2rem;
}

.card .header {
    color: var(--color-primary);
  }

.card input[type]::-moz-placeholder {
    color: color-mix(
      in srgb,
      var(--color-text) 20%,
      var(--color-button-active-background)
    );
  }

.card input[type]::placeholder {
    color: color-mix(
      in srgb,
      var(--color-text) 20%,
      var(--color-button-active-background)
    );
  }

.card input[type] {
    background: color-mix(in srgb, var(--color-background-card) 95%, black);
  }

.section-header {
  color: var(--color-text);
}

@media screen and (min-width: 450px) {
  .card {
    margin: 2rem 0;
    width: 368px;
  }
}

@media screen and (max-width: 450px) {
  .card {
    margin: 1rem 0;
    width: 343px;
  }
}
`;function eG({html:e,title:t,status:i,cookies:r,theme:n,headTags:s}){return{cookies:r,status:i,headers:{"Content-Type":"text/html"},body:`<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>${eZ}</style><title>${t}</title>${s??""}</head><body class="__next-auth-theme-${n?.colorScheme??"auto"}"><div class="page">${function(e,t,i){var r=W.__s;W.__s=!0,ej=W.__b,eL=W.diffed,eU=W.__r,eD=W.unmount;var n=ec(ed,null);n.__k=[e];try{var s=function e(t,i,r,n,s,a,o){if(null==t||!0===t||!1===t||""===t)return"";var l=typeof t;if("object"!=l)return"function"==l?"":"string"==l?eQ(t):t+"";if(eM(t)){var c,u="";s.__k=t;for(var d=0;d<t.length;d++){var h=t[d];if(null!=h&&"boolean"!=typeof h){var f,p=e(h,i,r,n,s,a,o);"string"==typeof p?u+=p:(c||(c=[]),u&&c.push(u),u="",eM(p)?(f=c).push.apply(f,p):c.push(p))}}return c?(u&&c.push(u),c):u}if(void 0!==t.constructor)return"";t.__=s,ej&&ej(t);var m=t.type,g=t.props;if("function"==typeof m){var y,b,w,v=i;if(m===ed){if("tpl"in g){for(var S="",_=0;_<g.tpl.length;_++)if(S+=g.tpl[_],g.exprs&&_<g.exprs.length){var A=g.exprs[_];if(null==A)continue;"object"==typeof A&&(void 0===A.constructor||eM(A))?S+=e(A,i,r,n,t,a,o):S+=A}return S}if("UNSTABLE_comment"in g)return"<!--"+eQ(g.UNSTABLE_comment)+"-->";b=g.children}else{if(null!=(y=m.contextType)){var x=i[y.__c];v=x?x.props.value:y.__}var T=m.prototype&&"function"==typeof m.prototype.render;if(T)b=eF(t,v),w=t.__c;else{t.__c=w={__v:t,context:v,props:t.props,setState:eI,forceUpdate:eI,__d:!0,__h:[]};for(var k=0;w.__d&&k++<25;)w.__d=!1,eU&&eU(t),b=m.call(w,g,v);w.__d=!0}if(null!=w.getChildContext&&(i=eK({},i,w.getChildContext())),T&&W.errorBoundaries&&(m.getDerivedStateFromError||w.componentDidCatch)){b=null!=b&&b.type===ed&&null==b.key&&null==b.props.tpl?b.props.children:b;try{return e(b,i,r,n,t,a,o)}catch(s){return m.getDerivedStateFromError&&(w.__s=m.getDerivedStateFromError(s)),w.componentDidCatch&&w.componentDidCatch(s,eB),w.__d?(b=eF(t,i),null!=(w=t.__c).getChildContext&&(i=eK({},i,w.getChildContext())),e(b=null!=b&&b.type===ed&&null==b.key&&null==b.props.tpl?b.props.children:b,i,r,n,t,a,o)):""}finally{eL&&eL(t),t.__=null,eD&&eD(t)}}}b=null!=b&&b.type===ed&&null==b.key&&null==b.props.tpl?b.props.children:b;try{var $=e(b,i,r,n,t,a,o);return eL&&eL(t),t.__=null,W.unmount&&W.unmount(t),$}catch(s){if(!a&&o&&o.onError){var E=o.onError(s,t,function(s){return e(s,i,r,n,t,a,o)});if(void 0!==E)return E;var C=W.__e;return C&&C(s,t),""}if(!a||!s||"function"!=typeof s.then)throw s;return s.then(function s(){try{return e(b,i,r,n,t,a,o)}catch(l){if(!l||"function"!=typeof l.then)throw l;return l.then(function(){return e(b,i,r,n,t,a,o)},s)}})}}var P,Q="<"+m,N="";for(var O in g){var q=g[O];if("function"!=typeof q||"class"===O||"className"===O){switch(O){case"children":P=q;continue;case"key":case"ref":case"__self":case"__source":continue;case"htmlFor":if("for"in g)continue;O="for";break;case"className":if("class"in g)continue;O="class";break;case"defaultChecked":O="checked";break;case"defaultSelected":O="selected";break;case"defaultValue":case"value":switch(O="value",m){case"textarea":P=q;continue;case"select":n=q;continue;case"option":n!=q||"selected"in g||(Q+=" selected")}break;case"dangerouslySetInnerHTML":N=q&&q.__html;continue;case"style":"object"==typeof q&&(q=function(e){var t="";for(var i in e){var r=e[i];if(null!=r&&""!==r){var n="-"==i[0]?i:eN[i]||(eN[i]=i.replace(eq,"-$&").toLowerCase()),s=";";"number"!=typeof r||n.startsWith("--")||eO.has(n)||(s="px;"),t=t+n+":"+r+s}}return t||void 0}(q));break;case"acceptCharset":O="accept-charset";break;case"httpEquiv":O="http-equiv";break;default:if(ek.test(O))O=O.replace(ek,"$1:$2").toLowerCase();else{if(eT.test(O))continue;("-"===O[4]||eC.has(O))&&null!=q?q+="":r?eE.test(O)&&(O="panose1"===O?"panose-1":O.replace(/([A-Z])/g,"-$1").toLowerCase()):e$.test(O)&&(O=O.toLowerCase())}}null!=q&&!1!==q&&(Q=!0===q||""===q?Q+" "+O:Q+" "+O+'="'+("string"==typeof q?eQ(q):q+"")+'"')}}if(eT.test(m))throw Error(m+" is not a valid HTML tag name in "+Q+">");if(N||("string"==typeof P?N=eQ(P):null!=P&&!1!==P&&!0!==P&&(N=e(P,i,"svg"===m||"foreignObject"!==m&&r,n,t,a,o))),eL&&eL(t),t.__=null,eD&&eD(t),!N&&eJ.has(m))return Q+"/>";var I="</"+m+">",j=Q+">";return eM(N)?[j].concat(N,[I]):"string"!=typeof N?[j,N,I]:j+N+I}(e,eB,!1,void 0,n,!1,void 0);return eM(s)?s.join(""):s}catch(e){if(e.then)throw Error('Use "renderToStringAsync" for suspenseful rendering.');throw e}finally{W.__c&&W.__c(e,eR),W.__s=r,eR.length=0}}(e)}</div></body></html>`}}function eY(e){let{url:t,theme:i,query:r,cookies:n,pages:s,providers:a}=e;return{csrf:(e,t,i)=>e?(t.logger.warn("csrf-disabled"),i.push({name:t.cookies.csrfToken.name,value:"",options:{...t.cookies.csrfToken.options,maxAge:0}}),{status:404,cookies:i}):{headers:{"Content-Type":"application/json","Cache-Control":"private, no-cache, no-store",Expires:"0",Pragma:"no-cache"},body:{csrfToken:t.csrfToken},cookies:i},providers:e=>({headers:{"Content-Type":"application/json"},body:e.reduce((e,{id:t,name:i,type:r,signinUrl:n,callbackUrl:s})=>(e[t]={id:t,name:i,type:r,signinUrl:n,callbackUrl:s},e),{})}),signin(t,o){if(t)throw new c.D7("Unsupported action");if(s?.signIn){let t=`${s.signIn}${s.signIn.includes("?")?"&":"?"}${new URLSearchParams({callbackUrl:e.callbackUrl??"/"})}`;return o&&(t=`${t}&${new URLSearchParams({error:o})}`),{redirect:t,cookies:n}}let l=a?.find(e=>"webauthn"===e.type&&e.enableConditionalUI&&!!e.simpleWebAuthnBrowserVersion),u="";if(l){let{simpleWebAuthnBrowserVersion:e}=l;u=`<script src="https://unpkg.com/@simplewebauthn/browser@${e}/dist/bundle/index.umd.min.js" crossorigin="anonymous"></script>`}return eG({cookies:n,theme:i,html:function(e){let{csrfToken:t,providers:i=[],callbackUrl:r,theme:n,email:s,error:a}=e;"undefined"!=typeof document&&n?.brandColor&&document.documentElement.style.setProperty("--brand-color",n.brandColor),"undefined"!=typeof document&&n?.buttonText&&document.documentElement.style.setProperty("--button-text-color",n.buttonText);let o=a&&(eV[a]??eV.default),l=i.find(e=>"webauthn"===e.type&&e.enableConditionalUI)?.id;return ez("div",{className:"signin",children:[n?.brandColor&&ez("style",{dangerouslySetInnerHTML:{__html:`:root {--brand-color: ${n.brandColor}}`}}),n?.buttonText&&ez("style",{dangerouslySetInnerHTML:{__html:`
        :root {
          --button-text-color: ${n.buttonText}
        }
      `}}),ez("div",{className:"card",children:[o&&ez("div",{className:"error",children:ez("p",{children:o})}),n?.logo&&ez("img",{src:n.logo,alt:"Logo",className:"logo"}),i.map((e,n)=>{let a,o,l;("oauth"===e.type||"oidc"===e.type)&&({bg:a="#fff",brandColor:o,logo:l=`https://authjs.dev/img/providers/${e.id}.svg`}=e.style??{});let c=o??a??"#fff";return ez("div",{className:"provider",children:["oauth"===e.type||"oidc"===e.type?ez("form",{action:e.signinUrl,method:"POST",children:[ez("input",{type:"hidden",name:"csrfToken",value:t}),r&&ez("input",{type:"hidden",name:"callbackUrl",value:r}),ez("button",{type:"submit",className:"button",style:{"--provider-brand-color":c},tabIndex:0,children:[ez("span",{style:{filter:"invert(1) grayscale(1) brightness(1.3) contrast(9000)","mix-blend-mode":"luminosity",opacity:.95},children:["Sign in with ",e.name]}),l&&ez("img",{loading:"lazy",height:24,src:l})]})]}):null,("email"===e.type||"credentials"===e.type||"webauthn"===e.type)&&n>0&&"email"!==i[n-1].type&&"credentials"!==i[n-1].type&&"webauthn"!==i[n-1].type&&ez("hr",{}),"email"===e.type&&ez("form",{action:e.signinUrl,method:"POST",children:[ez("input",{type:"hidden",name:"csrfToken",value:t}),ez("label",{className:"section-header",htmlFor:`input-email-for-${e.id}-provider`,children:"Email"}),ez("input",{id:`input-email-for-${e.id}-provider`,autoFocus:!0,type:"email",name:"email",value:s,placeholder:"email@example.com",required:!0}),ez("button",{id:"submitButton",type:"submit",tabIndex:0,children:["Sign in with ",e.name]})]}),"credentials"===e.type&&ez("form",{action:e.callbackUrl,method:"POST",children:[ez("input",{type:"hidden",name:"csrfToken",value:t}),Object.keys(e.credentials).map(t=>ez("div",{children:[ez("label",{className:"section-header",htmlFor:`input-${t}-for-${e.id}-provider`,children:e.credentials[t].label??t}),ez("input",{name:t,id:`input-${t}-for-${e.id}-provider`,type:e.credentials[t].type??"text",placeholder:e.credentials[t].placeholder??"",...e.credentials[t]})]},`input-group-${e.id}`)),ez("button",{id:"submitButton",type:"submit",tabIndex:0,children:["Sign in with ",e.name]})]}),"webauthn"===e.type&&ez("form",{action:e.callbackUrl,method:"POST",id:`${e.id}-form`,children:[ez("input",{type:"hidden",name:"csrfToken",value:t}),Object.keys(e.formFields).map(t=>ez("div",{children:[ez("label",{className:"section-header",htmlFor:`input-${t}-for-${e.id}-provider`,children:e.formFields[t].label??t}),ez("input",{name:t,"data-form-field":!0,id:`input-${t}-for-${e.id}-provider`,type:e.formFields[t].type??"text",placeholder:e.formFields[t].placeholder??"",...e.formFields[t]})]},`input-group-${e.id}`)),ez("button",{id:`submitButton-${e.id}`,type:"submit",tabIndex:0,children:["Sign in with ",e.name]})]}),("email"===e.type||"credentials"===e.type||"webauthn"===e.type)&&n+1<i.length&&ez("hr",{})]},e.id)})]}),l&&ez(ed,{children:ez("script",{dangerouslySetInnerHTML:{__html:`
const currentURL = window.location.href;
const authURL = currentURL.substring(0, currentURL.lastIndexOf('/'));
(${eW})(authURL, "${l}");
`}})})]})}({csrfToken:e.csrfToken,providers:e.providers?.filter(e=>["email","oauth","oidc"].includes(e.type)||"credentials"===e.type&&e.credentials||"webauthn"===e.type&&e.formFields||!1),callbackUrl:e.callbackUrl,theme:e.theme,error:o,...r}),title:"Sign In",headTags:u})},signout:()=>s?.signOut?{redirect:s.signOut,cookies:n}:eG({cookies:n,theme:i,html:function(e){let{url:t,csrfToken:i,theme:r}=e;return ez("div",{className:"signout",children:[r?.brandColor&&ez("style",{dangerouslySetInnerHTML:{__html:`
        :root {
          --brand-color: ${r.brandColor}
        }
      `}}),r?.buttonText&&ez("style",{dangerouslySetInnerHTML:{__html:`
        :root {
          --button-text-color: ${r.buttonText}
        }
      `}}),ez("div",{className:"card",children:[r?.logo&&ez("img",{src:r.logo,alt:"Logo",className:"logo"}),ez("h1",{children:"Signout"}),ez("p",{children:"Are you sure you want to sign out?"}),ez("form",{action:t?.toString(),method:"POST",children:[ez("input",{type:"hidden",name:"csrfToken",value:i}),ez("button",{id:"submitButton",type:"submit",children:"Sign out"})]})]})]})}({csrfToken:e.csrfToken,url:t,theme:i}),title:"Sign Out"}),verifyRequest:e=>s?.verifyRequest?{redirect:`${s.verifyRequest}${t?.search??""}`,cookies:n}:eG({cookies:n,theme:i,html:function(e){let{url:t,theme:i}=e;return ez("div",{className:"verify-request",children:[i.brandColor&&ez("style",{dangerouslySetInnerHTML:{__html:`
        :root {
          --brand-color: ${i.brandColor}
        }
      `}}),ez("div",{className:"card",children:[i.logo&&ez("img",{src:i.logo,alt:"Logo",className:"logo"}),ez("h1",{children:"Check your email"}),ez("p",{children:"A sign in link has been sent to your email address."}),ez("p",{children:ez("a",{className:"site",href:t.origin,children:t.host})})]})]})}({url:t,theme:i,...e}),title:"Verify Request"}),error:e=>s?.error?{redirect:`${s.error}${s.error.includes("?")?"&":"?"}error=${e}`,cookies:n}:eG({cookies:n,theme:i,...function(e){let{url:t,error:i="default",theme:r}=e,n=`${t}/signin`,s={default:{status:200,heading:"Error",message:ez("p",{children:ez("a",{className:"site",href:t?.origin,children:t?.host})})},Configuration:{status:500,heading:"Server error",message:ez("div",{children:[ez("p",{children:"There is a problem with the server configuration."}),ez("p",{children:"Check the server logs for more information."})]})},AccessDenied:{status:403,heading:"Access Denied",message:ez("div",{children:[ez("p",{children:"You do not have permission to sign in."}),ez("p",{children:ez("a",{className:"button",href:n,children:"Sign in"})})]})},Verification:{status:403,heading:"Unable to sign in",message:ez("div",{children:[ez("p",{children:"The sign in link is no longer valid."}),ez("p",{children:"It may have been used already or it may have expired."})]}),signin:ez("a",{className:"button",href:n,children:"Sign in"})}},{status:a,heading:o,message:l,signin:c}=s[i]??s.default;return{status:a,html:ez("div",{className:"error",children:[r?.brandColor&&ez("style",{dangerouslySetInnerHTML:{__html:`
        :root {
          --brand-color: ${r?.brandColor}
        }
      `}}),ez("div",{className:"card",children:[r?.logo&&ez("img",{src:r?.logo,alt:"Logo",className:"logo"}),ez("h1",{children:o}),ez("div",{className:"message",children:l}),c]})]})}}({url:t,theme:i,error:e}),title:"Error"})}}function eX(e,t=Date.now()){return new Date(t+1e3*e)}async function e0(e,t,i,r){if(!i?.providerAccountId||!i.type)throw Error("Missing or invalid provider account");if(!["email","oauth","oidc","webauthn"].includes(i.type))throw Error("Provider not supported");let{adapter:n,jwt:s,events:a,session:{strategy:o,generateSessionToken:l}}=r;if(!n)return{user:t,account:i};let u=i,{createUser:d,updateUser:h,getUser:f,getUserByAccount:p,getUserByEmail:m,linkAccount:g,createSession:y,getSessionAndUser:b,deleteSession:w}=n,v=null,S=null,_=!1,A="jwt"===o;if(e){if(A)try{let t=r.cookies.sessionToken.name;(v=await s.decode({...s,token:e,salt:t}))&&"sub"in v&&v.sub&&(S=await f(v.sub))}catch{}else{let t=await b(e);t&&(v=t.session,S=t.user)}}if("email"===u.type){let i=await m(t.email);return i?(S?.id!==i.id&&!A&&e&&await w(e),S=await h({id:i.id,emailVerified:new Date}),await a.updateUser?.({user:S})):(S=await d({...t,emailVerified:new Date}),await a.createUser?.({user:S}),_=!0),{session:v=A?{}:await y({sessionToken:l(),userId:S.id,expires:eX(r.session.maxAge)}),user:S,isNewUser:_}}if("webauthn"===u.type){let e=await p({providerAccountId:u.providerAccountId,provider:u.provider});if(e){if(S){if(e.id===S.id){let e={...u,userId:S.id};return{session:v,user:S,isNewUser:_,account:e}}throw new c.FW("The account is already associated with another user",{provider:u.provider})}v=A?{}:await y({sessionToken:l(),userId:e.id,expires:eX(r.session.maxAge)});let t={...u,userId:e.id};return{session:v,user:e,isNewUser:_,account:t}}{if(S){await g({...u,userId:S.id}),await a.linkAccount?.({user:S,account:u,profile:t});let e={...u,userId:S.id};return{session:v,user:S,isNewUser:_,account:e}}if(t.email?await m(t.email):null)throw new c.FW("Another account already exists with the same e-mail address",{provider:u.provider});S=await d({...t}),await a.createUser?.({user:S}),await g({...u,userId:S.id}),await a.linkAccount?.({user:S,account:u,profile:t}),v=A?{}:await y({sessionToken:l(),userId:S.id,expires:eX(r.session.maxAge)});let e={...u,userId:S.id};return{session:v,user:S,isNewUser:!0,account:e}}}let x=await p({providerAccountId:u.providerAccountId,provider:u.provider});if(x){if(S){if(x.id===S.id)return{session:v,user:S,isNewUser:_};throw new c.Xw("The account is already associated with another user",{provider:u.provider})}return{session:v=A?{}:await y({sessionToken:l(),userId:x.id,expires:eX(r.session.maxAge)}),user:x,isNewUser:_}}{let{provider:e}=r,{type:i,provider:n,providerAccountId:s,userId:o,...h}=u;if(u=Object.assign(e.account(h)??{},{providerAccountId:s,provider:n,type:i,userId:o}),S)return await g({...u,userId:S.id}),await a.linkAccount?.({user:S,account:u,profile:t}),{session:v,user:S,isNewUser:_};let f=t.email?await m(t.email):null;if(f){let e=r.provider;if(e?.allowDangerousEmailAccountLinking)S=f,_=!1;else throw new c.Xw("Another account already exists with the same e-mail address",{provider:u.provider})}else S=await d({...t,emailVerified:null}),_=!0;return await a.createUser?.({user:S}),await g({...u,userId:S.id}),await a.linkAccount?.({user:S,account:u,profile:t}),{session:v=A?{}:await y({sessionToken:l(),userId:S.id,expires:eX(r.session.maxAge)}),user:S,isNewUser:_}}}function e1(e,t){if(null==e)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch{return!1}}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(r="oauth4webapi/v3.8.3");let e6="ERR_INVALID_ARG_VALUE",e2="ERR_INVALID_ARG_TYPE";function e5(e,t,i){let r=TypeError(e,{cause:i});return Object.assign(r,{code:t}),r}let e8=Symbol(),e3=Symbol(),e4=Symbol(),e9=Symbol(),e7=Symbol(),te=Symbol(),tt=Symbol(),ti=new TextEncoder,tr=new TextDecoder;function tn(e){return"string"==typeof e?ti.encode(e):tr.decode(e)}function ts(e){return"string"==typeof e?s(e):n(e)}Uint8Array.prototype.toBase64?n=e=>(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e.toBase64({alphabet:"base64url",omitPadding:!0})):n=e=>{e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let i=0;i<e.byteLength;i+=32768)t.push(String.fromCharCode.apply(null,e.subarray(i,i+32768)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},Uint8Array.fromBase64?s=e=>{try{return Uint8Array.fromBase64(e,{alphabet:"base64url"})}catch(e){throw e5("The input to be decoded is not correctly encoded.",e6,e)}}:s=e=>{try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return i}catch(e){throw e5("The input to be decoded is not correctly encoded.",e6,e)}};class ta extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=ih,Error.captureStackTrace?.(this,this.constructor)}}class to extends Error{code;constructor(e,t){super(e,t),this.name=this.constructor.name,t?.code&&(this.code=t?.code),Error.captureStackTrace?.(this,this.constructor)}}function tl(e,t,i){return new to(e,{code:t,cause:i})}function tc(e){return!(null===e||"object"!=typeof e||Array.isArray(e))}function tu(e){e1(e,Headers)&&(e=Object.fromEntries(e.entries()));let t=new Headers(e??{});if(r&&!t.has("user-agent")&&t.set("user-agent",r),t.has("authorization"))throw e5('"options.headers" must not include the "authorization" header name',e6);return t}function td(e,t){if(void 0!==t){if("function"==typeof t&&(t=t(e.href)),!(t instanceof AbortSignal))throw e5('"options.signal" must return or be an instance of AbortSignal',e2);return t}}function th(e){return e.includes("//")?e.replace("//","/"):e}async function tf(e,t,i,r){if(!(e instanceof URL))throw e5(`"${t}" must be an instance of URL`,e2);tQ(e,r?.[e8]!==!0);let n=i(new URL(e.href)),s=tu(r?.headers);return s.set("accept","application/json"),(r?.[e9]||fetch)(n.href,{body:void 0,headers:Object.fromEntries(s.entries()),method:"GET",redirect:"manual",signal:td(n,r?.signal)})}async function tp(e,t){return tf(e,"issuerIdentifier",e=>{switch(t?.algorithm){case void 0:case"oidc":e.pathname=th(`${e.pathname}/.well-known/openid-configuration`);break;case"oauth2":(function(e,t,i=!1){"/"===e.pathname?e.pathname=t:e.pathname=th(`${t}/${i?e.pathname:e.pathname.replace(/(\/)$/,"")}`)})(e,".well-known/oauth-authorization-server");break;default:throw e5('"options.algorithm" must be "oidc" (default), or "oauth2"',e6)}return e},t)}function tm(e,t,i,r,n){try{if("number"!=typeof e||!Number.isFinite(e))throw e5(`${i} must be a number`,e2,n);if(e>0)return;if(t){if(0!==e)throw e5(`${i} must be a non-negative number`,e6,n);return}throw e5(`${i} must be a positive number`,e6,n)}catch(e){if(r)throw tl(e.message,r,n);throw e}}function tg(e,t,i,r){try{if("string"!=typeof e)throw e5(`${t} must be a string`,e2,r);if(0===e.length)throw e5(`${t} must not be empty`,e6,r)}catch(e){if(i)throw tl(e.message,i,r);throw e}}async function ty(e,t){if(!(e instanceof URL)&&e!==iM)throw e5('"expectedIssuerIdentifier" must be an instance of URL',e2);if(!e1(t,Response))throw e5('"response" must be an instance of Response',e2);if(200!==t.status)throw tl('"response" is not a conform Authorization Server Metadata response (unexpected HTTP status code)',iw,t);iE(t);let i=await iR(t);if(tg(i.issuer,'"response" body "issuer" property',iy,{body:i}),e!==iM&&new URL(i.issuer).href!==e.href)throw tl('"response" body "issuer" property does not match the expected value',ix,{expected:e.href,body:i,attribute:"issuer"});return i}function tb(e){(function(e,t){if(tZ(e)!==t)throw tw(e,t)})(e,"application/json")}function tw(e,...t){let i='"response" content-type must be ';if(t.length>2){let e=t.pop();i+=`${t.join(", ")}, or ${e}`}else 2===t.length?i+=`${t[0]} or ${t[1]}`:i+=t[0];return tl(i,ib,e)}function tv(){return ts(crypto.getRandomValues(new Uint8Array(32)))}async function tS(e){return tg(e,"codeVerifier"),ts(await crypto.subtle.digest("SHA-256",tn(e)))}function t_(e){let t=e?.[e3];return"number"==typeof t&&Number.isFinite(t)?t:0}function tA(e){let t=e?.[e4];return"number"==typeof t&&Number.isFinite(t)&&-1!==Math.sign(t)?t:30}function tx(){return Math.floor(Date.now()/1e3)}function tT(e){if("object"!=typeof e||null===e)throw e5('"as" must be an object',e2);tg(e.issuer,'"as.issuer"')}function tk(e){if("object"!=typeof e||null===e)throw e5('"client" must be an object',e2);tg(e.client_id,'"client.client_id"')}function t$(e,t){let i=tx()+t_(t);return{jti:tv(),aud:e.issuer,exp:i+60,iat:i,nbf:i,iss:t.client_id,sub:t.client_id}}async function tE(e,t,i){if(!i.usages.includes("sign"))throw e5('CryptoKey instances used for signing assertions must include "sign" in their "usages"',e6);let r=`${ts(tn(JSON.stringify(e)))}.${ts(tn(JSON.stringify(t)))}`,n=ts(await crypto.subtle.sign(iN(i),i,tn(r)));return`${r}.${n}`}async function tC(e,t){let{kty:i,e:r,n,x:s,y:o,crv:l,pub:c}=await crypto.subtle.exportKey("jwk",e),u={kty:i,e:r,n,x:s,y:o,crv:l,pub:c};return"AKP"===i&&(u.alg=t),a.set(e,u),u}let tP=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch{return null}};function tQ(e,t){if(t&&"https:"!==e.protocol)throw tl("only requests to HTTPS are allowed",iv,e);if("https:"!==e.protocol&&"http:"!==e.protocol)throw tl("only HTTP and HTTPS requests are allowed",iS,e)}function tN(e,t,i,r){let n;if("string"!=typeof e||!(n=tP(e)))throw tl(`authorization server metadata does not contain a valid ${i?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,void 0===e?ik:i$,{attribute:i?`mtls_endpoint_aliases.${t}`:t});return tQ(n,r),n}function tO(e,t,i,r){return i&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?tN(e.mtls_endpoint_aliases[t],t,i,r):tN(e[t],t,i,r)}class tq extends Error{cause;code;error;status;error_description;response;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=id,this.cause=t.cause,this.error=t.cause.error,this.status=t.response.status,this.error_description=t.cause.error_description,Object.defineProperty(this,"response",{enumerable:!1,value:t.response}),Error.captureStackTrace?.(this,this.constructor)}}class tI extends Error{cause;code;error;error_description;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=ip,this.cause=t.cause,this.error=t.cause.get("error"),this.error_description=t.cause.get("error_description")??void 0,Error.captureStackTrace?.(this,this.constructor)}}class tj extends Error{cause;code;response;status;constructor(e,t){super(e,t),this.name=this.constructor.name,this.code=iu,this.cause=t.cause,this.status=t.response.status,this.response=t.response,Object.defineProperty(this,"response",{enumerable:!1}),Error.captureStackTrace?.(this,this.constructor)}}let tL="[a-zA-Z0-9!#$%&\\'\\*\\+\\-\\.\\^_`\\|~]+",tU=RegExp("^[,\\s]*("+tL+")"),tD=RegExp("^[,\\s]*("+tL+')\\s*=\\s*"((?:[^"\\\\]|\\\\[\\s\\S])*)"[,\\s]*(.*)'),tB=RegExp("^[,\\s]*("+tL+")\\s*=\\s*("+tL+")[,\\s]*(.*)"),tR=RegExp("^([a-zA-Z0-9\\-\\._\\~\\+\\/]+={0,2})(?:$|[,\\s])(.*)");async function tM(e){if(e.status>399&&e.status<500){iE(e),tb(e);try{let t=await e.clone().json();if(tc(t)&&"string"==typeof t.error&&t.error.length)return t}catch{}}}async function tK(e,t,i){if(e.status!==t){let t;if(t5(e),t=await tM(e))throw await e.body?.cancel(),new tq("server responded with an error in the response body",{cause:t,response:e});throw tl(`"response" is not a conform ${i} response (unexpected HTTP status code)`,iw,e)}}function tF(e){if(!t7.has(e))throw e5('"options.DPoP" is not a valid DPoPHandle',e6)}async function tJ(e,t,i,r,n,s){if(tg(e,'"accessToken"'),!(i instanceof URL))throw e5('"url" must be an instance of URL',e2);tQ(i,s?.[e8]!==!0),r=tu(r),s?.DPoP&&(tF(s.DPoP),await s.DPoP.addProof(i,r,t.toUpperCase(),e)),r.set("authorization",`${r.has("dpop")?"DPoP":"Bearer"} ${e}`);let a=await (s?.[e9]||fetch)(i.href,{body:n,headers:Object.fromEntries(r.entries()),method:t,redirect:"manual",signal:td(i,s?.signal)});return s?.DPoP?.cacheNonce(a,i),a}async function tH(e,t,i,r){tT(e),tk(t);let n=tO(e,"userinfo_endpoint",t.use_mtls_endpoint_aliases,r?.[e8]!==!0),s=tu(r?.headers);return t.userinfo_signed_response_alg?s.set("accept","application/jwt"):(s.set("accept","application/json"),s.append("accept","application/jwt")),tJ(i,"GET",n,s,null,{...r,[e3]:t_(t)})}function tz(e,t,i,r){(o||=new WeakMap).set(e,{jwks:t,uat:i,get age(){return tx()-this.uat}}),r&&Object.assign(r,{jwks:structuredClone(t),uat:i})}function tW(e,t){o?.delete(e),delete t?.jwks,delete t?.uat}let tV=Symbol();function tZ(e){return e.headers.get("content-type")?.split(";")[0]}async function tG(e,t,i,r,n){let s;if(tT(e),tk(t),!e1(r,Response))throw e5('"response" must be an instance of Response',e2);if(t5(r),200!==r.status)throw tl('"response" is not a conform UserInfo Endpoint response (unexpected HTTP status code)',iw,r);if(iE(r),"application/jwt"===tZ(r)){let{claims:i,jwt:a}=await iO(await r.text(),ij.bind(void 0,t.userinfo_signed_response_alg,e.userinfo_signing_alg_values_supported,void 0),t_(t),tA(t),n?.[te]).then(t8.bind(void 0,t.client_id)).then(t4.bind(void 0,e));t1.set(r,a),s=i}else{if(t.userinfo_signed_response_alg)throw tl("JWT UserInfo Response expected",im,r);s=await iR(r)}if(tg(s.sub,'"response" body "sub" property',iy,{body:s}),i===tV);else if(tg(i,'"expectedSubject"'),s.sub!==i)throw tl('unexpected "response" body "sub" property value',ix,{expected:i,body:s,attribute:"sub"});return s}async function tY(e,t,i,r,n,s,a){return await i(e,t,n,s),s.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),(a?.[e9]||fetch)(r.href,{body:n,headers:Object.fromEntries(s.entries()),method:"POST",redirect:"manual",signal:td(r,a?.signal)})}async function tX(e,t,i,r,n,s){let a=tO(e,"token_endpoint",t.use_mtls_endpoint_aliases,s?.[e8]!==!0);n.set("grant_type",r);let o=tu(s?.headers);o.set("accept","application/json"),s?.DPoP!==void 0&&(tF(s.DPoP),await s.DPoP.addProof(a,o,"POST"));let l=await tY(e,t,i,a,n,o,s);return s?.DPoP?.cacheNonce(l,a),l}let t0=new WeakMap,t1=new WeakMap;function t6(e){if(!e.id_token)return;let t=t0.get(e);if(!t)throw e5('"ref" was already garbage collected or did not resolve from the proper sources',e6);return t}async function t2(e,t,i,r,n,s){if(tT(e),tk(t),!e1(i,Response))throw e5('"response" must be an instance of Response',e2);await tK(i,200,"Token Endpoint"),iE(i);let a=await iR(i);if(tg(a.access_token,'"response" body "access_token" property',iy,{body:a}),tg(a.token_type,'"response" body "token_type" property',iy,{body:a}),a.token_type=a.token_type.toLowerCase(),void 0!==a.expires_in){let e="number"!=typeof a.expires_in?parseFloat(a.expires_in):a.expires_in;tm(e,!0,'"response" body "expires_in" property',iy,{body:a}),a.expires_in=e}if(void 0!==a.refresh_token&&tg(a.refresh_token,'"response" body "refresh_token" property',iy,{body:a}),void 0!==a.scope&&"string"!=typeof a.scope)throw tl('"response" body "scope" property must be a string',iy,{body:a});if(void 0!==a.id_token){tg(a.id_token,'"response" body "id_token" property',iy,{body:a});let s=["aud","exp","iat","iss","sub"];!0===t.require_auth_time&&s.push("auth_time"),void 0!==t.default_max_age&&(tm(t.default_max_age,!0,'"client.default_max_age"'),s.push("auth_time")),r?.length&&s.push(...r);let{claims:o,jwt:l}=await iO(a.id_token,ij.bind(void 0,t.id_token_signed_response_alg,e.id_token_signing_alg_values_supported,"RS256"),t_(t),tA(t),n).then(ir.bind(void 0,s)).then(t9.bind(void 0,e)).then(t3.bind(void 0,t.client_id));if(Array.isArray(o.aud)&&1!==o.aud.length){if(void 0===o.azp)throw tl('ID Token "aud" (audience) claim includes additional untrusted audiences',iA,{claims:o,claim:"aud"});if(o.azp!==t.client_id)throw tl('unexpected ID Token "azp" (authorized party) claim value',iA,{expected:t.client_id,claims:o,claim:"azp"})}void 0!==o.auth_time&&tm(o.auth_time,!0,'ID Token "auth_time" (authentication time)',iy,{claims:o}),t1.set(i,l),t0.set(a,o)}if(s?.[a.token_type]!==void 0)s[a.token_type](i,a);else if("dpop"!==a.token_type&&"bearer"!==a.token_type)throw new ta("unsupported `token_type` value",{cause:{body:a}});return a}function t5(e){let t;if(t=function(e){if(!e1(e,Response))throw e5('"response" must be an instance of Response',e2);let t=e.headers.get("www-authenticate");if(null===t)return;let i=[],r=t;for(;r;){let e,t=r.match(tU),n=t?.["1"].toLowerCase();if(!n)return;let s=r.substring(t[0].length);if(s&&!s.match(/^[\s,]/))return;let a=s.match(/^\s+(.*)$/),o=!!a;r=a?a[1]:void 0;let l={};if(o)for(;r;){let i,n;if(t=r.match(tD)){if([,i,n,r]=t,n.includes("\\"))try{n=JSON.parse(`"${n}"`)}catch{}l[i.toLowerCase()]=n;continue}if(t=r.match(tB)){[,i,n,r]=t,l[i.toLowerCase()]=n;continue}if(t=r.match(tR)){if(Object.keys(l).length)break;[,e,r]=t;break}return}else r=s||void 0;let c={scheme:n,parameters:l};e&&(c.token68=e),i.push(c)}if(i.length)return i}(e))throw new tj("server responded with a challenge in the WWW-Authenticate HTTP Header",{cause:t,response:e})}function t8(e,t){return void 0!==t.claims.aud?t3(e,t):t}function t3(e,t){if(Array.isArray(t.claims.aud)){if(!t.claims.aud.includes(e))throw tl('unexpected JWT "aud" (audience) claim value',iA,{expected:e,claims:t.claims,claim:"aud"})}else if(t.claims.aud!==e)throw tl('unexpected JWT "aud" (audience) claim value',iA,{expected:e,claims:t.claims,claim:"aud"});return t}function t4(e,t){return void 0!==t.claims.iss?t9(e,t):t}function t9(e,t){let i=e[iK]?.(t)??e.issuer;if(t.claims.iss!==i)throw tl('unexpected JWT "iss" (issuer) claim value',iA,{expected:i,claims:t.claims,claim:"iss"});return t}let t7=new WeakSet,ie=Symbol();async function it(e,t,i,r,n,s,a){if(tT(e),tk(t),!t7.has(r))throw e5('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',e6);tg(n,'"redirectUri"');let o=iL(r,"code");if(!o)throw tl('no authorization code in "callbackParameters"',iy);let l=new URLSearchParams(a?.additionalParameters);return l.set("redirect_uri",n),l.set("code",o),s!==ie&&(tg(s,'"codeVerifier"'),l.set("code_verifier",s)),tX(e,t,i,"authorization_code",l,a)}let ii={aud:"audience",c_hash:"code hash",client_id:"client id",exp:"expiration time",iat:"issued at",iss:"issuer",jti:"jwt id",nonce:"nonce",s_hash:"state hash",sub:"subject",ath:"access token hash",htm:"http method",htu:"http uri",cnf:"confirmation",auth_time:"authentication time"};function ir(e,t){for(let i of e)if(void 0===t.claims[i])throw tl(`JWT "${i}" (${ii[i]}) claim missing`,iy,{claims:t.claims});return t}let is=Symbol(),ia=Symbol();async function io(e,t,i,r){return"string"==typeof r?.expectedNonce||"number"==typeof r?.maxAge||r?.requireIdToken?il(e,t,i,r.expectedNonce,r.maxAge,r[te],r.recognizedTokenTypes):ic(e,t,i,r?.[te],r?.recognizedTokenTypes)}async function il(e,t,i,r,n,s,a){let o=[];switch(r){case void 0:r=is;break;case is:break;default:tg(r,'"expectedNonce" argument'),o.push("nonce")}switch(n??=t.default_max_age){case void 0:n=ia;break;case ia:break;default:tm(n,!0,'"maxAge" argument'),o.push("auth_time")}let l=await t2(e,t,i,o,s,a);tg(l.id_token,'"response" body "id_token" property',iy,{body:l});let c=t6(l);if(n!==ia){let e=tx()+t_(t),i=tA(t);if(c.auth_time+n<e-i)throw tl("too much time has elapsed since the last End-User authentication",i_,{claims:c,now:e,tolerance:i,claim:"auth_time"})}if(r===is){if(void 0!==c.nonce)throw tl('unexpected ID Token "nonce" claim value',iA,{expected:void 0,claims:c,claim:"nonce"})}else if(c.nonce!==r)throw tl('unexpected ID Token "nonce" claim value',iA,{expected:r,claims:c,claim:"nonce"});return l}async function ic(e,t,i,r,n){let s=await t2(e,t,i,void 0,r,n),a=t6(s);if(a){if(void 0!==t.default_max_age){tm(t.default_max_age,!0,'"client.default_max_age"');let e=tx()+t_(t),i=tA(t);if(a.auth_time+t.default_max_age<e-i)throw tl("too much time has elapsed since the last End-User authentication",i_,{claims:a,now:e,tolerance:i,claim:"auth_time"})}if(void 0!==a.nonce)throw tl('unexpected ID Token "nonce" claim value',iA,{expected:void 0,claims:a,claim:"nonce"})}return s}let iu="OAUTH_WWW_AUTHENTICATE_CHALLENGE",id="OAUTH_RESPONSE_BODY_ERROR",ih="OAUTH_UNSUPPORTED_OPERATION",ip="OAUTH_AUTHORIZATION_RESPONSE_ERROR",im="OAUTH_JWT_USERINFO_EXPECTED",ig="OAUTH_PARSE_ERROR",iy="OAUTH_INVALID_RESPONSE",ib="OAUTH_RESPONSE_IS_NOT_JSON",iw="OAUTH_RESPONSE_IS_NOT_CONFORM",iv="OAUTH_HTTP_REQUEST_FORBIDDEN",iS="OAUTH_REQUEST_PROTOCOL_FORBIDDEN",i_="OAUTH_JWT_TIMESTAMP_CHECK_FAILED",iA="OAUTH_JWT_CLAIM_COMPARISON_FAILED",ix="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED",iT="OAUTH_KEY_SELECTION_FAILED",ik="OAUTH_MISSING_SERVER_METADATA",i$="OAUTH_INVALID_SERVER_METADATA";function iE(e){if(e.bodyUsed)throw e5('"response" body has been used already',e6)}async function iC(e,t){tT(e);let i=tO(e,"jwks_uri",!1,t?.[e8]!==!0),r=tu(t?.headers);return r.set("accept","application/json"),r.append("accept","application/jwk-set+json"),(t?.[e9]||fetch)(i.href,{body:void 0,headers:Object.fromEntries(r.entries()),method:"GET",redirect:"manual",signal:td(i,t?.signal)})}async function iP(e){if(!e1(e,Response))throw e5('"response" must be an instance of Response',e2);if(200!==e.status)throw tl('"response" is not a conform JSON Web Key Set response (unexpected HTTP status code)',iw,e);iE(e);let t=await iR(e,e=>(function(e,...t){if(!t.includes(tZ(e)))throw tw(e,...t)})(e,"application/json","application/jwk-set+json"));if(!Array.isArray(t.keys))throw tl('"response" body "keys" property must be an array',iy,{body:t});if(!Array.prototype.every.call(t.keys,tc))throw tl('"response" body "keys" property members must be JWK formatted objects',iy,{body:t});return t}function iQ(e){let{algorithm:t}=e;if("number"!=typeof t.modulusLength||t.modulusLength<2048)throw new ta(`unsupported ${t.name} modulusLength`,{cause:e})}function iN(e){switch(e.algorithm.name){case"ECDSA":return{name:e.algorithm.name,hash:function(e){let{algorithm:t}=e;switch(t.namedCurve){case"P-256":return"SHA-256";case"P-384":return"SHA-384";case"P-521":return"SHA-512";default:throw new ta("unsupported ECDSA namedCurve",{cause:e})}}(e)};case"RSA-PSS":switch(iQ(e),e.algorithm.hash.name){case"SHA-256":case"SHA-384":case"SHA-512":return{name:e.algorithm.name,saltLength:parseInt(e.algorithm.hash.name.slice(-3),10)>>3};default:throw new ta("unsupported RSA-PSS hash name",{cause:e})}case"RSASSA-PKCS1-v1_5":return iQ(e),e.algorithm.name;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":case"Ed25519":return e.algorithm.name}throw new ta("unsupported CryptoKey algorithm name",{cause:e})}async function iO(e,t,i,r,n){let s,a,{0:o,1:l,length:c}=e.split(".");if(5===c){if(void 0!==n)e=await n(e),{0:o,1:l,length:c}=e.split(".");else throw new ta("JWE decryption is not configured",{cause:e})}if(3!==c)throw tl("Invalid JWT",iy,e);try{s=JSON.parse(tn(ts(o)))}catch(e){throw tl("failed to parse JWT Header body as base64url encoded JSON",ig,e)}if(!tc(s))throw tl("JWT Header must be a top level object",iy,e);if(t(s),void 0!==s.crit)throw new ta('no JWT "crit" header parameter extensions are supported',{cause:{header:s}});try{a=JSON.parse(tn(ts(l)))}catch(e){throw tl("failed to parse JWT Payload body as base64url encoded JSON",ig,e)}if(!tc(a))throw tl("JWT Payload must be a top level object",iy,e);let u=tx()+i;if(void 0!==a.exp){if("number"!=typeof a.exp)throw tl('unexpected JWT "exp" (expiration time) claim type',iy,{claims:a});if(a.exp<=u-r)throw tl('unexpected JWT "exp" (expiration time) claim value, expiration is past current timestamp',i_,{claims:a,now:u,tolerance:r,claim:"exp"})}if(void 0!==a.iat&&"number"!=typeof a.iat)throw tl('unexpected JWT "iat" (issued at) claim type',iy,{claims:a});if(void 0!==a.iss&&"string"!=typeof a.iss)throw tl('unexpected JWT "iss" (issuer) claim type',iy,{claims:a});if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw tl('unexpected JWT "nbf" (not before) claim type',iy,{claims:a});if(a.nbf>u+r)throw tl('unexpected JWT "nbf" (not before) claim value',i_,{claims:a,now:u,tolerance:r,claim:"nbf"})}if(void 0!==a.aud&&"string"!=typeof a.aud&&!Array.isArray(a.aud))throw tl('unexpected JWT "aud" (audience) claim type',iy,{claims:a});return{header:s,claims:a,jwt:e}}async function iq(e,t,i){let r;switch(t.alg){case"RS256":case"PS256":case"ES256":r="SHA-256";break;case"RS384":case"PS384":case"ES384":r="SHA-384";break;case"RS512":case"PS512":case"ES512":case"Ed25519":case"EdDSA":r="SHA-512";break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":r={name:"cSHAKE256",length:512};break;default:throw new ta(`unsupported JWS algorithm for ${i} calculation`,{cause:{alg:t.alg}})}let n=await crypto.subtle.digest(r,tn(e));return ts(n.slice(0,n.byteLength/2))}async function iI(e){if(e.bodyUsed)throw e5("form_post Request instances must contain a readable body",e6,{cause:e});return e.text()}function ij(e,t,i,r){if(void 0!==e){if("string"==typeof e?r.alg!==e:!e.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',iy,{header:r,expected:e,reason:"client configuration"});return}if(Array.isArray(t)){if(!t.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',iy,{header:r,expected:t,reason:"authorization server metadata"});return}if(void 0!==i){if("string"==typeof i?r.alg!==i:"function"==typeof i?!i(r.alg):!i.includes(r.alg))throw tl('unexpected JWT "alg" header parameter',iy,{header:r,expected:i,reason:"default value"});return}throw tl('missing client or server configuration to verify used JWT "alg" header parameter',void 0,{client:e,issuer:t,fallback:i})}function iL(e,t){let{0:i,length:r}=e.getAll(t);if(r>1)throw tl(`"${t}" parameter must be provided only once`,iy);return i}let iU=Symbol(),iD=Symbol();async function iB(e,t){let{ext:i,key_ops:r,use:n,...s}=t;return crypto.subtle.importKey("jwk",s,function(e){switch(e){case"PS256":case"PS384":case"PS512":return{name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`};case"RS256":case"RS384":case"RS512":return{name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`};case"ES256":case"ES384":return{name:"ECDSA",namedCurve:`P-${e.slice(-3)}`};case"ES512":return{name:"ECDSA",namedCurve:"P-521"};case"EdDSA":return"Ed25519";case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e;default:throw new ta("unsupported JWS algorithm",{cause:{alg:e}})}}(e),!0,["verify"])}async function iR(e,t=tb){let i;try{i=await e.json()}catch(i){throw t(e),tl('failed to parse "response" body as JSON',ig,i)}if(!tc(i))throw tl('"response" body must be a top level object',iy,{body:i});return i}let iM=Symbol(),iK=Symbol();async function iF(e,t,i){let{cookies:r,logger:n}=i,s=r[e],a=new Date;a.setTime(a.getTime()+9e5),n.debug(`CREATE_${e.toUpperCase()}`,{name:s.name,payload:t,COOKIE_TTL:900,expires:a});let o=await (0,b.cv)({...i.jwt,maxAge:900,token:{value:t},salt:s.name}),l={...s.options,expires:a};return{name:s.name,value:o,options:l}}async function iJ(e,t,i){try{let{logger:r,cookies:n,jwt:s}=i;if(r.debug(`PARSE_${e.toUpperCase()}`,{cookie:t}),!t)throw new c.gS(`${e} cookie was missing`);let a=await (0,b.Jx)({...s,token:t,salt:n[e].name});if(a?.value)return a.value;throw Error("Invalid cookie")}catch(t){throw new c.gS(`${e} value could not be parsed`,{cause:t})}}function iH(e,t,i){let{logger:r,cookies:n}=t,s=n[e];r.debug(`CLEAR_${e.toUpperCase()}`,{cookie:s}),i.push({name:s.name,value:"",options:{...n[e].options,maxAge:0}})}function iz(e,t){return async function(i,r,n){let{provider:s,logger:a}=n;if(!s?.checks?.includes(e))return;let o=i?.[n.cookies[t].name];a.debug(`USE_${t.toUpperCase()}`,{value:o});let l=await iJ(t,o,n);return iH(t,n,r),l}}let iW={async create(e){let t=tv(),i=await tS(t);return{cookie:await iF("pkceCodeVerifier",t,e),value:i}},use:iz("pkce","pkceCodeVerifier")},iV="encodedState",iZ={async create(e,t){let{provider:i}=e;if(!i.checks.includes("state")){if(t)throw new c.gS("State data was provided but the provider is not configured to use state");return}let r={origin:t,random:tv()},n=await (0,b.cv)({secret:e.jwt.secret,token:r,salt:iV,maxAge:900});return{cookie:await iF("state",n,e),value:n}},use:iz("state","state"),async decode(e,t){try{t.logger.debug("DECODE_STATE",{state:e});let i=await (0,b.Jx)({secret:t.jwt.secret,token:e,salt:iV});if(i)return i;throw Error("Invalid state")}catch(e){throw new c.gS("State could not be decoded",{cause:e})}}},iG={async create(e){if(!e.provider.checks.includes("nonce"))return;let t=tv();return{cookie:await iF("nonce",t,e),value:t}},use:iz("nonce","nonce")},iY="encodedWebauthnChallenge",iX={create:async(e,t,i)=>({cookie:await iF("webauthnChallenge",await (0,b.cv)({secret:e.jwt.secret,token:{challenge:t,registerData:i},salt:iY,maxAge:900}),e)}),async use(e,t,i){let r=t?.[e.cookies.webauthnChallenge.name],n=await iJ("webauthnChallenge",r,e),s=await (0,b.Jx)({secret:e.jwt.secret,token:n,salt:iY});if(iH("webauthnChallenge",e,i),!s)throw new c.gS("WebAuthn challenge was missing");return s}};var i0=i(58091),i1=i(96572),i6=i(9744),i2=i(20218);function i5(e){return encodeURIComponent(e).replace(/%20/g,"+")}async function i8(e,t,i){let r,n,s;let{logger:a,provider:o}=i,{token:l,userinfo:u}=o;if(l?.url&&"authjs.dev"!==l.url.host||u?.url&&"authjs.dev"!==u.url.host)r={issuer:o.issuer??"https://authjs.dev",token_endpoint:l?.url.toString(),userinfo_endpoint:u?.url.toString()};else{let e=new URL(o.issuer),t=await tp(e,{[e8]:!0,[e9]:o[D]});if(!(r=await ty(e,t)).token_endpoint)throw TypeError("TODO: Authorization server did not provide a token endpoint.");if(!r.userinfo_endpoint)throw TypeError("TODO: Authorization server did not provide a userinfo endpoint.")}let d={client_id:o.clientId,...o.client};switch(d.token_endpoint_auth_method){case void 0:case"client_secret_basic":n=(e,t,i,r)=>{r.set("authorization",function(e,t){let i=i5(e),r=i5(t),n=btoa(`${i}:${r}`);return`Basic ${n}`}(o.clientId,o.clientSecret))};break;case"client_secret_post":var h;tg(h=o.clientSecret,'"clientSecret"'),n=(e,t,i,r)=>{i.set("client_id",t.client_id),i.set("client_secret",h)};break;case"client_secret_jwt":n=function(e,t){let i;tg(e,'"clientSecret"');let r=void 0;return async(t,n,s,a)=>{i||=await crypto.subtle.importKey("raw",tn(e),{hash:"SHA-256",name:"HMAC"},!1,["sign"]);let o={alg:"HS256"},l=t$(t,n);r?.(o,l);let c=`${ts(tn(JSON.stringify(o)))}.${ts(tn(JSON.stringify(l)))}`,u=await crypto.subtle.sign(i.algorithm,i,tn(c));s.set("client_id",n.client_id),s.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),s.set("client_assertion",`${c}.${ts(new Uint8Array(u))}`)}}(o.clientSecret);break;case"private_key_jwt":n=function(e,t){let{key:i,kid:r}=e instanceof CryptoKey?{key:e}:e?.key instanceof CryptoKey?(void 0!==e.kid&&tg(e.kid,'"kid"'),{key:e.key,kid:e.kid}):{};return function(e,t){if(function(e,t){if(!(e instanceof CryptoKey))throw e5(`${t} must be a CryptoKey`,e2)}(e,t),"private"!==e.type)throw e5(`${t} must be a private CryptoKey`,e6)}(i,'"clientPrivateKey.key"'),async(e,n,s,a)=>{let o={alg:function(e){switch(e.algorithm.name){case"RSA-PSS":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"PS256";case"SHA-384":return"PS384";case"SHA-512":return"PS512";default:throw new ta("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}}(e);case"RSASSA-PKCS1-v1_5":return function(e){switch(e.algorithm.hash.name){case"SHA-256":return"RS256";case"SHA-384":return"RS384";case"SHA-512":return"RS512";default:throw new ta("unsupported RsaHashedKeyAlgorithm hash name",{cause:e})}}(e);case"ECDSA":return function(e){switch(e.algorithm.namedCurve){case"P-256":return"ES256";case"P-384":return"ES384";case"P-521":return"ES512";default:throw new ta("unsupported EcKeyAlgorithm namedCurve",{cause:e})}}(e);case"Ed25519":case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return e.algorithm.name;case"EdDSA":return"Ed25519";default:throw new ta("unsupported CryptoKey algorithm name",{cause:e})}}(i),kid:r},l=t$(e,n);t?.[e7]?.(o,l),s.set("client_id",n.client_id),s.set("client_assertion_type","urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),s.set("client_assertion",await tE(o,l,i))}}(o.token.clientPrivateKey,{[e7](e,t){t.aud=[r.issuer,r.token_endpoint]}});break;case"none":n=(e,t,i,r)=>{i.set("client_id",t.client_id)};break;default:throw Error("unsupported client authentication method")}let f=[],p=await iZ.use(t,f,i);try{s=function(e,t,i,r){var n;if(tT(e),tk(t),i instanceof URL&&(i=i.searchParams),!(i instanceof URLSearchParams))throw e5('"parameters" must be an instance of URLSearchParams, or URL',e2);if(iL(i,"response"))throw tl('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',iy,{parameters:i});let s=iL(i,"iss"),a=iL(i,"state");if(!s&&e.authorization_response_iss_parameter_supported)throw tl('response parameter "iss" (issuer) missing',iy,{parameters:i});if(s&&s!==e.issuer)throw tl('unexpected "iss" (issuer) response parameter value',iy,{expected:e.issuer,parameters:i});switch(r){case void 0:case iD:if(void 0!==a)throw tl('unexpected "state" response parameter encountered',iy,{expected:void 0,parameters:i});break;case iU:break;default:if(tg(r,'"expectedState" argument'),a!==r)throw tl(void 0===a?'response parameter "state" missing':'unexpected "state" response parameter value',iy,{expected:r,parameters:i})}if(iL(i,"error"))throw new tI("authorization response from the server is an error",{cause:i});let o=iL(i,"id_token"),l=iL(i,"token");if(void 0!==o||void 0!==l)throw new ta("implicit and hybrid flows are not supported");return n=new URLSearchParams(i),t7.add(n),n}(r,d,new URLSearchParams(e),o.checks.includes("state")?p:iU)}catch(e){if(e instanceof tI){let t={providerId:o.id,...Object.fromEntries(e.cause.entries())};throw a.debug("OAuthCallbackError",t),new c.iV("OAuth Provider returned an error",t)}throw e}let m=await iW.use(t,f,i),g=o.callbackUrl;!i.isOnRedirectProxy&&o.redirectProxyUrl&&(g=o.redirectProxyUrl);let y=await it(r,d,n,s,g,m??"decoy",{[e8]:!0,[e9]:(...e)=>(o.checks.includes("pkce")||e[1].body.delete("code_verifier"),(o[D]??fetch)(...e))});o.token?.conform&&(y=await o.token.conform(y.clone())??y);let b={},w="oidc"===o.type;if(o[B])switch(o.id){case"microsoft-entra-id":case"azure-ad":{let e=await y.clone().json();if(e.error){let t={providerId:o.id,...e};throw new c.iV(`OAuth Provider returned an error: ${e.error}`,t)}let{tid:t}=function(e){let t,i;if("string"!=typeof e)throw new i2.uv("JWTs must use Compact JWS serialization, JWT must be a string");let{1:r,length:n}=e.split(".");if(5===n)throw new i2.uv("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new i2.uv("Invalid JWT");if(!r)throw new i2.uv("JWTs must contain a payload");try{t=(0,i0.J)(r)}catch{throw new i2.uv("Failed to base64url decode the payload")}try{i=JSON.parse(i1.xv.decode(t))}catch{throw new i2.uv("Failed to parse the decoded payload as JSON")}if(!(0,i6.K)(i))throw new i2.uv("Invalid JWT Claims Set");return i}(e.id_token);if("string"==typeof t){let e=r.issuer?.match(/microsoftonline\.com\/(\w+)\/v2\.0/)?.[1]??"common",i=new URL(r.issuer.replace(e,t)),n=await tp(i,{[e9]:o[D]});r=await ty(i,n)}}}let v=await io(r,d,y,{expectedNonce:await iG.use(t,f,i),requireIdToken:w});if(w){let t=t6(v);if(b=t,o[B]&&"apple"===o.id)try{b.user=JSON.parse(e?.user)}catch{}if(!1===o.idToken){let e=await tH(r,d,v.access_token,{[e9]:o[D],[e8]:!0});b=await tG(r,d,t.sub,e)}}else if(u?.request){let e=await u.request({tokens:v,provider:o});e instanceof Object&&(b=e)}else if(u?.url){let e=await tH(r,d,v.access_token,{[e9]:o[D],[e8]:!0});b=await e.json()}else throw TypeError("No userinfo endpoint configured");return v.expires_in&&(v.expires_at=Math.floor(Date.now()/1e3)+Number(v.expires_in)),{...await i3(b,o,v,a),profile:b,cookies:f}}async function i3(e,t,i,r){try{let r=await t.profile(e,i);return{user:{...r,id:crypto.randomUUID(),email:r.email?.toLowerCase()},account:{...i,provider:t.id,type:t.type,providerAccountId:r.id??crypto.randomUUID()}}}catch(i){r.debug("getProfile error details",e),r.error(new c.X0(i,{provider:t.id}))}}async function i4(e,t,i,r){let n=await ri(e,t,i),{cookie:s}=await iX.create(e,n.challenge,i);return{status:200,cookies:[...r??[],s],body:{action:"register",options:n},headers:{"Content-Type":"application/json"}}}async function i9(e,t,i,r){let n=await rt(e,t,i),{cookie:s}=await iX.create(e,n.challenge);return{status:200,cookies:[...r??[],s],body:{action:"authenticate",options:n},headers:{"Content-Type":"application/json"}}}async function i7(e,t,i){let r;let{adapter:n,provider:s}=e,a=t.body&&"string"==typeof t.body.data?JSON.parse(t.body.data):void 0;if(!a||"object"!=typeof a||!("id"in a)||"string"!=typeof a.id)throw new c.l4("Invalid WebAuthn Authentication response");let o=rs(rn(a.id)),l=await n.getAuthenticator(o);if(!l)throw new c.l4(`WebAuthn authenticator not found in database: ${JSON.stringify({credentialID:o})}`);let{challenge:u}=await iX.use(e,t.cookies,i);try{let i=s.getRelayingParty(e,t);r=await s.simpleWebAuthn.verifyAuthenticationResponse({...s.verifyAuthenticationOptions,expectedChallenge:u,response:a,authenticator:{...l,credentialDeviceType:l.credentialDeviceType,transports:ra(l.transports),credentialID:rn(l.credentialID),credentialPublicKey:rn(l.credentialPublicKey)},expectedOrigin:i.origin,expectedRPID:i.id})}catch(e){throw new c.vV(e)}let{verified:d,authenticationInfo:h}=r;if(!d)throw new c.vV("WebAuthn authentication response could not be verified");try{let{newCounter:e}=h;await n.updateAuthenticatorCounter(l.credentialID,e)}catch(e){throw new c.dq(`Failed to update authenticator counter. This may cause future authentication attempts to fail. ${JSON.stringify({credentialID:o,oldCounter:l.counter,newCounter:h.newCounter})}`,e)}let f=await n.getAccount(l.providerAccountId,s.id);if(!f)throw new c.l4(`WebAuthn account not found in database: ${JSON.stringify({credentialID:o,providerAccountId:l.providerAccountId})}`);let p=await n.getUser(f.userId);if(!p)throw new c.l4(`WebAuthn user not found in database: ${JSON.stringify({credentialID:o,providerAccountId:l.providerAccountId,userID:f.userId})}`);return{account:f,user:p}}async function re(e,t,i){var r;let n;let{provider:s}=e,a=t.body&&"string"==typeof t.body.data?JSON.parse(t.body.data):void 0;if(!a||"object"!=typeof a||!("id"in a)||"string"!=typeof a.id)throw new c.l4("Invalid WebAuthn Registration response");let{challenge:o,registerData:l}=await iX.use(e,t.cookies,i);if(!l)throw new c.l4("Missing user registration data in WebAuthn challenge cookie");try{let i=s.getRelayingParty(e,t);n=await s.simpleWebAuthn.verifyRegistrationResponse({...s.verifyRegistrationOptions,expectedChallenge:o,response:a,expectedOrigin:i.origin,expectedRPID:i.id})}catch(e){throw new c.vV(e)}if(!n.verified||!n.registrationInfo)throw new c.vV("WebAuthn registration response could not be verified");let u={providerAccountId:rs(n.registrationInfo.credentialID),provider:e.provider.id,type:s.type},d={providerAccountId:u.providerAccountId,counter:n.registrationInfo.counter,credentialID:rs(n.registrationInfo.credentialID),credentialPublicKey:rs(n.registrationInfo.credentialPublicKey),credentialBackedUp:n.registrationInfo.credentialBackedUp,credentialDeviceType:n.registrationInfo.credentialDeviceType,transports:(r=a.response.transports,r?.join(","))};return{user:l,account:u,authenticator:d}}async function rt(e,t,i){let{provider:r,adapter:n}=e,s=i&&i.id?await n.listAuthenticatorsByUserId(i.id):null,a=r.getRelayingParty(e,t);return await r.simpleWebAuthn.generateAuthenticationOptions({...r.authenticationOptions,rpID:a.id,allowCredentials:s?.map(e=>({id:rn(e.credentialID),type:"public-key",transports:ra(e.transports)}))})}async function ri(e,t,i){let{provider:r,adapter:n}=e,s=i.id?await n.listAuthenticatorsByUserId(i.id):null,a=N(32),o=r.getRelayingParty(e,t);return await r.simpleWebAuthn.generateRegistrationOptions({...r.registrationOptions,userID:a,userName:i.email,userDisplayName:i.name??void 0,rpID:o.id,rpName:o.name,excludeCredentials:s?.map(e=>({id:rn(e.credentialID),type:"public-key",transports:ra(e.transports)}))})}function rr(e){let{provider:t,adapter:i}=e;if(!i)throw new c.Xp("An adapter is required for the WebAuthn provider");if(!t||"webauthn"!==t.type)throw new c.Ab("Provider must be WebAuthn");return{...e,provider:t,adapter:i}}function rn(e){return new Uint8Array(Buffer.from(e,"base64"))}function rs(e){return Buffer.from(e).toString("base64")}function ra(e){return e?e.split(","):void 0}async function ro(e,t,i,r){if(!t.provider)throw new c.Ab("Callback route called without provider");let{query:n,body:s,method:a,headers:o}=e,{provider:l,adapter:u,url:d,callbackUrl:h,pages:f,jwt:p,events:m,callbacks:g,session:{strategy:y,maxAge:b},logger:w}=t,v="jwt"===y;try{if("oauth"===l.type||"oidc"===l.type){let a;let o=l.authorization?.url.searchParams.get("response_mode")==="form_post"?s:n;if(t.isOnRedirectProxy&&o?.state){let e=await iZ.decode(o.state,t);if(e?.origin&&new URL(e.origin).origin!==t.url.origin){let t=`${e.origin}?${new URLSearchParams(o)}`;return w.debug("Proxy redirecting to",t),{redirect:t,cookies:r}}}let c=await i8(o,e.cookies,t);c.cookies.length&&r.push(...c.cookies),w.debug("authorization result",c);let{user:y,account:S,profile:_}=c;if(!y||!S||!_)return{redirect:`${d}/signin`,cookies:r};if(u){let{getUserByAccount:e}=u;a=await e({providerAccountId:S.providerAccountId,provider:l.id})}let A=await rl({user:a??y,account:S,profile:_},t);if(A)return{redirect:A,cookies:r};let{user:x,session:T,isNewUser:k}=await e0(i.value,y,S,t);if(v){let e={name:x.name,email:x.email,picture:x.image,sub:x.id?.toString()},n=await g.jwt({token:e,user:x,account:S,profile:_,isNewUser:k,trigger:k?"signUp":"signIn"});if(null===n)r.push(...i.clean());else{let e=t.cookies.sessionToken.name,s=await p.encode({...p,token:n,salt:e}),a=new Date;a.setTime(a.getTime()+1e3*b);let o=i.chunk(s,{expires:a});r.push(...o)}}else r.push({name:t.cookies.sessionToken.name,value:T.sessionToken,options:{...t.cookies.sessionToken.options,expires:T.expires}});if(await m.signIn?.({user:x,account:S,profile:_,isNewUser:k}),k&&f.newUser)return{redirect:`${f.newUser}${f.newUser.includes("?")?"&":"?"}${new URLSearchParams({callbackUrl:h})}`,cookies:r};return{redirect:h,cookies:r}}if("email"===l.type){let e=n?.token,s=n?.email;if(!e){let t=TypeError("Missing token. The sign-in URL was manually opened without token or the link was not sent correctly in the email.",{cause:{hasToken:!!e}});throw t.name="Configuration",t}let a=l.secret??t.secret,o=await u.useVerificationToken({identifier:s,token:await Q(`${e}${a}`)}),d=!!o,y=d&&o.expires.valueOf()<Date.now();if(!d||y||s&&o.identifier!==s)throw new c.GX({hasInvite:d,expired:y});let{identifier:w}=o,S=await u.getUserByEmail(w)??{id:crypto.randomUUID(),email:w,emailVerified:null},_={providerAccountId:S.email,userId:S.id,type:"email",provider:l.id},A=await rl({user:S,account:_},t);if(A)return{redirect:A,cookies:r};let{user:x,session:T,isNewUser:k}=await e0(i.value,S,_,t);if(v){let e={name:x.name,email:x.email,picture:x.image,sub:x.id?.toString()},n=await g.jwt({token:e,user:x,account:_,isNewUser:k,trigger:k?"signUp":"signIn"});if(null===n)r.push(...i.clean());else{let e=t.cookies.sessionToken.name,s=await p.encode({...p,token:n,salt:e}),a=new Date;a.setTime(a.getTime()+1e3*b);let o=i.chunk(s,{expires:a});r.push(...o)}}else r.push({name:t.cookies.sessionToken.name,value:T.sessionToken,options:{...t.cookies.sessionToken.options,expires:T.expires}});if(await m.signIn?.({user:x,account:_,isNewUser:k}),k&&f.newUser)return{redirect:`${f.newUser}${f.newUser.includes("?")?"&":"?"}${new URLSearchParams({callbackUrl:h})}`,cookies:r};return{redirect:h,cookies:r}}if("credentials"===l.type&&"POST"===a){let e=s??{};Object.entries(n??{}).forEach(([e,t])=>d.searchParams.set(e,t));let u=await l.authorize(e,new Request(d,{headers:o,method:a,body:JSON.stringify(s)}));if(u)u.id=u.id?.toString()??crypto.randomUUID();else throw new c.UC;let f={providerAccountId:u.id,type:"credentials",provider:l.id},y=await rl({user:u,account:f,credentials:e},t);if(y)return{redirect:y,cookies:r};let w={name:u.name,email:u.email,picture:u.image,sub:u.id},v=await g.jwt({token:w,user:u,account:f,isNewUser:!1,trigger:"signIn"});if(null===v)r.push(...i.clean());else{let e=t.cookies.sessionToken.name,n=await p.encode({...p,token:v,salt:e}),s=new Date;s.setTime(s.getTime()+1e3*b);let a=i.chunk(n,{expires:s});r.push(...a)}return await m.signIn?.({user:u,account:f}),{redirect:h,cookies:r}}if("webauthn"===l.type&&"POST"===a){let n,s,a;let o=e.body?.action;if("string"!=typeof o||"authenticate"!==o&&"register"!==o)throw new c.l4("Invalid action parameter");let l=rr(t);switch(o){case"authenticate":{let t=await i7(l,e,r);n=t.user,s=t.account;break}case"register":{let i=await re(t,e,r);n=i.user,s=i.account,a=i.authenticator}}await rl({user:n,account:s},t);let{user:u,isNewUser:d,session:y,account:w}=await e0(i.value,n,s,t);if(!w)throw new c.l4("Error creating or finding account");if(a&&u.id&&await l.adapter.createAuthenticator({...a,userId:u.id}),v){let e={name:u.name,email:u.email,picture:u.image,sub:u.id?.toString()},n=await g.jwt({token:e,user:u,account:w,isNewUser:d,trigger:d?"signUp":"signIn"});if(null===n)r.push(...i.clean());else{let e=t.cookies.sessionToken.name,s=await p.encode({...p,token:n,salt:e}),a=new Date;a.setTime(a.getTime()+1e3*b);let o=i.chunk(s,{expires:a});r.push(...o)}}else r.push({name:t.cookies.sessionToken.name,value:y.sessionToken,options:{...t.cookies.sessionToken.options,expires:y.expires}});if(await m.signIn?.({user:u,account:w,isNewUser:d}),d&&f.newUser)return{redirect:`${f.newUser}${f.newUser.includes("?")?"&":"?"}${new URLSearchParams({callbackUrl:h})}`,cookies:r};return{redirect:h,cookies:r}}throw new c.Ab(`Callback for provider type (${l.type}) is not supported`)}catch(t){if(t instanceof c.l4)throw t;let e=new c.Ng(t,{provider:l.id});throw w.debug("callback route error details",{method:a,query:n,body:s}),e}}async function rl(e,t){let i;let{signIn:r,redirect:n}=t.callbacks;try{i=await r(e)}catch(e){if(e instanceof c.l4)throw e;throw new c.JK(e)}if(!i)throw new c.JK("AccessDenied");if("string"==typeof i)return await n({url:i,baseUrl:t.url.origin})}async function rc(e,t,i,r,n){let{adapter:s,jwt:a,events:o,callbacks:l,logger:u,session:{strategy:d,maxAge:h}}=e,f={body:null,headers:{"Content-Type":"application/json",...!r&&{"Cache-Control":"private, no-cache, no-store",Expires:"0",Pragma:"no-cache"}},cookies:i},p=t.value;if(!p)return f;if("jwt"===d){try{let i=e.cookies.sessionToken.name,s=await a.decode({...a,token:p,salt:i});if(!s)throw Error("Invalid JWT");let c=await l.jwt({token:s,...r&&{trigger:"update"},session:n}),u=eX(h);if(null!==c){let e={user:{name:c.name,email:c.email,image:c.picture},expires:u.toISOString()},r=await l.session({session:e,token:c});f.body=r;let n=await a.encode({...a,token:c,salt:i}),s=t.chunk(n,{expires:u});f.cookies?.push(...s),await o.session?.({session:r,token:c})}else f.cookies?.push(...t.clean())}catch(e){u.error(new c.xo(e)),f.cookies?.push(...t.clean())}return f}try{let{getSessionAndUser:i,deleteSession:a,updateSession:c}=s,u=await i(p);if(u&&u.session.expires.valueOf()<Date.now()&&(await a(p),u=null),u){let{user:t,session:i}=u,s=e.session.updateAge,a=i.expires.valueOf()-1e3*h+1e3*s,d=eX(h);a<=Date.now()&&await c({sessionToken:p,expires:d});let m=await l.session({session:{...i,user:t},user:t,newSession:n,...r?{trigger:"update"}:{}});f.body=m,f.cookies?.push({name:e.cookies.sessionToken.name,value:p,options:{...e.cookies.sessionToken.options,expires:d}}),await o.session?.({session:m})}else p&&f.cookies?.push(...t.clean())}catch(e){u.error(new c.li(e))}return f}async function ru(e,t){let i,r;let{logger:n,provider:s}=t,a=s.authorization?.url;if(!a||"authjs.dev"===a.host){let e=new URL(s.issuer),t=await tp(e,{[e9]:s[D],[e8]:!0}),i=await ty(e,t).catch(t=>{if(!(t instanceof TypeError)||"Invalid URL"!==t.message)throw t;throw TypeError(`Discovery request responded with an invalid issuer. expected: ${e}`)});if(!i.authorization_endpoint)throw TypeError("Authorization server did not provide an authorization endpoint.");a=new URL(i.authorization_endpoint)}let o=a.searchParams,l=s.callbackUrl;!t.isOnRedirectProxy&&s.redirectProxyUrl&&(l=s.redirectProxyUrl,r=s.callbackUrl,n.debug("using redirect proxy",{redirect_uri:l,data:r}));let c=Object.assign({response_type:"code",client_id:s.clientId,redirect_uri:l,...s.authorization?.params},Object.fromEntries(s.authorization?.url.searchParams??[]),e);for(let e in c)o.set(e,c[e]);let u=[];s.authorization?.url.searchParams.get("response_mode")==="form_post"&&(t.cookies.state.options.sameSite="none",t.cookies.state.options.secure=!0,t.cookies.nonce.options.sameSite="none",t.cookies.nonce.options.secure=!0);let d=await iZ.create(t,r);if(d&&(o.set("state",d.value),u.push(d.cookie)),s.checks?.includes("pkce")){if(i&&!i.code_challenge_methods_supported?.includes("S256"))"oidc"===s.type&&(s.checks=["nonce"]);else{let{value:e,cookie:i}=await iW.create(t);o.set("code_challenge",e),o.set("code_challenge_method","S256"),u.push(i)}}let h=await iG.create(t);return h&&(o.set("nonce",h.value),u.push(h.cookie)),"oidc"!==s.type||a.searchParams.has("scope")||a.searchParams.set("scope","openid profile email"),n.debug("authorization url is ready",{url:a,cookies:u,provider:s}),{redirect:a.toString(),cookies:u}}async function rd(e,t){let i;let{body:r}=e,{provider:n,callbacks:s,adapter:a}=t,o=(n.normalizeIdentifier??function(e){if(!e)throw Error("Missing email from request body.");let[t,i]=e.toLowerCase().trim().split("@");return i=i.split(",")[0],`${t}@${i}`})(r?.email),l={id:crypto.randomUUID(),email:o,emailVerified:null},u=await a.getUserByEmail(o)??l,d={providerAccountId:o,userId:u.id,type:"email",provider:n.id};try{i=await s.signIn({user:u,account:d,email:{verificationRequest:!0}})}catch(e){throw new c.JK(e)}if(!i)throw new c.JK("AccessDenied");if("string"==typeof i)return{redirect:await s.redirect({url:i,baseUrl:t.url.origin})};let{callbackUrl:h,theme:f}=t,p=await n.generateVerificationToken?.()??N(32),m=new Date(Date.now()+(n.maxAge??86400)*1e3),g=n.secret??t.secret,y=new URL(t.basePath,t.url.origin),b=n.sendVerificationRequest({identifier:o,token:p,expires:m,url:`${y}/callback/${n.id}?${new URLSearchParams({callbackUrl:h,token:p,email:o})}`,provider:n,theme:f,request:new Request(e.url,{headers:e.headers,method:e.method,body:"POST"===e.method?JSON.stringify(e.body??{}):void 0})}),w=a.createVerificationToken?.({identifier:o,token:await Q(`${p}${g}`),expires:m});return await Promise.all([b,w]),{redirect:`${y}/verify-request?${new URLSearchParams({provider:n.id,type:n.type})}`}}async function rh(e,t,i){let r=`${i.url.origin}${i.basePath}/signin`;if(!i.provider)return{redirect:r,cookies:t};switch(i.provider.type){case"oauth":case"oidc":{let{redirect:r,cookies:n}=await ru(e.query,i);return n&&t.push(...n),{redirect:r,cookies:t}}case"email":return{...await rd(e,i),cookies:t};default:return{redirect:r,cookies:t}}}async function rf(e,t,i){let{jwt:r,events:n,callbackUrl:s,logger:a,session:o}=i,l=t.value;if(!l)return{redirect:s,cookies:e};try{if("jwt"===o.strategy){let e=i.cookies.sessionToken.name,t=await r.decode({...r,token:l,salt:e});await n.signOut?.({token:t})}else{let e=await i.adapter?.deleteSession(l);await n.signOut?.({session:e})}}catch(e){a.error(new c.V1(e))}return e.push(...t.clean()),{redirect:s,cookies:e}}async function rp(e,t){let{adapter:i,jwt:r,session:{strategy:n}}=e,s=t.value;if(!s)return null;if("jwt"===n){let t=e.cookies.sessionToken.name,i=await r.decode({...r,token:s,salt:t});if(i&&i.sub)return{id:i.sub,name:i.name,email:i.email,image:i.picture}}else{let e=await i?.getSessionAndUser(s);if(e)return e.user}return null}async function rm(e,t,i,r){let n=rr(t),{provider:s}=n,{action:a}=e.query??{};if("register"!==a&&"authenticate"!==a&&void 0!==a)return{status:400,body:{error:"Invalid action"},cookies:r,headers:{"Content-Type":"application/json"}};let o=await rp(t,i),l=o?{user:o,exists:!0}:await s.getUserInfo(t,e),c=l?.user;switch(function(e,t,i){let{user:r,exists:n=!1}=i??{};switch(e){case"authenticate":return"authenticate";case"register":if(r&&t===n)return"register";break;case void 0:if(!t){if(!r||n)return"authenticate";return"register"}}return null}(a,!!o,l)){case"authenticate":return i9(n,e,c,r);case"register":if("string"==typeof c?.email)return i4(n,e,c,r);break;default:return{status:400,body:{error:"Invalid request"},cookies:r,headers:{"Content-Type":"application/json"}}}}async function rg(e,t){let{action:i,providerId:r,error:n,method:s}=e,a=t.skipCSRFCheck===L,{options:o,cookies:u}=await H({authOptions:t,action:i,providerId:r,url:e.url,callbackUrl:e.body?.callbackUrl??e.query?.callbackUrl,csrfToken:e.body?.csrfToken,cookies:e.cookies,isPost:"POST"===s,csrfDisabled:a}),d=new l.p(o.cookies.sessionToken,e.cookies,o.logger);if("GET"===s){let t=eY({...o,query:e.query,cookies:u});switch(i){case"callback":return await ro(e,o,d,u);case"csrf":return t.csrf(a,o,u);case"error":return t.error(n);case"providers":return t.providers(o.providers);case"session":return await rc(o,d,u);case"signin":return t.signin(r,n);case"signout":return t.signout();case"verify-request":return t.verifyRequest();case"webauthn-options":return await rm(e,o,d,u)}}else{let{csrfTokenVerified:t}=o;switch(i){case"callback":return"credentials"===o.provider.type&&q(i,t),await ro(e,o,d,u);case"session":return q(i,t),await rc(o,d,u,!0,e.body?.data);case"signin":return q(i,t),await rh(e,u,o);case"signout":return q(i,t),await rf(u,d,o)}}throw new c.D7(`Cannot handle action: ${i}`)}function ry(e,t,i,r,n){let s;let a=n?.basePath,o=r.AUTH_URL??r.NEXTAUTH_URL;if(o)s=new URL(o),a&&"/"!==a&&"/"!==s.pathname&&(s.pathname!==a&&x(n).warn("env-url-basepath-mismatch"),s.pathname="/");else{let e=i.get("x-forwarded-host")??i.get("host"),r=i.get("x-forwarded-proto")??t??"https",n=r.endsWith(":")?r:r+":";s=new URL(`${n}//${e}`)}let l=s.toString().replace(/\/$/,"");if(a){let t=a?.replace(/(^\/|\/$)/g,"")??"";return new URL(`${l}/${t}/${e}`)}return new URL(`${l}/${e}`)}async function rb(e,t){let i=x(t),r=await C(e,t);if(!r)return Response.json("Bad request.",{status:400});let n=function(e,t){let{url:i}=e,r=[];if(!u&&t.debug&&r.push("debug-enabled"),!t.trustHost)return new c.kA(`Host must be trusted. URL was: ${e.url}`);if(!t.secret?.length)return new c.yv("Please define a `secret`");let n=e.query?.callbackUrl;if(n&&!d(n,i.origin))return new c.k7(`Invalid callback URL. Received: ${n}`);let{callbackUrl:s}=(0,l.x)(t.useSecureCookies??"https:"===i.protocol),a=e.cookies?.[t.cookies?.callbackUrl?.name??s.name];if(a&&!d(a,i.origin))return new c.k7(`Invalid callback URL. Received: ${a}`);let o=!1;for(let e of t.providers){let t="function"==typeof e?e():e;if(("oauth"===t.type||"oidc"===t.type)&&!(t.issuer??t.options?.issuer)){let e;let{authorization:i,token:r,userinfo:n}=t;if("string"==typeof i||i?.url?"string"==typeof r||r?.url?"string"==typeof n||n?.url||(e="userinfo"):e="token":e="authorization",e)return new c.Hi(`Provider "${t.id}" is missing both \`issuer\` and \`${e}\` endpoint config. At least one of them is required`)}if("credentials"===t.type)h=!0;else if("email"===t.type)f=!0;else if("webauthn"===t.type){var b;if(p=!0,t.simpleWebAuthnBrowserVersion&&(b=t.simpleWebAuthnBrowserVersion,!/^v\d+(?:\.\d+){0,2}$/.test(b)))return new c.l4(`Invalid provider config for "${t.id}": simpleWebAuthnBrowserVersion "${t.simpleWebAuthnBrowserVersion}" must be a valid semver string.`);if(t.enableConditionalUI){if(o)return new c.j7("Multiple webauthn providers have 'enableConditionalUI' set to True. Only one provider can have this option enabled at a time");if(o=!0,!Object.values(t.formFields).some(e=>e.autocomplete&&e.autocomplete.toString().indexOf("webauthn")>-1))return new c.BX(`Provider "${t.id}" has 'enableConditionalUI' set to True, but none of its formFields have 'webauthn' in their autocomplete param`)}}}if(h){let e=t.session?.strategy==="database",i=!t.providers.some(e=>"credentials"!==("function"==typeof e?e():e).type);if(e&&i)return new c.lA("Signing in with credentials only supported if JWT strategy is enabled");if(t.providers.some(e=>{let t="function"==typeof e?e():e;return"credentials"===t.type&&!t.authorize}))return new c.yQ("Must define an authorize() handler to use credentials authentication provider")}let{adapter:w,session:v}=t,S=[];if(f||v?.strategy==="database"||!v?.strategy&&w){if(f){if(!w)return new c.Xp("Email login requires an adapter");S.push(...m)}else{if(!w)return new c.Xp("Database session requires an adapter");S.push(...g)}}if(p){if(!t.experimental?.enableWebAuthn)return new c.dw("WebAuthn is an experimental feature. To enable it, set `experimental.enableWebAuthn` to `true` in your config");if(r.push("experimental-webauthn"),!w)return new c.Xp("WebAuthn requires an adapter");S.push(...y)}if(w){let e=S.filter(e=>!(e in w));if(e.length)return new c.xP(`Required adapter methods were missing: ${e.join(", ")}`)}return u||(u=!0),r}(r,t);if(Array.isArray(n))n.forEach(i.warn);else if(n){if(i.error(n),!new Set(["signin","signout","error","verify-request"]).has(r.action)||"GET"!==r.method)return Response.json({message:"There was a problem with the server configuration. Check the server logs for more information."},{status:500});let{pages:e,theme:s}=t,a=e?.error&&r.url.searchParams.get("callbackUrl")?.startsWith(e.error);if(!e?.error||a)return a&&i.error(new c.Mq(`The error page ${e?.error} should not require authentication`)),P(eY({theme:s}).error("Configuration"));let o=`${r.url.origin}${e.error}?error=Configuration`;return Response.redirect(o)}let s=e.headers?.has("X-Auth-Return-Redirect"),a=t.raw===U;try{let e=await rg(r,t);if(a)return e;let i=P(e),n=i.headers.get("Location");if(!s||!n)return i;return Response.json({url:n},{headers:i.headers})}catch(h){i.error(h);let n=h instanceof c.l4;if(n&&a&&!s)throw h;if("POST"===e.method&&"session"===r.action)return Response.json(null,{status:400});let o=new URLSearchParams({error:(0,c.pI)(h)?h.type:"Configuration"});h instanceof c.UC&&o.set("code",h.code);let l=n&&h.kind||"error",u=t.pages?.[l]??`${t.basePath}/${l.toLowerCase()}`,d=`${r.url.origin}${u}?${o}`;if(s)return Response.json({url:d});return Response.redirect(d)}}var rw=i(87070);function rv(e){let t=process.env.AUTH_URL??process.env.NEXTAUTH_URL;if(!t)return e;let{origin:i}=new URL(t),{href:r,origin:n}=e.nextUrl;return new rw.NextRequest(r.replace(n,i),e)}function rS(e){try{e.secret??(e.secret=process.env.AUTH_SECRET??process.env.NEXTAUTH_SECRET);let t=process.env.AUTH_URL??process.env.NEXTAUTH_URL;if(!t)return;let{pathname:i}=new URL(t);if("/"===i)return;e.basePath||(e.basePath=i)}catch{}finally{e.basePath||(e.basePath="/api/auth"),function(e,t,i=!1){try{let r=e.AUTH_URL;r&&(t.basePath?i||x(t).warn("env-url-basepath-redundant"):t.basePath=new URL(r).pathname)}catch{}finally{t.basePath??(t.basePath="/auth")}if(!t.secret?.length){t.secret=[];let i=e.AUTH_SECRET;for(let r of(i&&t.secret.push(i),[1,2,3])){let i=e[`AUTH_SECRET_${r}`];i&&t.secret.unshift(i)}}t.redirectProxyUrl??(t.redirectProxyUrl=e.AUTH_REDIRECT_PROXY_URL),t.trustHost??(t.trustHost=!!(e.AUTH_URL??e.AUTH_TRUST_HOST??e.VERCEL??e.CF_PAGES??"production"!==e.NODE_ENV)),t.providers=t.providers.map(t=>{let{id:i}="function"==typeof t?t({}):t,r=i.toUpperCase().replace(/-/g,"_"),n=e[`AUTH_${r}_ID`],s=e[`AUTH_${r}_SECRET`],a=e[`AUTH_${r}_ISSUER`],o=e[`AUTH_${r}_KEY`],l="function"==typeof t?t({clientId:n,clientSecret:s,issuer:a,apiKey:o}):t;return"oauth"===l.type||"oidc"===l.type?(l.clientId??(l.clientId=n),l.clientSecret??(l.clientSecret=s),l.issuer??(l.issuer=a)):"email"===l.type&&(l.apiKey??(l.apiKey=o)),l})}(process.env,e,!0)}}var r_=i(71615);async function rA(e,t){return rb(new Request(ry("session",e.get("x-forwarded-proto"),e,process.env,t),{headers:{cookie:e.get("cookie")??""}}),{...t,callbacks:{...t.callbacks,async session(...e){let i=await t.callbacks?.session?.(...e)??{...e[0].session,expires:e[0].session.expires?.toISOString?.()??e[0].session.expires};return{user:e[0].user??e[0].token,...i}}}})}function rx(e){return"function"==typeof e}function rT(e,t){return"function"==typeof e?async(...i)=>{if(!i.length){let i=await (0,r_.headers)(),r=await e(void 0);return t?.(r),rA(i,r).then(e=>e.json())}if(i[0]instanceof Request){let r=i[0],n=i[1],s=await e(r);return t?.(s),rk([r,n],s)}if(rx(i[0])){let r=i[0];return async(...i)=>{let n=await e(i[0]);return t?.(n),rk(i,n,r)}}let r="req"in i[0]?i[0].req:i[0],n="res"in i[0]?i[0].res:i[1],s=await e(r);return t?.(s),rA(new Headers(r.headers),s).then(async e=>{let t=await e.json();for(let t of e.headers.getSetCookie())"headers"in n?n.headers.append("set-cookie",t):n.appendHeader("set-cookie",t);return t})}:(...t)=>{if(!t.length)return Promise.resolve((0,r_.headers)()).then(t=>rA(t,e).then(e=>e.json()));if(t[0]instanceof Request)return rk([t[0],t[1]],e);if(rx(t[0])){let i=t[0];return async(...t)=>rk(t,e,i).then(e=>e)}let i="req"in t[0]?t[0].req:t[0],r="res"in t[0]?t[0].res:t[1];return rA(new Headers(i.headers),e).then(async e=>{let t=await e.json();for(let t of e.headers.getSetCookie())"headers"in r?r.headers.append("set-cookie",t):r.appendHeader("set-cookie",t);return t})}}async function rk(e,t,i){let r=rv(e[0]),n=await rA(r.headers,t),s=await n.json(),a=!0;t.callbacks?.authorized&&(a=await t.callbacks.authorized({request:r,auth:s}));let o=rw.NextResponse.next?.();if(a instanceof Response){o=a;let e=a.headers.get("Location"),{pathname:i}=r.nextUrl;e&&function(e,t,i){let r=t.replace(`${e}/`,""),n=Object.values(i.pages??{});return(r$.has(r)||n.includes(t))&&t===e}(i,new URL(e).pathname,t)&&(a=!0)}else if(i)r.auth=s,o=await i(r,e[1])??rw.NextResponse.next();else if(!a){let e=t.pages?.signIn??`${t.basePath}/signin`;if(r.nextUrl.pathname!==e){let t=r.nextUrl.clone();t.pathname=e,t.searchParams.set("callbackUrl",r.nextUrl.href),o=rw.NextResponse.redirect(t)}}let l=new Response(o?.body,o);for(let e of n.headers.getSetCookie())l.headers.append("set-cookie",e);return l}let r$=new Set(["providers","session","csrf","signin","signout","callback","verify-request","error"]);var rE=i(58585);async function rC(e,t={},i,r){let n=new Headers(await (0,r_.headers)()),{redirect:s=!0,redirectTo:a,...o}=t instanceof FormData?Object.fromEntries(t):t,l=a?.toString()??n.get("Referer")??"/",c=ry("signin",n.get("x-forwarded-proto"),n,process.env,r);if(!e)return c.searchParams.append("callbackUrl",l),s&&(0,rE.redirect)(c.toString()),c.toString();let u=`${c}/${e}?${new URLSearchParams(i)}`,d={};for(let t of r.providers){let{options:i,...r}="function"==typeof t?t():t,n=i?.id??r.id;if(n===e){d={id:n,type:i?.type??r.type};break}}if(!d.id){let e=`${c}?${new URLSearchParams({callbackUrl:l})}`;return s&&(0,rE.redirect)(e),e}"credentials"===d.type&&(u=u.replace("signin","callback")),n.set("Content-Type","application/x-www-form-urlencoded");let h=new Request(u,{method:"POST",headers:n,body:new URLSearchParams({...o,callbackUrl:l})}),f=await rb(h,{...r,raw:U,skipCSRFCheck:L}),p=await (0,r_.cookies)();for(let e of f?.cookies??[])p.set(e.name,e.value,e.options);let m=(f instanceof Response?f.headers.get("Location"):f.redirect)??u;return s?(0,rE.redirect)(m):m}async function rP(e,t){let i=new Headers(await (0,r_.headers)());i.set("Content-Type","application/x-www-form-urlencoded");let r=ry("signout",i.get("x-forwarded-proto"),i,process.env,t),n=new URLSearchParams({callbackUrl:e?.redirectTo??i.get("Referer")??"/"}),s=new Request(r,{method:"POST",headers:i,body:n}),a=await rb(s,{...t,raw:U,skipCSRFCheck:L}),o=await (0,r_.cookies)();for(let e of a?.cookies??[])o.set(e.name,e.value,e.options);return e?.redirect??!0?(0,rE.redirect)(a.redirect):a}async function rQ(e,t){let i=new Headers(await (0,r_.headers)());i.set("Content-Type","application/json");let r=new Request(ry("session",i.get("x-forwarded-proto"),i,process.env,t),{method:"POST",headers:i,body:JSON.stringify({data:e})}),n=await rb(r,{...t,raw:U,skipCSRFCheck:L}),s=await (0,r_.cookies)();for(let e of n?.cookies??[])s.set(e.name,e.value,e.options);return n.body}function rN(e){if("function"==typeof e){let t=async t=>{let i=await e(t);return rS(i),rb(rv(t),i)};return{handlers:{GET:t,POST:t},auth:rT(e,e=>rS(e)),signIn:async(t,i,r)=>{let n=await e(void 0);return rS(n),rC(t,i,r,n)},signOut:async t=>{let i=await e(void 0);return rS(i),rP(t,i)},unstable_update:async t=>{let i=await e(void 0);return rS(i),rQ(t,i)}}}rS(e);let t=t=>rb(rv(t),e);return{handlers:{GET:t,POST:t},auth:rT(e),signIn:(t,i,r)=>rC(t,i,r,e),signOut:t=>rP(t,e),unstable_update:t=>rQ(t,e)}}},62391:(e,t,i)=>{i.d(t,{Ab:()=>E,BX:()=>I,D7:()=>k,FW:()=>L,GX:()=>P,Hi:()=>h,JK:()=>a,Mq:()=>l,Ng:()=>o,Rk:()=>Q,UC:()=>d,V1:()=>T,X0:()=>S,Xp:()=>m,Xw:()=>w,dq:()=>s,dw:()=>U,gS:()=>f,iV:()=>v,j7:()=>q,k7:()=>u,kA:()=>C,l4:()=>r,lA:()=>$,li:()=>_,pI:()=>O,vV:()=>j,xP:()=>g,xQ:()=>c,xo:()=>p,yQ:()=>y,yv:()=>b});class r extends Error{constructor(e,t){e instanceof Error?super(void 0,{cause:{err:e,...e.cause,...t}}):"string"==typeof e?(t instanceof Error&&(t={err:t,...t.cause}),super(e,t)):super(void 0,e),this.name=this.constructor.name,this.type=this.constructor.type??"AuthError",this.kind=this.constructor.kind??"error",Error.captureStackTrace?.(this,this.constructor);let i=`https://errors.authjs.dev#${this.type.toLowerCase()}`;this.message+=`${this.message?". ":""}Read more at ${i}`}}class n extends r{}n.kind="signIn";class s extends r{}s.type="AdapterError";class a extends r{}a.type="AccessDenied";class o extends r{}o.type="CallbackRouteError";class l extends r{}l.type="ErrorPageLoop";class c extends r{}c.type="EventError";class u extends r{}u.type="InvalidCallbackUrl";class d extends n{constructor(){super(...arguments),this.code="credentials"}}d.type="CredentialsSignin";class h extends r{}h.type="InvalidEndpoints";class f extends r{}f.type="InvalidCheck";class p extends r{}p.type="JWTSessionError";class m extends r{}m.type="MissingAdapter";class g extends r{}g.type="MissingAdapterMethods";class y extends r{}y.type="MissingAuthorize";class b extends r{}b.type="MissingSecret";class w extends n{}w.type="OAuthAccountNotLinked";class v extends n{}v.type="OAuthCallbackError";class S extends r{}S.type="OAuthProfileParseError";class _ extends r{}_.type="SessionTokenError";class A extends n{}A.type="OAuthSignInError";class x extends n{}x.type="EmailSignInError";class T extends r{}T.type="SignOutError";class k extends r{}k.type="UnknownAction";class $ extends r{}$.type="UnsupportedStrategy";class E extends r{}E.type="InvalidProvider";class C extends r{}C.type="UntrustedHost";class P extends r{}P.type="Verification";class Q extends n{}Q.type="MissingCSRF";let N=new Set(["CredentialsSignin","OAuthAccountNotLinked","OAuthCallbackError","AccessDenied","Verification","MissingCSRF","AccountNotLinked","WebAuthnVerificationError"]);function O(e){return e instanceof r&&N.has(e.type)}class q extends r{}q.type="DuplicateConditionalUI";class I extends r{}I.type="MissingWebAuthnAutocomplete";class j extends r{}j.type="WebAuthnVerificationError";class L extends n{}L.type="AccountNotLinked";class U extends r{}U.type="ExperimentalFeatureNotEnabled"},83854:(e,t,i)=>{let r,n;i.d(t,{Jx:()=>eJ,cv:()=>eF,LP:()=>eH});var s=i(84770);let a=(e,t,i,r,n)=>{let a=parseInt(e.substr(3),10)>>3||20,o=(0,s.createHmac)(e,i.byteLength?i:new Uint8Array(a)).update(t).digest(),l=Math.ceil(n/a),c=new Uint8Array(a*l+r.byteLength+1),u=0,d=0;for(let t=1;t<=l;t++)c.set(r,d),c[d+r.byteLength]=t,c.set((0,s.createHmac)(e,o).update(c.subarray(u,d+r.byteLength+1)).digest(),d),u=d,d+=a;return c.slice(0,n)};"function"!=typeof s.hkdf||process.versions.electron||(r=async(...e)=>new Promise((t,i)=>{s.hkdf(...e,(e,r)=>{e?i(e):t(new Uint8Array(r))})}));let o=async(e,t,i,n,s)=>(r||a)(e,t,i,n,s);function l(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function c(e,t,i,r,n){return o(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=l(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),l(i,"salt"),function(e){let t=l(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(r),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(n,e))}async function u(e,t){let i=`SHA-${e.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(i,t))}var d=i(58091),h=i(20218),f=i(96572);function p(e){if(!m(e))throw Error("CryptoKey instance expected")}let m=e=>{if(e?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return e instanceof CryptoKey}catch{return!1}},g=e=>e?.[Symbol.toStringTag]==="KeyObject",y=e=>m(e)||g(e);var b=i(9744);let w=e=>(0,b.K)(e)&&"string"==typeof e.kty,v=e=>"oct"!==e.kty&&("AKP"===e.kty&&"string"==typeof e.priv||"string"==typeof e.d),S=e=>"oct"!==e.kty&&void 0===e.d&&void 0===e.priv,_=e=>"oct"===e.kty&&"string"==typeof e.k;function A(e,t,...i){if((i=i.filter(Boolean)).length>2){let t=i.pop();e+=`one of type ${i.join(", ")}, or ${t}.`}else 2===i.length?e+=`one of type ${i[0]} or ${i[1]}.`:e+=`of type ${i[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let x=(e,...t)=>A("Key must be ",e,...t),T=(e,t,...i)=>A(`Key for the ${e} algorithm must be `,t,...i);async function k(e){if(g(e)){if("secret"!==e.type)return e.export({format:"jwk"});e=e.export()}if(e instanceof Uint8Array)return{kty:"oct",k:(0,d.c)(e)};if(!m(e))throw TypeError(x(e,"CryptoKey","KeyObject","Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:i,alg:r,use:n,...s}=await crypto.subtle.exportKey("jwk",e);return"AKP"===s.kty&&(s.alg=r),s}async function $(e){return k(e)}let E=(e,t)=>{if("string"!=typeof e||!e)throw new h.yc(`${t} missing or invalid`)};async function C(e,t){let i,r;if(w(e))i=e;else if(y(e))i=await $(e);else throw TypeError(x(e,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(t??="sha256")&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(i.kty){case"AKP":E(i.alg,'"alg" (Algorithm) Parameter'),E(i.pub,'"pub" (Public key) Parameter'),r={alg:i.alg,kty:i.kty,pub:i.pub};break;case"EC":E(i.crv,'"crv" (Curve) Parameter'),E(i.x,'"x" (X Coordinate) Parameter'),E(i.y,'"y" (Y Coordinate) Parameter'),r={crv:i.crv,kty:i.kty,x:i.x,y:i.y};break;case"OKP":E(i.crv,'"crv" (Subtype of Key Pair) Parameter'),E(i.x,'"x" (Public Key) Parameter'),r={crv:i.crv,kty:i.kty,x:i.x};break;case"RSA":E(i.e,'"e" (Exponent) Parameter'),E(i.n,'"n" (Modulus) Parameter'),r={e:i.e,kty:i.kty,n:i.n};break;case"oct":E(i.k,'"k" (Key Value) Parameter'),r={k:i.k,kty:i.kty};break;default:throw new h.jq('"kty" (Key Type) Parameter missing or unsupported')}let n=(0,f.cv)(JSON.stringify(r));return(0,d.c)(await u(t,n))}let P=Symbol();function Q(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new h.jq(`Unsupported JWE Algorithm: ${e}`)}}let N=e=>crypto.getRandomValues(new Uint8Array(Q(e)>>3));function O(e,t){if(t.length<<3!==Q(e))throw new h.Zw("Invalid Initialization Vector length")}function q(e,t){let i=e.byteLength<<3;if(i!==t)throw new h.Zw(`Invalid Content Encryption Key length. Expected ${t} bits, got ${i} bits`)}let I=(e,t="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`),j=(e,t)=>e.name===t;function L(e,t,i){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!j(e.algorithm,"AES-GCM"))throw I("AES-GCM");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw I(i,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!j(e.algorithm,"AES-KW"))throw I("AES-KW");let i=parseInt(t.slice(1,4),10);if(e.algorithm.length!==i)throw I(i,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":break;default:throw I("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!j(e.algorithm,"PBKDF2"))throw I("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!j(e.algorithm,"RSA-OAEP"))throw I("RSA-OAEP");let i=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==i)throw I(`SHA-${i}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t&&!e.usages.includes(t))throw TypeError(`CryptoKey does not support this operation, its usages must include ${t}.`)})(e,i)}async function U(e,t,i,r,n){if(!(i instanceof Uint8Array))throw TypeError(x(i,"Uint8Array"));let s=parseInt(e.slice(1,4),10),a=await crypto.subtle.importKey("raw",i.subarray(s>>3),"AES-CBC",!1,["encrypt"]),o=await crypto.subtle.importKey("raw",i.subarray(0,s>>3),{hash:`SHA-${s<<1}`,name:"HMAC"},!1,["sign"]),l=new Uint8Array(await crypto.subtle.encrypt({iv:r,name:"AES-CBC"},a,t)),c=(0,f.zo)(n,r,l,(0,f.bx)(n.length<<3));return{ciphertext:l,tag:new Uint8Array((await crypto.subtle.sign("HMAC",o,c)).slice(0,s>>3)),iv:r}}async function D(e,t,i,r,n){let s;i instanceof Uint8Array?s=await crypto.subtle.importKey("raw",i,"AES-GCM",!1,["encrypt"]):(L(i,e,"encrypt"),s=i);let a=new Uint8Array(await crypto.subtle.encrypt({additionalData:n,iv:r,name:"AES-GCM",tagLength:128},s,t)),o=a.slice(-16);return{ciphertext:a.slice(0,-16),tag:o,iv:r}}async function B(e,t,i,r,n){if(!m(i)&&!(i instanceof Uint8Array))throw TypeError(x(i,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));switch(r?O(e,r):r=N(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return i instanceof Uint8Array&&q(i,parseInt(e.slice(-3),10)),U(e,t,i,r,n);case"A128GCM":case"A192GCM":case"A256GCM":return i instanceof Uint8Array&&q(i,parseInt(e.slice(1,4),10)),D(e,t,i,r,n);default:throw new h.jq("Unsupported JWE Content Encryption Algorithm")}}function R(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function M(e,t,i){return e instanceof Uint8Array?crypto.subtle.importKey("raw",e,"AES-KW",!0,[i]):(L(e,t,i),e)}async function K(e,t,i){let r=await M(t,e,"wrapKey");R(r,e);let n=await crypto.subtle.importKey("raw",i,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",n,r,"AES-KW"))}async function F(e,t,i){let r=await M(t,e,"unwrapKey");R(r,e);let n=await crypto.subtle.unwrapKey("raw",i,r,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",n))}function J(e){return(0,f.zo)((0,f.Jz)(e.length),e)}async function H(e,t,i){let r=t>>3,n=Math.ceil(r/32),s=new Uint8Array(32*n);for(let t=1;t<=n;t++){let r=new Uint8Array(4+e.length+i.length);r.set((0,f.Jz)(t),0),r.set(e,4),r.set(i,4+e.length);let n=await u("sha256",r);s.set(n,(t-1)*32)}return s.slice(0,r)}async function z(e,t,i,r,n=new Uint8Array,s=new Uint8Array){L(e,"ECDH"),L(t,"ECDH","deriveBits");let a=J((0,f.cv)(i)),o=J(n),l=J(s),c=(0,f.Jz)(r),u=new Uint8Array,d=(0,f.zo)(a,o,l,c,u);return H(new Uint8Array(await crypto.subtle.deriveBits({name:e.algorithm.name,public:e},t,"X25519"===e.algorithm.name?256:Math.ceil(parseInt(e.algorithm.namedCurve.slice(-3),10)/8)<<3)),r,d)}function W(e){switch(e.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===e.algorithm.name}}let V=(e,t)=>(0,f.zo)((0,f.cv)(e),Uint8Array.of(0),t);async function Z(e,t,i,r){if(!(e instanceof Uint8Array)||e.length<8)throw new h.Zw("PBES2 Salt Input must be 8 or more octets");let n=V(t,e),s=parseInt(t.slice(13,16),10),a={hash:`SHA-${t.slice(8,11)}`,iterations:i,name:"PBKDF2",salt:n},o=await (r instanceof Uint8Array?crypto.subtle.importKey("raw",r,"PBKDF2",!1,["deriveBits"]):(L(r,t,"deriveBits"),r));return new Uint8Array(await crypto.subtle.deriveBits(a,o,s))}async function G(e,t,i,r=2048,n=crypto.getRandomValues(new Uint8Array(16))){let s=await Z(n,e,r,t);return{encryptedKey:await K(e.slice(-6),s,i),p2c:r,p2s:(0,d.c)(n)}}async function Y(e,t,i,r,n){let s=await Z(n,e,r,t);return F(e.slice(-6),s,i)}function X(e,t){if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:i}=t.algorithm;if("number"!=typeof i||i<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}}let ee=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new h.jq(`alg ${e} is not supported either by JOSE or your javascript runtime`)}};async function et(e,t,i){return L(t,e,"encrypt"),X(e,t),new Uint8Array(await crypto.subtle.encrypt(ee(e),t,i))}async function ei(e,t,i){return L(t,e,"decrypt"),X(e,t),new Uint8Array(await crypto.subtle.decrypt(ee(e),t,i))}async function er(e){if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:i}=function(e){let t,i;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},i=e.priv?["sign"]:["verify"];break;default:throw new h.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},i=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},i=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},i=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new h.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},i=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},i=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},i=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},i=e.d?["deriveBits"]:[];break;default:throw new h.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},i=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},i=e.d?["deriveBits"]:[];break;default:throw new h.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new h.jq('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:i}}(e),r={...e};return"AKP"!==r.kty&&delete r.alg,delete r.use,crypto.subtle.importKey("jwk",r,t,e.ext??(!e.d&&!e.priv),e.key_ops??i)}let en=async(e,t,i,r=!1)=>{let s=(n||=new WeakMap).get(e);if(s?.[i])return s[i];let a=await er({...t,alg:i});return r&&Object.freeze(e),s?s[i]=a:n.set(e,{[i]:a}),a},es=(e,t)=>{let i;let r=(n||=new WeakMap).get(e);if(r?.[t])return r[t];let s="public"===e.type,a=!!s;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}i=e.toCryptoKey(e.asymmetricKeyType,a,s?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,a,[s?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");i=e.toCryptoKey(e.asymmetricKeyType,a,[s?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let r;switch(t){case"RSA-OAEP":r="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":r="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":r="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":r="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:r},a,s?["encrypt"]:["decrypt"]);i=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:r},a,[s?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let r=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===r&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[s?"verify":"sign"])),"ES384"===t&&"P-384"===r&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[s?"verify":"sign"])),"ES512"===t&&"P-521"===r&&(i=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[s?"verify":"sign"])),t.startsWith("ECDH-ES")&&(i=e.toCryptoKey({name:"ECDH",namedCurve:r},a,s?[]:["deriveBits"]))}if(!i)throw TypeError("given KeyObject instance cannot be used for this algorithm");return r?r[t]=i:n.set(e,{[t]:i}),i};async function ea(e,t){if(e instanceof Uint8Array||m(e))return e;if(g(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return es(e,t)}catch(e){if(e instanceof TypeError)throw e}let i=e.export({format:"jwk"});return en(e,i,t)}if(w(e))return e.k?(0,d.J)(e.k):en(e,e,t,!0);throw Error("unreachable")}function eo(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new h.jq(`Unsupported JWE Algorithm: ${e}`)}}let el=e=>crypto.getRandomValues(new Uint8Array(eo(e)>>3));async function ec(e,t){if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let i={name:"HMAC",hash:"SHA-256"},r=await crypto.subtle.generateKey(i,!1,["sign"]),n=new Uint8Array(await crypto.subtle.sign(i,r,e)),s=new Uint8Array(await crypto.subtle.sign(i,r,t)),a=0,o=-1;for(;++o<32;)a|=n[o]^s[o];return 0===a}async function eu(e,t,i,r,n,s){let a,o;if(!(t instanceof Uint8Array))throw TypeError(x(t,"Uint8Array"));let l=parseInt(e.slice(1,4),10),c=await crypto.subtle.importKey("raw",t.subarray(l>>3),"AES-CBC",!1,["decrypt"]),u=await crypto.subtle.importKey("raw",t.subarray(0,l>>3),{hash:`SHA-${l<<1}`,name:"HMAC"},!1,["sign"]),d=(0,f.zo)(s,r,i,(0,f.bx)(s.length<<3)),p=new Uint8Array((await crypto.subtle.sign("HMAC",u,d)).slice(0,l>>3));try{a=await ec(n,p)}catch{}if(!a)throw new h.NM;try{o=new Uint8Array(await crypto.subtle.decrypt({iv:r,name:"AES-CBC"},c,i))}catch{}if(!o)throw new h.NM;return o}async function ed(e,t,i,r,n,s){let a;t instanceof Uint8Array?a=await crypto.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(L(t,e,"decrypt"),a=t);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:s,iv:r,name:"AES-GCM",tagLength:128},a,(0,f.zo)(i,n)))}catch{throw new h.NM}}async function eh(e,t,i,r,n,s){if(!m(t)&&!(t instanceof Uint8Array))throw TypeError(x(t,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!r)throw new h.Zw("JWE Initialization Vector missing");if(!n)throw new h.Zw("JWE Authentication Tag missing");switch(O(e,r),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&q(t,parseInt(e.slice(-3),10)),eu(e,t,i,r,n,s);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&q(t,parseInt(e.slice(1,4),10)),ed(e,t,i,r,n,s);default:throw new h.jq("Unsupported JWE Content Encryption Algorithm")}}async function ef(e,t,i,r){let n=e.slice(0,7),s=await B(n,i,t,r,new Uint8Array);return{encryptedKey:s.ciphertext,iv:(0,d.c)(s.iv),tag:(0,d.c)(s.tag)}}async function ep(e,t,i,r,n){return eh(e.slice(0,7),t,i,r,n,new Uint8Array)}async function em(e,t,i,r,n={}){let s,a,o;switch(e){case"dir":o=i;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let l;if(p(i),!W(i))throw new h.jq("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:u}=n;l=n.epk?await ea(n.epk,e):(await crypto.subtle.generateKey(i.algorithm,!0,["deriveBits"])).privateKey;let{x:f,y:m,crv:g,kty:y}=await $(l),b=await z(i,l,"ECDH-ES"===e?t:e,"ECDH-ES"===e?eo(t):parseInt(e.slice(-5,-2),10),c,u);if(a={epk:{x:f,crv:g,kty:y}},"EC"===y&&(a.epk.y=m),c&&(a.apu=(0,d.c)(c)),u&&(a.apv=(0,d.c)(u)),"ECDH-ES"===e){o=b;break}o=r||el(t);let w=e.slice(-6);s=await K(w,b,o);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=r||el(t),p(i),s=await et(e,i,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=r||el(t);let{p2c:l,p2s:c}=n;({encryptedKey:s,...a}=await G(e,i,o,l,c));break}case"A128KW":case"A192KW":case"A256KW":o=r||el(t),s=await K(e,i,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=r||el(t);let{iv:l}=n;({encryptedKey:s,...a}=await ef(e,i,o,l));break}default:throw new h.jq('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:s,parameters:a}}function eg(...e){let t;let i=e.filter(Boolean);if(0===i.length||1===i.length)return!0;for(let e of i){let i=Object.keys(e);if(!t||0===t.size){t=new Set(i);continue}for(let e of i){if(t.has(e))return!1;t.add(e)}}return!0}function ey(e,t,i,r,n){let s;if(void 0!==n.crit&&r?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||void 0===r.crit)return new Set;if(!Array.isArray(r.crit)||0===r.crit.length||r.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(s=void 0!==i?new Map([...Object.entries(i),...t.entries()]):t,r.crit)){if(!s.has(a))throw new h.jq(`Extension Header Parameter "${a}" is not recognized`);if(void 0===n[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(s.get(a)&&void 0===r[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(r.crit)}let eb=e=>e?.[Symbol.toStringTag],ew=(e,t,i)=>{if(void 0!==t.use){let e;switch(i){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let r;switch(!0){case"sign"===i||"verify"===i:case"dir"===e:case e.includes("CBC-HS"):r=i;break;case e.startsWith("PBES2"):r="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):r=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===i?"wrapKey":"unwrapKey":i;break;case"encrypt"===i&&e.startsWith("RSA"):r="wrapKey";break;case"decrypt"===i:r=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(r&&t.key_ops?.includes?.(r)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${r}" when present`)}return!0},ev=(e,t,i)=>{if(!(t instanceof Uint8Array)){if(w(t)){if(_(t)&&ew(e,t,i))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!y(t))throw TypeError(T(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${eb(t)} instances for symmetric algorithms must be of type "secret"`)}},eS=(e,t,i)=>{if(w(t))switch(i){case"decrypt":case"sign":if(v(t)&&ew(e,t,i))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if(S(t)&&ew(e,t,i))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!y(t))throw TypeError(T(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${eb(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(i){case"sign":throw TypeError(`${eb(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${eb(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(i){case"verify":throw TypeError(`${eb(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${eb(t)} instances for asymmetric algorithm encryption must be of type "public"`)}};function e_(e,t,i){switch(e.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":ev(e,t,i);break;default:eS(e,t,i)}}class eA{#e;#t;#i;#r;#n;#s;#a;#o;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#e=e}setKeyManagementParameters(e){if(this.#o)throw TypeError("setKeyManagementParameters can only be called once");return this.#o=e,this}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setSharedUnprotectedHeader(e){if(this.#i)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#i=e,this}setUnprotectedHeader(e){if(this.#r)throw TypeError("setUnprotectedHeader can only be called once");return this.#r=e,this}setAdditionalAuthenticatedData(e){return this.#n=e,this}setContentEncryptionKey(e){if(this.#s)throw TypeError("setContentEncryptionKey can only be called once");return this.#s=e,this}setInitializationVector(e){if(this.#a)throw TypeError("setInitializationVector can only be called once");return this.#a=e,this}async encrypt(e,t){let i,r,n,s,a,o;if(!this.#t&&!this.#r&&!this.#i)throw new h.Zw("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!eg(this.#t,this.#r,this.#i))throw new h.Zw("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let l={...this.#t,...this.#r,...this.#i};if(ey(h.Zw,new Map,t?.crit,this.#t,l),void 0!==l.zip)throw new h.jq('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:c,enc:u}=l;if("string"!=typeof c||!c)throw new h.Zw('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof u||!u)throw new h.Zw('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#s&&("dir"===c||"ECDH-ES"===c))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${c}`);e_("dir"===c?u:c,e,"encrypt");{let n;let s=await ea(e,c);({cek:r,encryptedKey:i,parameters:n}=await em(c,u,s,this.#s,this.#o)),n&&(t&&P in t?this.#r?this.#r={...this.#r,...n}:this.setUnprotectedHeader(n):this.#t?this.#t={...this.#t,...n}:this.setProtectedHeader(n))}if(this.#t?(s=(0,d.c)(JSON.stringify(this.#t)),a=(0,f.cv)(s)):(s="",a=new Uint8Array),this.#n){o=(0,d.c)(this.#n);let e=(0,f.cv)(o);n=(0,f.zo)(a,(0,f.cv)("."),e)}else n=a;let{ciphertext:p,tag:m,iv:g}=await B(u,this.#e,r,this.#a,n),y={ciphertext:(0,d.c)(p)};return g&&(y.iv=(0,d.c)(g)),m&&(y.tag=(0,d.c)(m)),i&&(y.encrypted_key=(0,d.c)(i)),o&&(y.aad=o),this.#t&&(y.protected=s),this.#i&&(y.unprotected=this.#i),this.#r&&(y.header=this.#r),y}}class ex{#l;constructor(e){this.#l=new eA(e)}setContentEncryptionKey(e){return this.#l.setContentEncryptionKey(e),this}setInitializationVector(e){return this.#l.setInitializationVector(e),this}setProtectedHeader(e){return this.#l.setProtectedHeader(e),this}setKeyManagementParameters(e){return this.#l.setKeyManagementParameters(e),this}async encrypt(e,t){let i=await this.#l.encrypt(e,t);return[i.protected,i.encrypted_key,i.iv,i.ciphertext,i.tag].join(".")}}let eT=e=>Math.floor(e.getTime()/1e3),ek=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function e$(e){let t;let i=ek.exec(e);if(!i||i[4]&&i[1])throw TypeError("Invalid time period format");let r=parseFloat(i[2]);switch(i[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*r);break;case"day":case"days":case"d":t=Math.round(86400*r);break;case"week":case"weeks":case"w":t=Math.round(604800*r);break;default:t=Math.round(31557600*r)}return"-"===i[1]||"ago"===i[4]?-t:t}function eE(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let eC=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`,eP=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e)));class eQ{#c;constructor(e){if(!(0,b.K)(e))throw TypeError("JWT Claims Set MUST be an object");this.#c=structuredClone(e)}data(){return f.g7.encode(JSON.stringify(this.#c))}get iss(){return this.#c.iss}set iss(e){this.#c.iss=e}get sub(){return this.#c.sub}set sub(e){this.#c.sub=e}get aud(){return this.#c.aud}set aud(e){this.#c.aud=e}set jti(e){this.#c.jti=e}set nbf(e){"number"==typeof e?this.#c.nbf=eE("setNotBefore",e):e instanceof Date?this.#c.nbf=eE("setNotBefore",eT(e)):this.#c.nbf=eT(new Date)+e$(e)}set exp(e){"number"==typeof e?this.#c.exp=eE("setExpirationTime",e):e instanceof Date?this.#c.exp=eE("setExpirationTime",eT(e)):this.#c.exp=eT(new Date)+e$(e)}set iat(e){void 0===e?this.#c.iat=eT(new Date):e instanceof Date?this.#c.iat=eE("setIssuedAt",eT(e)):"string"==typeof e?this.#c.iat=eE("setIssuedAt",eT(new Date)+e$(e)):this.#c.iat=eE("setIssuedAt",e)}}class eN{#s;#a;#o;#t;#u;#d;#h;#f;constructor(e={}){this.#f=new eQ(e)}setIssuer(e){return this.#f.iss=e,this}setSubject(e){return this.#f.sub=e,this}setAudience(e){return this.#f.aud=e,this}setJti(e){return this.#f.jti=e,this}setNotBefore(e){return this.#f.nbf=e,this}setExpirationTime(e){return this.#f.exp=e,this}setIssuedAt(e){return this.#f.iat=e,this}setProtectedHeader(e){if(this.#t)throw TypeError("setProtectedHeader can only be called once");return this.#t=e,this}setKeyManagementParameters(e){if(this.#o)throw TypeError("setKeyManagementParameters can only be called once");return this.#o=e,this}setContentEncryptionKey(e){if(this.#s)throw TypeError("setContentEncryptionKey can only be called once");return this.#s=e,this}setInitializationVector(e){if(this.#a)throw TypeError("setInitializationVector can only be called once");return this.#a=e,this}replicateIssuerAsHeader(){return this.#u=!0,this}replicateSubjectAsHeader(){return this.#d=!0,this}replicateAudienceAsHeader(){return this.#h=!0,this}async encrypt(e,t){let i=new ex(this.#f.data());return this.#t&&(this.#u||this.#d||this.#h)&&(this.#t={...this.#t,iss:this.#u?this.#f.iss:void 0,sub:this.#d?this.#f.sub:void 0,aud:this.#h?this.#f.aud:void 0}),i.setProtectedHeader(this.#t),this.#a&&i.setInitializationVector(this.#a),this.#s&&i.setContentEncryptionKey(this.#s),this.#o&&i.setKeyManagementParameters(this.#o),i.encrypt(e,t)}}async function eO(e,t,i){let r;if(!(0,b.K)(e))throw TypeError("JWK must be an object");switch(t??=e.alg,r??=i?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,d.J)(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new h.jq('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return er({...e,alg:t,ext:r});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return er({...e,ext:r});case"EC":case"OKP":return er({...e,alg:t,ext:r});default:throw new h.jq('Unsupported "kty" (Key Type) Parameter value')}}async function eq(e,t,i,r,n){switch(e){case"dir":if(void 0!==i)throw new h.Zw("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==i)throw new h.Zw("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,s;if(!(0,b.K)(r.epk))throw new h.Zw('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(p(t),!W(t))throw new h.jq("ECDH with the provided key is not allowed or not supported by your javascript runtime");let a=await eO(r.epk,e);if(p(a),void 0!==r.apu){if("string"!=typeof r.apu)throw new h.Zw('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=(0,d.J)(r.apu)}catch{throw new h.Zw("Failed to base64url decode the apu")}}if(void 0!==r.apv){if("string"!=typeof r.apv)throw new h.Zw('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{s=(0,d.J)(r.apv)}catch{throw new h.Zw("Failed to base64url decode the apv")}}let o=await z(a,t,"ECDH-ES"===e?r.enc:e,"ECDH-ES"===e?eo(r.enc):parseInt(e.slice(-5,-2),10),n,s);if("ECDH-ES"===e)return o;if(void 0===i)throw new h.Zw("JWE Encrypted Key missing");return F(e.slice(-6),o,i)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===i)throw new h.Zw("JWE Encrypted Key missing");return p(t),ei(e,t,i);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let s;if(void 0===i)throw new h.Zw("JWE Encrypted Key missing");if("number"!=typeof r.p2c)throw new h.Zw('JOSE Header "p2c" (PBES2 Count) missing or invalid');let a=n?.maxPBES2Count||1e4;if(r.p2c>a)throw new h.Zw('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof r.p2s)throw new h.Zw('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{s=(0,d.J)(r.p2s)}catch{throw new h.Zw("Failed to base64url decode the p2s")}return Y(e,t,i,r.p2c,s)}case"A128KW":case"A192KW":case"A256KW":if(void 0===i)throw new h.Zw("JWE Encrypted Key missing");return F(e,t,i);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,s;if(void 0===i)throw new h.Zw("JWE Encrypted Key missing");if("string"!=typeof r.iv)throw new h.Zw('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof r.tag)throw new h.Zw('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=(0,d.J)(r.iv)}catch{throw new h.Zw("Failed to base64url decode the iv")}try{s=(0,d.J)(r.tag)}catch{throw new h.Zw("Failed to base64url decode the tag")}return ep(e,t,i,n,s)}default:throw new h.jq('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function eI(e,t){if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)}async function ej(e,t,i){let r,n,s,a,o,l,c;if(!(0,b.K)(e))throw new h.Zw("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new h.Zw("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new h.Zw("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new h.Zw("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new h.Zw("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new h.Zw("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new h.Zw("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new h.Zw("JWE AAD incorrect type");if(void 0!==e.header&&!(0,b.K)(e.header))throw new h.Zw("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!(0,b.K)(e.unprotected))throw new h.Zw("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=(0,d.J)(e.protected);r=JSON.parse(f.xv.decode(t))}catch{throw new h.Zw("JWE Protected Header is invalid")}if(!eg(r,e.header,e.unprotected))throw new h.Zw("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...r,...e.header,...e.unprotected};if(ey(h.Zw,new Map,i?.crit,r,u),void 0!==u.zip)throw new h.jq('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:p,enc:m}=u;if("string"!=typeof p||!p)throw new h.Zw("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new h.Zw("missing JWE Encryption Algorithm (enc) in JWE Header");let g=i&&eI("keyManagementAlgorithms",i.keyManagementAlgorithms),y=i&&eI("contentEncryptionAlgorithms",i.contentEncryptionAlgorithms);if(g&&!g.has(p)||!g&&p.startsWith("PBES2"))throw new h.FP('"alg" (Algorithm) Header Parameter value not allowed');if(y&&!y.has(m))throw new h.FP('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{n=(0,d.J)(e.encrypted_key)}catch{throw new h.Zw("Failed to base64url decode the encrypted_key")}let w=!1;"function"==typeof t&&(t=await t(r,e),w=!0),e_("dir"===p?m:p,t,"decrypt");let v=await ea(t,p);try{s=await eq(p,v,n,u,i)}catch(e){if(e instanceof TypeError||e instanceof h.Zw||e instanceof h.jq)throw e;s=el(m)}if(void 0!==e.iv)try{a=(0,d.J)(e.iv)}catch{throw new h.Zw("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=(0,d.J)(e.tag)}catch{throw new h.Zw("Failed to base64url decode the tag")}let S=void 0!==e.protected?(0,f.cv)(e.protected):new Uint8Array;l=void 0!==e.aad?(0,f.zo)(S,(0,f.cv)("."),(0,f.cv)(e.aad)):S;try{c=(0,d.J)(e.ciphertext)}catch{throw new h.Zw("Failed to base64url decode the ciphertext")}let _={plaintext:await eh(m,s,c,a,o,l)};if(void 0!==e.protected&&(_.protectedHeader=r),void 0!==e.aad)try{_.additionalAuthenticatedData=(0,d.J)(e.aad)}catch{throw new h.Zw("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(_.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(_.unprotectedHeader=e.header),w)?{..._,key:v}:_}async function eL(e,t,i){if(e instanceof Uint8Array&&(e=f.xv.decode(e)),"string"!=typeof e)throw new h.Zw("Compact JWE must be a string or Uint8Array");let{0:r,1:n,2:s,3:a,4:o,length:l}=e.split(".");if(5!==l)throw new h.Zw("Invalid Compact JWE");let c=await ej({ciphertext:a,iv:s||void 0,protected:r,tag:o||void 0,encrypted_key:n||void 0},t,i),u={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...u,key:c.key}:u}async function eU(e,t,i){let r=await eL(e,t,i),n=function(e,t,i={}){let r,n;try{r=JSON.parse(f.xv.decode(t))}catch{}if(!(0,b.K)(r))throw new h.uv("JWT Claims Set must be a top-level JSON object");let{typ:s}=i;if(s&&("string"!=typeof e.typ||eC(e.typ)!==eC(s)))throw new h.YS('unexpected "typ" JWT header value',r,"typ","check_failed");let{requiredClaims:a=[],issuer:o,subject:l,audience:c,maxTokenAge:u}=i,d=[...a];for(let e of(void 0!==u&&d.push("iat"),void 0!==c&&d.push("aud"),void 0!==l&&d.push("sub"),void 0!==o&&d.push("iss"),new Set(d.reverse())))if(!(e in r))throw new h.YS(`missing required "${e}" claim`,r,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(r.iss))throw new h.YS('unexpected "iss" claim value',r,"iss","check_failed");if(l&&r.sub!==l)throw new h.YS('unexpected "sub" claim value',r,"sub","check_failed");if(c&&!eP(r.aud,"string"==typeof c?[c]:c))throw new h.YS('unexpected "aud" claim value',r,"aud","check_failed");switch(typeof i.clockTolerance){case"string":n=e$(i.clockTolerance);break;case"number":n=i.clockTolerance;break;case"undefined":n=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=i,m=eT(p||new Date);if((void 0!==r.iat||u)&&"number"!=typeof r.iat)throw new h.YS('"iat" claim must be a number',r,"iat","invalid");if(void 0!==r.nbf){if("number"!=typeof r.nbf)throw new h.YS('"nbf" claim must be a number',r,"nbf","invalid");if(r.nbf>m+n)throw new h.YS('"nbf" claim timestamp check failed',r,"nbf","check_failed")}if(void 0!==r.exp){if("number"!=typeof r.exp)throw new h.YS('"exp" claim must be a number',r,"exp","invalid");if(r.exp<=m-n)throw new h.fy('"exp" claim timestamp check failed',r,"exp","check_failed")}if(u){let e=m-r.iat;if(e-n>("number"==typeof u?u:e$(u)))throw new h.fy('"iat" claim timestamp check failed (too far in the past)',r,"iat","check_failed");if(e<0-n)throw new h.YS('"iat" claim timestamp check failed (it should be in the past)',r,"iat","check_failed")}return r}(r.protectedHeader,r.plaintext,i),{protectedHeader:s}=r;if(void 0!==s.iss&&s.iss!==n.iss)throw new h.YS('replicated "iss" claim header parameter mismatch',n,"iss","mismatch");if(void 0!==s.sub&&s.sub!==n.sub)throw new h.YS('replicated "sub" claim header parameter mismatch',n,"sub","mismatch");if(void 0!==s.aud&&JSON.stringify(s.aud)!==JSON.stringify(n.aud))throw new h.YS('replicated "aud" claim header parameter mismatch',n,"aud","mismatch");let a={payload:n,protectedHeader:s};return"function"==typeof t?{...a,key:r.key}:a}var eD=i(2104),eB=i(62391);let{parse:eR}=i(83213),eM=()=>Date.now()/1e3|0,eK="A256CBC-HS512";async function eF(e){let{token:t={},secret:i,maxAge:r=2592e3,salt:n}=e,s=Array.isArray(i)?i:[i],a=await ez(eK,s[0],n),o=await C({kty:"oct",k:d.c(a)},`sha${a.byteLength<<3}`);return await new eN(t).setProtectedHeader({alg:"dir",enc:eK,kid:o}).setIssuedAt().setExpirationTime(eM()+r).setJti(crypto.randomUUID()).encrypt(a)}async function eJ(e){let{token:t,secret:i,salt:r}=e,n=Array.isArray(i)?i:[i];if(!t)return null;let{payload:s}=await eU(t,async({kid:e,enc:t})=>{for(let i of n){let n=await ez(t,i,r);if(void 0===e||e===await C({kty:"oct",k:d.c(n)},`sha${n.byteLength<<3}`))return n}throw Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:["dir"],contentEncryptionAlgorithms:[eK,"A256GCM"]});return s}async function eH(e){let{secureCookie:t,cookieName:i=(0,eD.x)(t??!1).sessionToken.name,decode:r=eJ,salt:n=i,secret:s,logger:a=console,raw:o,req:l}=e;if(!l)throw Error("Must pass `req` to JWT getToken()");let c=l.headers instanceof Headers?l.headers:new Headers(l.headers),u=new eD.p({name:i,options:{secure:t}},eR(c.get("cookie")??""),a).value,d=c.get("authorization");if(u||d?.split(" ")[0]!=="Bearer"||(u=decodeURIComponent(d.split(" ")[1])),!u)return null;if(o)return u;if(!s)throw new eB.yv("Must pass `secret` if not set to JWT getToken()");try{return await r({token:u,secret:s,salt:n})}catch{return null}}async function ez(e,t,i){let r;switch(e){case"A256CBC-HS512":r=64;break;case"A256GCM":r=32;break;default:throw Error("Unsupported JWT Content Encryption Algorithm")}return await c("sha256",t,i,`Auth.js Generated Encryption Key (${i})`,r)}},2104:(e,t,i)=>{i.d(t,{p:()=>h,x:()=>d});var r,n,s,a,o,l,c=function(e,t,i,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,i):n?n.value=i:t.set(e,i),i},u=function(e,t,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)};function d(e){let t=e?"__Secure-":"";return{sessionToken:{name:`${t}authjs.session-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},callbackUrl:{name:`${t}authjs.callback-url`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},csrfToken:{name:`${e?"__Host-":""}authjs.csrf-token`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},pkceCodeVerifier:{name:`${t}authjs.pkce.code_verifier`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}},state:{name:`${t}authjs.state`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}},nonce:{name:`${t}authjs.nonce`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e}},webauthnChallenge:{name:`${t}authjs.challenge`,options:{httpOnly:!0,sameSite:"lax",path:"/",secure:e,maxAge:900}}}}class h{constructor(e,t,i){if(r.add(this),n.set(this,{}),s.set(this,void 0),a.set(this,void 0),c(this,a,i,"f"),c(this,s,e,"f"),!t)return;let{name:o}=e;for(let[e,i]of Object.entries(t))e.startsWith(o)&&i&&(u(this,n,"f")[e]=i)}get value(){return Object.keys(u(this,n,"f")).sort((e,t)=>parseInt(e.split(".").pop()||"0")-parseInt(t.split(".").pop()||"0")).map(e=>u(this,n,"f")[e]).join("")}chunk(e,t){let i=u(this,r,"m",l).call(this);for(let n of u(this,r,"m",o).call(this,{name:u(this,s,"f").name,value:e,options:{...u(this,s,"f").options,...t}}))i[n.name]=n;return Object.values(i)}clean(){return Object.values(u(this,r,"m",l).call(this))}}n=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakSet,o=function(e){let t=Math.ceil(e.value.length/3936);if(1===t)return u(this,n,"f")[e.name]=e.value,[e];let i=[];for(let r=0;r<t;r++){let t=`${e.name}.${r}`,s=e.value.substr(3936*r,3936);i.push({...e,name:t,value:s}),u(this,n,"f")[t]=s}return u(this,a,"f").debug("CHUNKING_SESSION_COOKIE",{message:"Session cookie exceeds allowed 4096 bytes.",emptyCookieSize:160,valueSize:e.value.length,chunks:i.map(e=>e.value.length+160)}),i},l=function(){let e={};for(let t in u(this,n,"f"))delete u(this,n,"f")?.[t],e[t]={name:t,value:"",options:{...u(this,s,"f").options,maxAge:0}};return e}},83213:(e,t,i)=>{i.d(t,{parse:()=>c,serialize:()=>h});let r=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,n=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,s=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,a=/^[\u0020-\u003A\u003D-\u007E]*$/,o=Object.prototype.toString,l=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function c(e,t){let i=new l,r=e.length;if(r<2)return i;let n=t?.decode||f,s=0;do{let t=e.indexOf("=",s);if(-1===t)break;let a=e.indexOf(";",s),o=-1===a?r:a;if(t>o){s=e.lastIndexOf(";",t-1)+1;continue}let l=u(e,s,t),c=d(e,t,l),h=e.slice(l,c);if(void 0===i[h]){let r=u(e,t+1,o),s=d(e,o,r),a=n(e.slice(r,s));i[h]=a}s=o+1}while(s<r);return i}function u(e,t,i){do{let i=e.charCodeAt(t);if(32!==i&&9!==i)return t}while(++t<i);return i}function d(e,t,i){for(;t>i;){let i=e.charCodeAt(--t);if(32!==i&&9!==i)return t+1}return i}function h(e,t,i){let l=i?.encode||encodeURIComponent;if(!r.test(e))throw TypeError(`argument name is invalid: ${e}`);let c=l(t);if(!n.test(c))throw TypeError(`argument val is invalid: ${t}`);let u=e+"="+c;if(!i)return u;if(void 0!==i.maxAge){if(!Number.isInteger(i.maxAge))throw TypeError(`option maxAge is invalid: ${i.maxAge}`);u+="; Max-Age="+i.maxAge}if(i.domain){if(!s.test(i.domain))throw TypeError(`option domain is invalid: ${i.domain}`);u+="; Domain="+i.domain}if(i.path){if(!a.test(i.path))throw TypeError(`option path is invalid: ${i.path}`);u+="; Path="+i.path}if(i.expires){var d;if(d=i.expires,"[object Date]"!==o.call(d)||!Number.isFinite(i.expires.valueOf()))throw TypeError(`option expires is invalid: ${i.expires}`);u+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(u+="; HttpOnly"),i.secure&&(u+="; Secure"),i.partitioned&&(u+="; Partitioned"),i.priority)switch("string"==typeof i.priority?i.priority.toLowerCase():void 0){case"low":u+="; Priority=Low";break;case"medium":u+="; Priority=Medium";break;case"high":u+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${i.priority}`)}if(i.sameSite)switch("string"==typeof i.sameSite?i.sameSite.toLowerCase():i.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${i.sameSite}`)}return u}function f(e){if(-1===e.indexOf("%"))return e;try{return decodeURIComponent(e)}catch(t){return e}}},3110:(e,t,i)=>{i.d(t,{Z:()=>r});function r(e){return{id:"resend",type:"email",name:"Resend",from:"Auth.js <no-reply@authjs.dev>",maxAge:86400,async sendVerificationRequest(e){let{identifier:t,provider:i,url:r,theme:n}=e,{host:s}=new URL(r),a=await fetch("https://api.resend.com/emails",{method:"POST",headers:{Authorization:`Bearer ${i.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({from:i.from,to:t,subject:`Sign in to ${s}`,html:function(e){let{url:t,host:i,theme:r}=e,n=i.replace(/\./g,"&#8203;."),s=r.brandColor||"#346df1",a=r.buttonText||"#fff",o="#444";return`
<body style="background: #f9f9f9;">
  <table width="100%" border="0" cellspacing="20" cellpadding="0"
    style="background: #fff; max-width: 600px; margin: auto; border-radius: 10px;">
    <tr>
      <td align="center"
        style="padding: 10px 0px; font-size: 22px; font-family: Helvetica, Arial, sans-serif; color: ${o};">
        Sign in to <strong>${n}</strong>
      </td>
    </tr>
    <tr>
      <td align="center" style="padding: 20px 0;">
        <table border="0" cellspacing="0" cellpadding="0">
          <tr>
            <td align="center" style="border-radius: 5px;" bgcolor="${s}"><a href="${t}"
                target="_blank"
                style="font-size: 18px; font-family: Helvetica, Arial, sans-serif; color: ${a}; text-decoration: none; border-radius: 5px; padding: 10px 20px; border: 1px solid ${s}; display: inline-block; font-weight: bold;">Sign
                in</a></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td align="center"
        style="padding: 0px 0px 10px 0px; font-size: 16px; line-height: 22px; font-family: Helvetica, Arial, sans-serif; color: ${o};">
        If you did not request this email you can safely ignore it.
      </td>
    </tr>
  </table>
</body>
`}({url:r,host:s,theme:n}),text:function({url:e,host:t}){return`Sign in to ${t}
${e}

`}({url:r,host:s})})});if(!a.ok)throw Error("Resend error: "+JSON.stringify(await a.json()))},options:e}}},48937:(e,t,i)=>{i.d(t,{Z:()=>ev});var r=i(19801),n=i(92048);let s=new Map,a=new Map,o=Symbol("OriginError"),l={};class c extends Promise{constructor(e,t,i,r,n={}){let a,l;super((e,t)=>{a=e,l=t}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=i,this.canceller=r,this.options=n,this.state=null,this.statement=null,this.resolve=e=>(this.active=!1,a(e)),this.reject=e=>(this.active=!1,l(e)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[o]=this.handler.debug?Error():this.tagged&&function(e){if(s.has(e))return s.get(e);let t=Error.stackTraceLimit;return Error.stackTraceLimit=4,s.set(e,Error()),Error.stackTraceLimit=t,s.get(e)}(this.strings)}get origin(){return(this.handler.debug?this[o].stack:this.tagged&&a.has(this.strings)?a.get(this.strings):a.set(this.strings,this[o].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){let i;return(this.options.simple=!1,"function"==typeof e&&(t=e,e=1),this.cursorRows=e,"function"==typeof t)?(this.cursorFn=t,this):{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};i&&i();let e=new Promise((e,t)=>{this.cursorFn=t=>(e({value:t,done:!1}),new Promise(e=>i=e)),this.resolve=()=>(this.active=!1,e({done:!0})),this.reject=e=>(this.active=!1,t(e))});return this.execute(),e},return:()=>(i&&i(l),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class u extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}}let d={connection:function e(t,i,r){let{host:n,port:s}=r||i,a=Object.assign(Error("write "+t+" "+(i.path||n+":"+s)),{code:t,errno:t,address:i.path||n},i.path?{}:{port:s});return Error.captureStackTrace(a,e),a},postgres:function e(t){let i=new u(t);return Error.captureStackTrace(i,e),i},generic:function e(t,i){let r=Object.assign(Error(t+": "+i),{code:t});return Error.captureStackTrace(r,e),r},notSupported:function e(t){let i=Object.assign(Error(t+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:t});return Error.captureStackTrace(i,e),i}};class h{then(){T()}catch(){T()}finally(){T()}}class f extends h{constructor(e){super(),this.value=Q(e)}}class p extends h{constructor(e,t,i){super(),this.value=e,this.type=t,this.array=i}}class m extends h{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,i,r){let n=x.map(([t,i])=>({fn:i,i:e.search(t)})).sort((e,t)=>e.i-t.i).pop();return -1===n.i?P(this.first,r):n.fn(this.first,this.rest,t,i,r)}}function g(e,t,i,r){let n=e instanceof p?e.value:e;if(void 0===n&&(e instanceof p?e.value=r.transform.undefined:n=e=r.transform.undefined,void 0===n))throw d.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+i.push(e instanceof p?(t.push(e.value),e.array?e.array[e.type||N(e.value)]||e.type||function e(t){return Array.isArray(t)?e(t[0]):"string"==typeof t?1009:0}(e.value):e.type):(t.push(e),N(e)))}let y=C({string:{to:25,from:null,serialize:e=>""+e},number:{to:0,from:[21,23,26,700,701],serialize:e=>""+e,parse:e=>+e},json:{to:114,from:[114,3802],serialize:e=>JSON.stringify(e),parse:e=>JSON.parse(e)},boolean:{to:16,from:16,serialize:e=>!0===e?"t":"f",parse:e=>"t"===e},date:{to:1184,from:[1082,1114,1184],serialize:e=>(e instanceof Date?e:new Date(e)).toISOString(),parse:e=>new Date(e)},bytea:{to:17,from:17,serialize:e=>"\\x"+Buffer.from(e).toString("hex"),parse:e=>Buffer.from(e.slice(2),"hex")}});function b(e,t,i,r,n,s){for(let a=1;a<e.strings.length;a++)t+=w(t,i,r,n,s)+e.strings[a],i=e.args[a];return t}function w(e,t,i,r,n){return t instanceof m?t.build(e,i,r,n):t instanceof c?v(t,i,r,n):t instanceof f?t.value:t&&t[0]instanceof c?t.reduce((e,t)=>e+" "+v(t,i,r,n),""):g(t,i,r,n)}function v(e,t,i,r){return e.fragment=!0,b(e,e.strings[0],e.args[0],t,i,r)}function S(e,t,i,r,n){return e.map(e=>"("+r.map(r=>w("values",e[r],t,i,n)).join(",")+")").join(",")}function _(e,t,i,r,n){let s=Array.isArray(e[0]),a=t.length?t.flat():Object.keys(s?e[0]:e);return S(s?e:[e],i,r,a,n)}function A(e,t,i,r,n){let s;return("string"==typeof e&&(e=[e].concat(t)),Array.isArray(e))?P(e,n):(t.length?t.flat():Object.keys(e)).map(t=>((s=e[t])instanceof c?v(s,i,r,n):s instanceof f?s.value:g(s,i,r,n))+" as "+Q(n.transform.column.to?n.transform.column.to(t):t)).join(",")}let x=Object.entries({values:_,in:(...e)=>{let t=_(...e);return"()"===t?"(null)":t},select:A,as:A,returning:A,"\\(":A,update:(e,t,i,r,n)=>(t.length?t.flat():Object.keys(e)).map(t=>Q(n.transform.column.to?n.transform.column.to(t):t)+"="+w("values",e[t],i,r,n)),insert(e,t,i,r,n){let s=t.length?t.flat():Object.keys(Array.isArray(e)?e[0]:e);return"("+P(s,n)+")values"+S(Array.isArray(e)?e:[e],i,r,s,n)}}).map(([e,t])=>[RegExp("((?:^|[\\s(])"+e+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),t]);function T(){throw d.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}let k=y.serializers,$=y.parsers,E=function(e){let t=C(e||{});return{serializers:Object.assign({},k,t.serializers),parsers:Object.assign({},$,t.parsers)}};function C(e){return Object.keys(e).reduce((t,i)=>(e[i].from&&[].concat(e[i].from).forEach(r=>t.parsers[r]=e[i].parse),e[i].serialize&&(t.serializers[e[i].to]=e[i].serialize,e[i].from&&[].concat(e[i].from).forEach(r=>t.serializers[r]=e[i].serialize)),t),{parsers:{},serializers:{}})}function P(e,{transform:{column:t}}){return e.map(e=>Q(t.to?t.to(e):e)).join(",")}let Q=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},N=function e(t){return t instanceof p?t.type:t instanceof Date?1184:t instanceof Uint8Array?17:!0===t||!1===t?16:"bigint"==typeof t?20:Array.isArray(t)?e(t[0]):0},O=/\\/g,q=/"/g,I=function e(t,i,r,n){if(!1===Array.isArray(t))return t;if(!t.length)return"{}";let s=t[0],a=1020===n?";":",";return Array.isArray(s)&&!s.type?"{"+t.map(t=>e(t,i,r,n)).join(a)+"}":"{"+t.map(e=>{if(void 0===e&&void 0===(e=r.transform.undefined))throw d.generic("UNDEFINED_VALUE","Undefined values are not allowed");return null===e?"null":'"'+(i?i(e.type?e.value:e):""+e).replace(O,"\\\\").replace(q,'\\"')+'"'}).join(a)+"}"},j={i:0,char:null,str:"",quoted:!1,last:0},L=e=>{let t=e[0];for(let i=1;i<e.length;i++)t+="_"===e[i]?e[++i].toUpperCase():e[i];return t},U=e=>{let t=e[0].toUpperCase();for(let i=1;i<e.length;i++)t+="_"===e[i]?e[++i].toUpperCase():e[i];return t},D=e=>e.replace(/_/g,"-"),B=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),R=e=>(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),M=e=>e.replace(/-/g,"_");function K(e){return function t(i,r){return"object"==typeof i&&null!==i&&(114===r.type||3802===r.type)?Array.isArray(i)?i.map(e=>t(e,r)):Object.entries(i).reduce((i,[n,s])=>Object.assign(i,{[e(n)]:t(s,r)}),{}):i}}L.column={from:L},L.value={from:K(L)},B.column={to:B};let F={...L};F.column.to=B,U.column={from:U},U.value={from:K(U)},R.column={to:R};let J={...U};J.column.to=R,D.column={from:D},D.value={from:K(D)},M.column={to:M};let H={...D};H.column.to=M;var z=i(98216),W=i(82452),V=i(84770),Z=i(76162),G=i(96119);class Y extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}let X=function(e=[]){let t=e.slice(),i=0;return{get length(){return t.length-i},remove:e=>{let i=t.indexOf(e);return -1===i?null:(t.splice(i,1),e)},push:e=>(t.push(e),e),shift:()=>{let e=t[i++];return i===t.length?(i=0,t=[]):t[i-1]=void 0,e}}},ee=Buffer.allocUnsafe(256),et=Object.assign(function(){return et.i=0,et},"BCcDdEFfHPpQSX".split("").reduce((e,t)=>{let i=t.charCodeAt(0);return e[t]=()=>(ee[0]=i,et.i=5,et),e},{}),{N:"\0",i:0,inc:e=>(et.i+=e,et),str(e){let t=Buffer.byteLength(e);return ei(t),et.i+=ee.write(e,et.i,t,"utf8"),et},i16:e=>(ei(2),ee.writeUInt16BE(e,et.i),et.i+=2,et),i32:(e,t)=>(t||0===t?ee.writeUInt32BE(e,t):(ei(4),ee.writeUInt32BE(e,et.i),et.i+=4),et),z:e=>(ei(e),ee.fill(0,et.i,et.i+e),et.i+=e,et),raw:e=>(ee=Buffer.concat([ee.subarray(0,et.i),e]),et.i=ee.length,et),end(e=1){ee.writeUInt32BE(et.i-e,e);let t=ee.subarray(0,et.i);return et.i=0,ee=Buffer.allocUnsafe(256),t}});function ei(e){if(ee.length-et.i<e){let t=ee,i=t.length;ee=Buffer.allocUnsafe(i+(i>>1)+e),t.copy(ee)}}let er=function e(t,i={},{onopen:r=eu,onend:n=eu,onclose:s=eu}={}){let{ssl:a,max:o,user:u,host:h,port:f,database:p,parsers:m,transform:y,onnotice:w,onnotify:v,onparameter:S,max_pipeline:_,keep_alive:A,backoff:x,target_session_attrs:T}=t,k=X(),$=en++,E={pid:null,secret:null},C=eg(eH,t.idle_timeout),P=eg(eH,t.max_lifetime),Q=eg(function(){eF(d.connection("CONNECT_TIMEOUT",t,N)),N.destroy()},t.connect_timeout),N=null,O,q=new Y,L=Buffer.alloc(0),U=t.fetch_types,D={},B={},R=Math.random().toString(36).slice(2),M=1,K=0,F=0,J=0,H=0,ee=0,ei=0,er=0,eh=null,ey=null,eb=!1,ew=null,ev=null,eS=null,e_=null,eA=null,ex=null,eT=null,ek=null,e$=null,eE=null,eC={queue:i.closed,idleTimer:C,connect(e){eS=e,eR()},terminate:ez,execute:eN,cancel:eQ,end:eH,count:0,id:$};return i.closed&&i.closed.push(eC),eC;async function eP(){let e;try{e=t.socket?await Promise.resolve(t.socket(t)):new z.Socket}catch(e){eK(e);return}return e.on("error",eK),e.on("close",eW),e.on("drain",eU),e}async function eQ({pid:e,secret:t},i,r){try{O=et().i32(16).i32(80877102).i32(e).i32(t).end(16),await eB(),N.once("error",r),N.once("close",i)}catch(e){r(e)}}function eN(e){if(eb)return eJ(e,d.connection("CONNECTION_DESTROYED",t));if(!e.cancelled)try{return e.state=E,e$?k.push(e):(e$=e).active=!0,function(e){let i=[],r=[],n=b(e,e.strings[0],e.args[0],i,r,t);e.tagged||e.args.forEach(e=>g(e,i,r,t)),e.prepare=t.prepare&&(!("prepare"in e.options)||e.options.prepare),e.string=n,e.signature=e.prepare&&r+n,e.onlyDescribe&&delete B[e.signature],e.parameters=e.parameters||i,e.prepared=e.prepare&&e.signature in B,e.describeFirst=e.onlyDescribe||i.length&&!e.prepared,e.statement=e.prepared?B[e.signature]:{string:n,types:r,name:e.prepare?R+M++:""},"function"==typeof t.debug&&t.debug($,n,i,r)}(e),eI(function(e){if(e.parameters.length>=65534)throw d.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return e.options.simple?et().Q().str(e.statement.string+et.N).end():e.describeFirst?Buffer.concat([eO(e),ea]):e.prepare?e.prepared?eq(e):Buffer.concat([eO(e),eq(e)]):Buffer.concat([e5(e.statement.string,e.parameters,e.statement.types),ec,eq(e)])}(e))&&!e.describeFirst&&!e.cursorFn&&k.length<_&&(!e.options.onexecute||e.options.onexecute(eC))}catch(e){return 0===k.length&&eI(es),eF(e),!0}}function eO(e){return Buffer.concat([e5(e.statement.string,e.parameters,e.statement.types,e.statement.name),function(e,t=""){return et().D().str("S").str(t+et.N).end()}(0,e.statement.name)])}function eq(e){return Buffer.concat([function(e,i,r="",n=""){let s,a;return et().B().str(n+et.N).str(r+et.N).i16(0).i16(e.length),e.forEach((r,n)=>{if(null===r)return et.i32(4294967295);a=i[n],e[n]=r=a in t.serializers?t.serializers[a](r):""+r,s=et.i,et.inc(4).str(r).i32(et.i-s-4,s)}),et.i16(0),et.end()}(e.parameters,e.statement.types,e.statement.name,e.cursorName),e.cursorFn?e8("",e.cursorRows):el])}function eI(e,t){return(ex=ex?Buffer.concat([ex,e]):Buffer.from(e),t||ex.length>=1024)?ej(t):(null===ey&&(ey=setImmediate(ej)),!0)}function ej(e){let t=N.write(ex,e);return null!==ey&&clearImmediate(ey),ex=ey=null,t}async function eL(){if(eI(eo),!await new Promise(e=>N.once("data",t=>e(83===t[0])))&&"prefer"===a)return eM();N.removeAllListeners(),(N=W.connect({socket:N,servername:z.isIP(N.host)?void 0:N.host,..."require"===a||"allow"===a||"prefer"===a?{rejectUnauthorized:!1}:"verify-full"===a?{}:"object"==typeof a?a:{}})).on("secureConnect",eM),N.on("error",eK),N.on("close",eW),N.on("drain",eU)}function eU(){e$||r(eC)}function eD(i){if(!ew||(ew.push(i),!((F-=i.length)>0)))for(L=ew?Buffer.concat(ew,ee-F):0===L.length?i:Buffer.concat([L,i],L.length+i.length);L.length>4;){if((ee=L.readUInt32BE(1))>=L.length){F=ee-L.length,ew=[L];break}try{(function(i,n=i[0]){(68===n?function(e){let t,i,r,n=7,s=e$.isRaw?Array(e$.statement.columns.length):{};for(let a=0;a<e$.statement.columns.length;a++)i=e$.statement.columns[a],t=e.readInt32BE(n),n+=4,r=-1===t?null:!0===e$.isRaw?e.subarray(n,n+=t):void 0===i.parser?e.toString("utf8",n,n+=t):!0===i.parser.array?i.parser(e.toString("utf8",n+1,n+=t)):i.parser(e.toString("utf8",n,n+=t)),e$.isRaw?s[a]=!0===e$.isRaw?r:y.value.from?y.value.from(r,i):r:s[i.name]=y.value.from?y.value.from(r,i):r;e$.forEachFn?e$.forEachFn(y.row.from?y.row.from(s):s,q):q[er++]=y.row.from?y.row.from(s):s}:100===n?function(e){eA&&(eA.push(e.subarray(5))||N.pause())}:65===n?function(e){if(!v)return;let t=9;for(;0!==e[t++];);v(e.toString("utf8",9,t-1),e.toString("utf8",t,e.length-1))}:83===n?function(e){let[i,r]=e.toString("utf8",5,e.length-1).split(et.N);D[i]=r,t.parameters[i]!==r&&(t.parameters[i]=r,S&&S(i,r))}:90===n?function(i){if(e$&&e$.options.simple&&e$.resolve(ev||q),e$=ev=null,q=new Y,Q.cancel(),eS){if(T){var n;if(!D.in_hot_standby||!D.default_transaction_read_only)return function(){let e=new c([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],eN,null,{simple:!0});e.resolve=([[e],[t]])=>{D.default_transaction_read_only=e.transaction_read_only,D.in_hot_standby=t.pg_is_in_recovery?"on":"off"},e.execute()}();if(n=D,"read-write"===T&&"on"===n.default_transaction_read_only||"read-only"===T&&"off"===n.default_transaction_read_only||"primary"===T&&"on"===n.in_hot_standby||"standby"===T&&"off"===n.in_hot_standby||"prefer-standby"===T&&"off"===n.in_hot_standby&&t.host[H])return ez()}return U?(eS.reserve&&(eS=null),e6()):(eS&&!eS.reserve&&eN(eS),t.shared.retries=H=0,void(eS=null))}for(;k.length&&(e$=k.shift())&&(e$.active=!0,e$.cancelled);)e(t).cancel(e$.state,e$.cancelled.resolve,e$.cancelled.reject);e$||(eC.reserved?eC.reserved.release||73!==i[5]?eC.reserved():e_?ez():(eC.reserved=null,r(eC)):e_?ez():r(eC))}:67===n?function(e){er=0;for(let t=e.length-1;t>0;t--)if(32===e[t]&&e[t+1]<58&&null===q.count&&(q.count=+e.toString("utf8",t+1,e.length-1)),e[t-1]>=65){q.command=e.toString("utf8",5,t),q.state=E;break}return(eE&&(eE(),eE=null),"BEGIN"!==q.command||1===o||eC.reserved)?e$.options.simple?eV():void(e$.cursorFn&&(q.count&&e$.cursorFn(q),eI(es)),e$.resolve(q)):eF(d.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}:50===n?eV:49===n?function(){e$.parsing=!1}:116===n?function(e){let t=e.readUInt16BE(5);for(let i=0;i<t;++i)e$.statement.types[i]||(e$.statement.types[i]=e.readUInt32BE(7+4*i));e$.prepare&&(B[e$.signature]=e$.statement),e$.describeFirst&&!e$.onlyDescribe&&(eI(eq(e$)),e$.describeFirst=!1)}:84===n?function(e){let t;q.command&&((ev=ev||[q]).push(q=new Y),q.count=null,e$.statement.columns=null);let i=e.readUInt16BE(5),r=7;e$.statement.columns=Array(i);for(let n=0;n<i;++n){for(t=r;0!==e[r++];);let i=e.readUInt32BE(r),s=e.readUInt16BE(r+4),a=e.readUInt32BE(r+6);e$.statement.columns[n]={name:y.column.from?y.column.from(e.toString("utf8",t,r-1)):e.toString("utf8",t,r-1),parser:m[a],table:i,number:s,type:a},r+=18}if(q.statement=e$.statement,e$.onlyDescribe)return e$.resolve(e$.statement),eI(es)}:82===n?eZ:110===n?function(){if(q.statement=e$.statement,q.statement.columns=[],e$.onlyDescribe)return e$.resolve(e$.statement),eI(es)}:75===n?function(e){E.pid=e.readUInt32BE(5),E.secret=e.readUInt32BE(9)}:69===n?function(e){var t;e$&&(e$.cursorFn||e$.describeFirst)&&eI(es);let i=d.postgres(ef(e));e$&&e$.retried?eF(e$.retried):e$&&e$.prepared&&ed.has(i.routine)?(t=e$,delete B[t.signature],t.retried=i,eN(t)):eF(i)}:115===n?e2:51===n?function(){q.count&&e$.cursorFn(q),e$.resolve(q)}:71===n?function(){eA=new Z.Writable({autoDestroy:!0,write(e,t,i){N.write(et().d().raw(e).end(),i)},destroy(e,t){t(e),N.write(et().f().str(e+et.N).end()),eA=null},final(e){N.write(et().c().end()),eE=e}}),e$.resolve(eA)}:78===n?function(e){w?w(ef(e)):console.log(ef(e))}:72===n?function(){eA=new Z.Readable({read(){N.resume()}}),e$.resolve(eA)}:99===n?function(){eA&&eA.push(null),eA=null}:73===n?function(){}:86===n?function(){eF(d.notSupported("FunctionCallResponse"))}:118===n?function(){eF(d.notSupported("NegotiateProtocolVersion"))}:87===n?function(){eA=new Z.Duplex({autoDestroy:!0,read(){N.resume()},write(e,t,i){N.write(et().d().raw(e).end(),i)},destroy(e,t){t(e),N.write(et().f().str(e+et.N).end()),eA=null},final(e){N.write(et().c().end()),eE=e}}),e$.resolve(eA)}:function(e){console.error("Postgres.js : Unknown Message:",e[0])})(i)})(L.subarray(0,ee+1))}catch(e){e$&&(e$.cursorFn||e$.describeFirst)&&eI(es),eF(e)}L=L.subarray(ee+1),F=0,ew=null}}async function eB(){if(eb=!1,D={},N||(N=await eP()),N){if(Q.start(),t.socket)return a?eL():eM();if(N.on("connect",a?eL:eM),t.path)return N.connect(t.path);N.ssl=a,N.connect(f[J],h[J]),N.host=h[J],N.port=f[J],J=(J+1)%f.length}}function eR(){setTimeout(eB,K?K+ei-G.performance.now():0)}function eM(){try{B={},U=t.fetch_types,R=Math.random().toString(36).slice(2),M=1,P.start(),N.on("data",eD),A&&N.setKeepAlive&&N.setKeepAlive(!0,1e3*A);let e=O||et().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:u,database:p,client_encoding:"UTF8"},t.connection)).filter(([,e])=>e).map(([e,t])=>e+et.N+t).join(et.N)).z(2).end(0);eI(e)}catch(e){eK(e)}}function eK(e){if(eC.queue!==i.connecting||!t.host[H+1])for(eF(e);k.length;)eJ(k.shift(),e)}function eF(e){eA&&(eA.destroy(e),eA=null),e$&&eJ(e$,e),eS&&(eJ(eS,e),eS=null)}function eJ(e,i){if(e.reserve)return e.reject(i);i&&"object"==typeof i||(i=Error(i)),"query"in i||"parameters"in i||Object.defineProperties(i,{stack:{value:i.stack+e.origin.replace(/.*\n/,"\n"),enumerable:t.debug},query:{value:e.string,enumerable:t.debug},parameters:{value:e.parameters,enumerable:t.debug},args:{value:e.args,enumerable:t.debug},types:{value:e.statement&&e.statement.types,enumerable:t.debug}}),e.reject(i)}function eH(){return e_||(eC.reserved||n(eC),eC.reserved||eS||e$||0!==k.length?e_=new Promise(e=>eT=e):(ez(),new Promise(e=>N&&"closed"!==N.readyState?N.once("close",e):e())))}function ez(){eb=!0,(eA||e$||eS||k.length)&&eK(d.connection("CONNECTION_DESTROYED",t)),clearImmediate(ey),N&&(N.removeListener("data",eD),N.removeListener("connect",eM),"open"===N.readyState&&N.end(et().X().end())),eT&&(eT(),e_=eT=null)}async function eW(e){if(L=Buffer.alloc(0),F=0,ew=null,clearImmediate(ey),N.removeListener("data",eD),N.removeListener("connect",eM),C.cancel(),P.cancel(),Q.cancel(),N.removeAllListeners(),N=null,eS)return eR();!e&&(e$||k.length)&&eK(d.connection("CONNECTION_CLOSED",t,N)),K=G.performance.now(),e&&t.shared.retries++,ei=("function"==typeof x?x(t.shared.retries):x)*1e3,s(eC,d.connection("CONNECTION_CLOSED",t,N))}function eV(){q.statement||(q.statement=e$.statement),q.columns=e$.statement.columns}async function eZ(e,t=e.readUInt32BE(5)){(3===t?eG:5===t?eY:10===t?eX:11===t?e0:12===t?function(e){e.toString("utf8",9).split(et.N,1)[0].slice(2)!==eh&&(eF(d.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),N.destroy())}:0!==t?function(e,t){console.error("Postgres.js : Unknown Auth:",t)}:eu)(e,t)}async function eG(){let e=await e1();eI(et().p().str(e).z(1).end())}async function eY(e){let t="md5"+await ep(Buffer.concat([Buffer.from(await ep(await e1()+u)),e.subarray(9)]));eI(et().p().str(t).z(1).end())}async function eX(){ek=(await V.randomBytes(18)).toString("base64"),et().p().str("SCRAM-SHA-256"+et.N);let e=et.i;eI(et.inc(4).str("n,,n=*,r="+ek).i32(et.i-e-4,e).end())}async function e0(e){let t=e.toString("utf8",9).split(",").reduce((e,t)=>(e[t[0]]=t.slice(2),e),{}),i=await V.pbkdf2Sync(await e1(),Buffer.from(t.s,"base64"),parseInt(t.i),32,"sha256"),r=await em(i,"Client Key"),n="n=*,r="+ek+",r="+t.r+",s="+t.s+",i="+t.i+",c=biws,r="+t.r;eh=(await em(await em(i,"Server Key"),n)).toString("base64");let s="c=biws,r="+t.r+",p="+(function(e,t){let i=Math.max(e.length,t.length),r=Buffer.allocUnsafe(i);for(let n=0;n<i;n++)r[n]=e[n]^t[n];return r})(r,Buffer.from(await em(await V.createHash("sha256").update(r).digest(),n))).toString("base64");eI(et().p().str(s).end())}function e1(){return Promise.resolve("function"==typeof t.pass?t.pass():t.pass)}async function e6(){U=!1,(await new c([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],eN)).forEach(({oid:e,typarray:i})=>(function(e,i){if(t.parsers[i]&&t.serializers[i])return;let r=t.parsers[e];t.shared.typeArrayMap[e]=i,t.parsers[i]=e=>(j.i=j.last=0,function e(t,i,r,n){let s=[],a=1020===n?";":",";for(;t.i<i.length;t.i++){if(t.char=i[t.i],t.quoted)"\\"===t.char?t.str+=i[++t.i]:'"'===t.char?(s.push(r?r(t.str):t.str),t.str="",t.quoted='"'===i[t.i+1],t.last=t.i+2):t.str+=t.char;else if('"'===t.char)t.quoted=!0;else if("{"===t.char)t.last=++t.i,s.push(e(t,i,r,n));else if("}"===t.char){t.quoted=!1,t.last<t.i&&s.push(r?r(i.slice(t.last,t.i)):i.slice(t.last,t.i)),t.last=t.i+1;break}else t.char===a&&"}"!==t.p&&'"'!==t.p&&(s.push(r?r(i.slice(t.last,t.i)):i.slice(t.last,t.i)),t.last=t.i+1);t.p=t.char}return t.last<t.i&&s.push(r?r(i.slice(t.last,t.i+1)):i.slice(t.last,t.i+1)),s}(j,e,r,i)),t.parsers[i].array=!0,t.serializers[i]=r=>I(r,t.serializers[e],t,i)})(e,i))}async function e2(){try{let e=await Promise.resolve(e$.cursorFn(q));er=0,e===l?eI(function(e=""){return Buffer.concat([et().C().str("P").str(e+et.N).end(),et().S().end()])}(e$.portal)):(q=new Y,eI(e8("",e$.cursorRows)))}catch(e){eI(es),e$.reject(e)}}function e5(e,t,i,r=""){return et().P().str(r+et.N).str(e+et.N).i16(t.length),t.forEach((e,t)=>et.i32(i[t]||0)),et.end()}function e8(e="",t=0){return Buffer.concat([et().E().str(e+et.N).i32(t).end(),ea])}},en=1,es=et().S().end(),ea=et().H().end(),eo=et().i32(8).i32(80877103).end(8),el=Buffer.concat([et().E().str(et.N).i32(0).end(),es]),ec=et().D().str("S").str(et.N).end(),eu=()=>{},ed=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),eh={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function ef(e){let t={},i=5;for(let r=5;r<e.length-1;r++)0===e[r]&&(t[eh[e[i]]]=e.toString("utf8",i+1,r),i=r+1);return t}function ep(e){return V.createHash("md5").update(e).digest("hex")}function em(e,t){return V.createHmac("sha256",e).update(t).digest()}function eg(e,t){let i;if(!(t="function"==typeof t?t():t))return{cancel:eu,start:eu};return{cancel(){i&&(clearTimeout(i),i=null)},start(){i&&clearTimeout(i),i=setTimeout(r,1e3*t,arguments)}};function r(t){e.apply(null,t),i=null}}let ey=()=>{};function eb(e,t,i,r){let n,s,a;let o=r.raw?Array(t.length):{};for(let l=0;l<t.length;l++)n=e[i++],s=t[l],a=110===n?null:117===n?void 0:void 0===s.parser?e.toString("utf8",i+4,i+=4+e.readUInt32BE(i)):!0===s.parser.array?s.parser(e.toString("utf8",i+5,i+=4+e.readUInt32BE(i))):s.parser(e.toString("utf8",i+4,i+=4+e.readUInt32BE(i))),r.raw?o[l]=!0===r.raw?a:r.value.from?r.value.from(a,s):a:o[s.name]=r.value.from?r.value.from(a,s):a;return{i:i,row:r.row.from?r.row.from(o):o}}function ew(e,t,i=393216){return new Promise(async(r,n)=>{await e.begin(async e=>{let n;t||([{oid:t}]=await e`select lo_creat(-1) as oid`);let[{fd:s}]=await e`select lo_open(${t}, ${i}) as fd`,a={writable:l,readable:o,close:()=>e`select lo_close(${s})`.then(n),tell:()=>e`select lo_tell64(${s})`,read:t=>e`select loread(${s}, ${t}) as data`,write:t=>e`select lowrite(${s}, ${t})`,truncate:t=>e`select lo_truncate64(${s}, ${t})`,seek:(t,i=0)=>e`select lo_lseek64(${s}, ${t}, ${i})`,size:()=>e`
          select
            lo_lseek64(${s}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return r(a),new Promise(async e=>n=e);async function o({highWaterMark:e=16384,start:t=0,end:i=1/0}={}){let r=i-t;return t&&await a.seek(t),new Z.Readable({highWaterMark:e,async read(e){let t=e>r?e-r:e;r-=e;let[{data:i}]=await a.read(t);this.push(i),i.length<e&&this.push(null)}})}async function l({highWaterMark:e=16384,start:t=0}={}){return t&&await a.seek(t),new Z.Writable({highWaterMark:e,write(e,t,i){a.write(e).then(()=>i(),i)}})}}).catch(n)})}Object.assign(eS,{PostgresError:u,toPascal:U,pascal:J,toCamel:L,camel:F,toKebab:D,kebab:H,fromPascal:R,fromCamel:B,fromKebab:M,BigInt:{to:20,from:[20],parse:e=>BigInt(e),serialize:e=>e.toString()}});let ev=eS;function eS(e,t){let i=function(e,t){var i;if(e&&e.shared)return e;let n=process.env,s=(e&&"string"!=typeof e?e:t)||{},{url:a,multihost:o}=function(e){if(!e||"string"!=typeof e)return{url:{searchParams:new Map}};let t=e;t=decodeURIComponent((t=t.slice(t.indexOf("://")+3).split(/[?/]/)[0]).slice(t.indexOf("@")+1));let i=new URL(e.replace(t,t.split(",")[0]));return{url:{username:decodeURIComponent(i.username),password:decodeURIComponent(i.password),host:i.host,hostname:i.hostname,port:i.port,pathname:i.pathname,searchParams:i.searchParams},multihost:t.indexOf(",")>-1&&t}}(e),l=[...a.searchParams].reduce((e,[t,i])=>(e[t]=i,e),{}),c=s.hostname||s.host||o||a.hostname||n.PGHOST||"localhost",u=s.port||a.port||n.PGPORT||5432,d=s.user||s.username||a.username||n.PGUSERNAME||n.PGUSER||function(){try{return r.userInfo().username}catch(e){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();s.no_prepare&&(s.prepare=!1),l.sslmode&&(l.ssl=l.sslmode,delete l.sslmode),"timeout"in s&&(console.log("The timeout option is deprecated, use idle_timeout instead"),s.idle_timeout=s.timeout),"system"===l.sslrootcert&&(l.ssl="verify-full");let h=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],f={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:eA,max_pipeline:100,backoff:e_,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(c)?c:c.split(",").map(e=>e.split(":")[0]),port:Array.isArray(u)?u:c.split(",").map(e=>parseInt(e.split(":")[1]||u)),path:s.path||c.indexOf("/")>-1&&c+"/.s.PGSQL."+u,database:s.database||s.db||(a.pathname||"").slice(1)||n.PGDATABASE||d,user:d,pass:s.pass||s.password||a.password||n.PGPASSWORD||"",...Object.entries(f).reduce((e,[t,i])=>{let r=t in s?s[t]:t in l?"disable"!==l[t]&&"false"!==l[t]&&l[t]:n["PG"+t.toUpperCase()]||i;return e[t]="string"==typeof r&&h.includes(t)?+r:r,e},{}),connection:{application_name:n.PGAPPNAME||"postgres.js",...s.connection,...Object.entries(l).reduce((e,[t,i])=>(t in f||(e[t]=i),e),{})},types:s.types||{},target_session_attrs:function(e,t,i){let r=e.target_session_attrs||t.searchParams.get("target_session_attrs")||i.PGTARGETSESSIONATTRS;if(!r||["read-write","read-only","primary","standby","prefer-standby"].includes(r))return r;throw Error("target_session_attrs "+r+" is not supported")}(s,a,n),onnotice:s.onnotice,onnotify:s.onnotify,onclose:s.onclose,onparameter:s.onparameter,socket:s.socket,transform:{undefined:(i=s.transform||{undefined:void 0}).undefined,column:{from:"function"==typeof i.column?i.column:i.column&&i.column.from,to:i.column&&i.column.to},value:{from:"function"==typeof i.value?i.value:i.value&&i.value.from,to:i.value&&i.value.to},row:{from:"function"==typeof i.row?i.row:i.row&&i.row.from,to:i.row&&i.row.to}},parameters:{},shared:{retries:0,typeArrayMap:{}},...E(s.types)}}(e,t),s=i.no_subscribe||function(e,t){let i=new Map,r="postgresjs_"+Math.random().toString(36).slice(2),n={},s,a,o=!1,l=d.sql=e({...t,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...t.connection,replication:"database"},onclose:async function(){o||(a=null,n.pid=n.secret=void 0,h(await f(l,r,t.publications)),i.forEach(e=>e.forEach(({onsubscribe:e})=>e())))},no_subscribe:!0}),c=l.end,u=l.close;return l.end=async()=>(o=!0,a&&await new Promise(e=>(a.once("close",e),a.end())),c()),l.close=async()=>(a&&await new Promise(e=>(a.once("close",e),a.end())),u()),d;async function d(e,o,c=ey,u=ey){e=function(e){let t=e.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!t)throw Error("Malformed subscribe pattern: "+e);let[,i,r,n]=t;return(i||"*")+(r?":"+(-1===r.indexOf(".")?"public."+r:r):"")+(n?"="+n:"")}(e),s||(s=f(l,r,t.publications));let d={fn:o,onsubscribe:c},p=i.has(e)?i.get(e).add(d):i.set(e,new Set([d])).get(e),m=()=>{p.delete(d),0===p.size&&i.delete(e)};return s.then(e=>(h(e),c(),a&&a.on("error",u),{unsubscribe:m,state:n,sql:l}))}function h(e){a=e.stream,n.pid=e.state.pid,n.secret=e.state.secret}async function f(e,i,r){if(!r)throw Error("Missing publication names");let n=await e.unsafe(`CREATE_REPLICATION_SLOT ${i} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[s]=n,a=await e.unsafe(`START_REPLICATION SLOT ${i} LOGICAL ${s.consistent_point} (proto_version '1', publication_names '${r}')`).writable(),o={lsn:Buffer.concat(s.consistent_point.split("/").map(e=>Buffer.from(("00000000"+e).slice(-8),"hex")))};return a.on("data",function(i){119===i[0]?function(e,t,i,r,n){Object.entries({R:e=>{let r=1,s=t[e.readUInt32BE(r)]={schema:e.toString("utf8",r+=4,r=e.indexOf(0,r))||"pg_catalog",table:e.toString("utf8",r+1,r=e.indexOf(0,r+1)),columns:Array(e.readUInt16BE(r+=2)),keys:[]};r+=2;let a=0,o;for(;r<e.length;)(o=s.columns[a++]={key:e[r++],name:n.column.from?n.column.from(e.toString("utf8",r,r=e.indexOf(0,r))):e.toString("utf8",r,r=e.indexOf(0,r)),type:e.readUInt32BE(r+=1),parser:i[e.readUInt32BE(r)],atttypmod:e.readUInt32BE(r+=4)}).key&&s.keys.push(o),r+=4},Y:()=>{},O:()=>{},B:e=>{var i;t.date=(i=e.readBigInt64BE(9),new Date(Date.UTC(2e3,0,1)+Number(i/BigInt(1e3)))),t.lsn=e.subarray(1,9)},I:e=>{let i=1,s=t[e.readUInt32BE(i)],{row:a}=eb(e,s.columns,i+=7,n);r(a,{command:"insert",relation:s})},D:e=>{let i=1,s=t[e.readUInt32BE(i)],a=75===e[i+=4];r(a||79===e[i]?eb(e,s.columns,i+=3,n).row:null,{command:"delete",relation:s,key:a})},U:e=>{let i=1,s=t[e.readUInt32BE(i)],a=75===e[i+=4],o=a||79===e[i]?eb(e,s.columns,i+=3,n):null;o&&(i=o.i);let{row:l}=eb(e,s.columns,i+3,n);r(l,{command:"update",relation:s,key:a,old:o&&o.row})},T:()=>{},C:()=>{}}).reduce((e,[t,i])=>(e[t.charCodeAt(0)]=i,e),{})[e[0]](e)}(i.subarray(25),o,e.options.parsers,l,t.transform):107===i[0]&&i[17]&&(o.lsn=i.subarray(1,9),function(){let e=Buffer.alloc(34);e[0]=114,e.fill(o.lsn,1),e.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),a.write(e)}())}),a.on("error",function(e){console.error("Unexpected error during logical streaming - reconnecting",e)}),a.on("close",e.close),{stream:a,state:n.state};function l(e,t){let i=t.relation.schema+"."+t.relation.table;p("*",e,t),p("*:"+i,e,t),t.relation.keys.length&&p("*:"+i+"="+t.relation.keys.map(t=>e[t.name]),e,t),p(t.command,e,t),p(t.command+":"+i,e,t),t.relation.keys.length&&p(t.command+":"+i+"="+t.relation.keys.map(t=>e[t.name]),e,t)}}function p(e,t,r){i.has(e)&&i.get(e).forEach(({fn:i})=>i(t,r,e))}}(eS,{...i}),a=!1,o=X(),h=X(),g=X(),y=X(),b=X(),w=X(),v=X(),S=X(),_={connecting:h,reserved:g,closed:y,ended:b,open:w,busy:v,full:S},A=[...Array(i.max)].map(()=>er(i,_,{onopen:R,onend:B,onclose:M})),x=T(function(e){return a?e.reject(d.connection("CONNECTION_ENDED",i,i)):w.length?q(w.shift(),e):y.length?D(y.shift(),e):void(v.length?q(v.shift(),e):o.push(e))});return Object.assign(x,{get parameters(){return i.parameters},largeObject:ew.bind(null,x),subscribe:s,CLOSE:l,END:l,PostgresError:u,options:i,reserve:C,listen:k,begin:P,close:L,end:j}),x;function T(e){return e.debug=i.debug,Object.entries(i.types).reduce((e,[t,i])=>(e[t]=e=>new p(e,i.to),e),t),Object.assign(r,{types:t,typed:t,unsafe:function(t,i=[],r={}){return 2!=arguments.length||Array.isArray(i)||(r=i,i=[]),new c([t],i,e,I,{prepare:!1,...r,simple:"simple"in r?r.simple:0===i.length})},notify:$,array:function e(t,r){return Array.isArray(t)?new p(t,r||(t.length?N(t)||25:0),i.shared.typeArrayMap):e(Array.from(arguments))},json:O,file:function(t,i=[],r={}){return 2!=arguments.length||Array.isArray(i)||(r=i,i=[]),new c([],i,i=>{n.readFile(t,"utf8",(t,r)=>{if(t)return i.reject(t);i.strings=[r],e(i)})},I,{...r,simple:"simple"in r?r.simple:0===i.length})}}),r;function t(e,t){return new p(e,t)}function r(t,...n){return t&&Array.isArray(t.raw)?new c(t,n,e,I):"string"!=typeof t||n.length?new m(t,n):new f(i.transform.column.to?i.transform.column.to(t):t)}}async function k(e,t,r){let n={fn:t,onlisten:r},s=k.sql||(k.sql=eS({...i,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(k.channels).forEach(([e,{listeners:t}])=>{delete k.channels[e],Promise.all(t.map(t=>k(e,t.fn,t.onlisten).catch(()=>{})))})},onnotify(e,t){e in k.channels&&k.channels[e].listeners.forEach(e=>e.fn(t))}})),a=k.channels||(k.channels={});if(e in a){a[e].listeners.push(n);let t=await a[e].result;return n.onlisten&&n.onlisten(),{state:t.state,unlisten:l}}a[e]={result:s`listen ${s.unsafe('"'+e.replace(/"/g,'""')+'"')}`,listeners:[n]};let o=await a[e].result;return n.onlisten&&n.onlisten(),{state:o.state,unlisten:l};async function l(){if(e in a!=!1&&(a[e].listeners=a[e].listeners.filter(e=>e!==n),!a[e].listeners.length))return delete a[e],s`unlisten ${s.unsafe('"'+e.replace(/"/g,'""')+'"')}`}}async function $(e,t){return await x`select pg_notify(${e}, ${""+t})`}async function C(){let e=X(),t=w.length?w.shift():await new Promise((e,t)=>{let i={reserve:e,reject:t};o.push(i),y.length&&D(y.shift(),i)});Q(t,g),t.reserved=()=>e.length?t.execute(e.shift()):Q(t,g),t.reserved.release=!0;let i=T(function(i){t.queue===S?e.push(i):t.execute(i)||Q(t,S)});return i.release=()=>{t.reserved=null,R(t)},i}async function P(e,t){t||(t=e,e="");let i=X(),r=0,n,s=null;try{return await x.unsafe("begin "+e.replace(/[^a-z ]/ig,""),[],{onexecute:function(e){n=e,Q(e,g),e.reserved=()=>i.length?e.execute(i.shift()):Q(e,g)}}).execute(),await Promise.race([a(n,t),new Promise((e,t)=>n.onclose=t)])}catch(e){throw e}async function a(e,t,n){let o,l;let c=T(function(t){t.catch(e=>o||(o=e)),e.queue===S?i.push(t):e.execute(t)||Q(e,S)});c.savepoint=function t(i,n){return i&&Array.isArray(i.raw)?t(e=>e.apply(e,arguments)):(1==arguments.length&&(n=i,i=null),a(e,n,"s"+r+++(i?"_"+i:"")))},c.prepare=e=>s=e.replace(/[^a-z0-9$-_. ]/gi),n&&await c`savepoint ${c(n)}`;try{if(l=await new Promise((e,i)=>{let r=t(c);Promise.resolve(Array.isArray(r)?Promise.all(r):r).then(e,i)}),o)throw o}catch(e){throw await (n?c`rollback to ${c(n)}`:c`rollback`),e instanceof u&&"25P02"===e.code&&o||e}return n||(s?await c`prepare transaction '${c.unsafe(s)}'`:await c`commit`),l}}function Q(e,t){return e.queue.remove(e),t.push(e),e.queue=t,t===w?e.idleTimer.start():e.idleTimer.cancel(),e}function O(e){return new p(e,3802)}function q(e,t){return e.execute(t)?Q(e,v):Q(e,S)}function I(e){return new Promise((t,r)=>{e.state?e.active?er(i).cancel(e.state,t,r):e.cancelled={resolve:t,reject:r}:(o.remove(e),e.cancelled=!0,e.reject(d.generic("57014","canceling statement due to user request")),t())})}async function j({timeout:e=null}={}){let t;return a||(await 1,a=Promise.race([new Promise(i=>null!==e&&(t=setTimeout(U,1e3*e,i))),Promise.all(A.map(e=>e.end()).concat(k.sql?k.sql.end({timeout:0}):[],s.sql?s.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(t)))}async function L(){await Promise.all(A.map(e=>e.end()))}async function U(e){for(await Promise.all(A.map(e=>e.terminate()));o.length;)o.shift().reject(d.connection("CONNECTION_DESTROYED",i));e()}function D(e,t){return Q(e,h),e.connect(t),e}function B(e){Q(e,b)}function R(e){if(0===o.length)return Q(e,w);let t=Math.ceil(o.length/(h.length+1)),i=!0;for(;i&&o.length&&t-- >0;){let t=o.shift();if(t.reserve)return t.reserve(e);i=e.execute(t)}i?Q(e,v):Q(e,S)}function M(e,t){Q(e,y),e.reserved=null,e.onclose&&(e.onclose(t),e.onclose=null),i.onclose&&i.onclose(e.id),o.length&&D(e,o.shift())}}function e_(e){return(.5+Math.random()/2)*Math.min(3**e/100,20)}function eA(){return 60*(30+30*Math.random())}}};